<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Как создать расширение типа формы &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css">
    <link rel="stylesheet" href="..\_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="..\index.html">
    <link rel="up" title="Forms" href="..\forms.html">
    <link rel="next" title="How to Choose Validation Groups Based on the Submitted Data" href="data_based_validation.html">
    <link rel="prev" title="How to Create a Form Type Extension" href="create_form_type_extension.html">

<link rel="stylesheet" href="..\_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="..\_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="..\_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="form doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\..\index.html">
                    <img src="..\..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="..\index.html">Главная</a>
        </li>
    
        <li>
            <a href="..\components\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="..\best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="..\quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="..\reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="..\genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="..\contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Как создать расширение типа формы</a><ul>
<li><a class="reference internal" href="#id2">Определение расширения типа формы</a></li>
<li><a class="reference internal" href="#id3">Регистрация вашего расширения типа формы в качестве сервиса</a></li>
<li><a class="reference internal" href="#id4">Добавление расширений логики предметной области</a></li>
<li><a class="reference internal" href="#id5">Переопределите фрагмент шаблона виджета файла</a></li>
<li><a class="reference internal" href="#id6">Использование расширения типа формы</a></li>
<li><a class="reference internal" href="#id7">Общие расширения типа форм</a></li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="..\index.html">Документация</a></li>
                
                <li><a href="..\forms.html">Forms</a></li>
                
                <li class="active">Как создать расширение типа формы</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Как создать расширение типа формы<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Расширения типов формы <em>невероятно</em> мощные: они повзоляют вам <em>изменять</em> любые
существующие типы полей формы по всей системе.</p>
<p>Они имеют 2 основных применения:</p>
<ol class="arabic simple">
<li>Вы хотите добавить <strong>особенную функцию к единственному типу формы</strong>
(как добавление функции &quot;скачать&quot; к типу поля <tt class="docutils literal"><code>FileType</code></tt>);</li>
<li>Вы хотите добавить <strong>общую функцию к нескольким типам</strong> (как добавление
текста &quot;помощь&quot; к каждому типу вроде &quot;ввода текста&quot;).</li>
</ol>
<p>Представьте, что у вас есть сущность <tt class="docutils literal"><code>Media</code></tt>, и что каждое медиа ассоциируется
с файлом. Ваша форма <tt class="docutils literal"><code>Media</code></tt> использует тип файла, но при редактировании сущности,
вы хотите, чтобы её изображение автоматически отображалось рядом с вводом файла.</p>
<div class="section" id="id2">
<h2>Определение расширения типа формы<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Для начала, создайте класс расширения типа формы:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Extension/ImageTypeExtension.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Extension</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractTypeExtension</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\FileType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ImageTypeExtension</span> <span class="k">extends</span> <span class="nx">AbstractTypeExtension</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Возвращает имя расширяемого типа.</span>
<span class="sd">     *</span>
<span class="sd">     * @return строку имени расширяемого типа</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getExtendedType</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// использовать FormType::class, чтобы изменить (почти) каждое поле в системе</span>
        <span class="k">return</span> <span class="nx">FileType</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Единственный метод, который вы <strong>должны</strong> реализовать - это функция <tt class="docutils literal"><code>getExtendedType()</code></tt>.
Она используется для конфигурации того, <em>какое</em> поля или типы полей вы хотите изменить.</p>
<p>В дополнение к функции <tt class="docutils literal"><code>getExtendedType()</code></tt>, вы скорее всего захотите переопределить
один из следующих методов:</p>
<ul class="simple">
<li><tt class="docutils literal"><code>buildForm()</code></tt></li>
<li><tt class="docutils literal"><code>buildView()</code></tt></li>
<li><tt class="docutils literal"><code>configureOptions()</code></tt></li>
<li><tt class="docutils literal"><code>finishView()</code></tt></li>
</ul>
<p>Чтобы узнать больше о том, что делают эти методы, смотрите статью
<a class="reference internal" href="create_custom_field_type.html#form-type-methods-explanation"><span>пользовательский тип поля формы</span></a>.</p>
</div>
<div class="section" id="id3">
<h2>Регистрация вашего расширения типа формы в качестве сервиса<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Следующий шаг - предупредить Symfony о вашем расширении. Сделайте это путём регистрации
вашего класса в качестве сервиса и используя тег <tt class="docutils literal"><code>form.type_extension</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/services.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">App\Form\Extension\ImageTypeExtension</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">tags</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">name</span><span class="p p-Indicator">:</span> <span class="nv">form.type_extension</span><span class="p p-Indicator">,</span> <span class="nv">extended_type</span><span class="p p-Indicator">:</span> <span class="nv">Symfony\Component\Form\Extension\Core\Type\FileType</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/services.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;App\Form\Extension\ImageTypeExtension&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;form.type_extension&quot;</span> <span class="na">extended-type=</span><span class="s">&quot;Symfony\Component\Form\Extension\Core\Type\FileType&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/services.php</span>
<span class="k">use</span> <span class="nx">App\Form\Extension\ImageTypeExtension</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\FileType</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">autowire</span><span class="p">(</span><span class="nx">ImageTypeExtension</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addTag</span><span class="p">(</span><span class="s1">&#39;form.type_extension&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;extended_type&#39;</span> <span class="o">=&gt;</span> <span class="nx">FileType</span><span class="o">::</span><span class="na">class</span>
    <span class="p">))</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Ключ <tt class="docutils literal"><code>extended_type</code></tt> тега должен совпадать с классом, который вы возвращаете из метода
<tt class="docutils literal"><code>getExtendedType()</code></tt>. <em>Как только</em> вы это сделаете, любой метод, который вы переопределили
(например, <tt class="docutils literal"><code>buildForm()</code></tt>), будет вызван каждый раз, когда <em>любое</em> поле данного типа (<tt class="docutils literal"><code>FileType</code></tt>)
будет построено. Давайте рассмотрим пример.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Существует необязательный атрибут тега под названием <tt class="docutils literal"><code>priority</code></tt>,
который по умолчанию имеет значение <tt class="docutils literal"><code>0</code></tt>, и контролирует порядок,
в котором загружаются расширения типов формы (чем выше приоритет -
тем раньше загружается расширение). Это полезно, когда вам нужно
гарантировать, что одно расширение будет загружено перед другим.</p>
</div></div>
</div>
<div class="section" id="id4">
<h2>Добавление расширений логики предметной области<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Целью вашего расширения является отображение красивого изображения радом с
вводом файла (когда базовая модель содержит изображения). Для этой цели,
представьте, что вы используете подход, схожий с описанным в
<a class="reference internal" href="..\controller\upload_file.html"><em>Как управлять загрузками файлов с Doctrine</em></a>:
у вас есть медиа-модель со свойством пути, соответствующим пути изображения в
базе данных:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Entity/Media.php</span>
<span class="k">namespace</span> <span class="nx">App\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints</span> <span class="k">as</span> <span class="nx">Assert</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Media</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="sd">/**</span>
<span class="sd">     * @var string The path - typically stored in the database</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$path</span><span class="p">;</span>

    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getWebPath</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// ... $webPath как полный URL изображения, будет использован в шаблоне</span>

        <span class="k">return</span> <span class="nv">$webPath</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Ваш класс расширения типа формы должен будет сделать две вещи, чтобы расширить
тип формы <tt class="docutils literal"><code>FileType::class</code></tt>:</p>
<ol class="arabic simple">
<li>Переопределить метод <tt class="docutils literal"><code>configureOptions()</code></tt>, чтобы любое поле <tt class="docutils literal"><code>FileType</code></tt> могло
иметь опцию <tt class="docutils literal"><code>image_property</code></tt>;</li>
<li>Переопределить методы <tt class="docutils literal"><code>buildView()</code></tt>, чтобы передать URL изображения к просмотру.</li>
</ol>
<p>Например:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Extension/ImageTypeExtension.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Extension</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractTypeExtension</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormView</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\PropertyAccess\PropertyAccess</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\OptionsResolver\OptionsResolver</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\FileType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ImageTypeExtension</span> <span class="k">extends</span> <span class="nx">AbstractTypeExtension</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getExtendedType</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nx">FileType</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// разрешает полям FileType иметь свойство image_property</span>
        <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setDefined</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;image_property&#39;</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildView</span><span class="p">(</span><span class="nx">FormView</span> <span class="nv">$view</span><span class="p">,</span> <span class="nx">FormInterface</span> <span class="nv">$form</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;image_property&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="c1">// будет тем классом / сущностью, которая привязана к вашей форме (например, Media)</span>
            <span class="nv">$parentData</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getParent</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>

            <span class="nv">$imageUrl</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">!==</span> <span class="nv">$parentData</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$accessor</span> <span class="o">=</span> <span class="nx">PropertyAccess</span><span class="o">::</span><span class="na">createPropertyAccessor</span><span class="p">();</span>
                <span class="nv">$imageUrl</span> <span class="o">=</span> <span class="nv">$accessor</span><span class="o">-&gt;</span><span class="na">getValue</span><span class="p">(</span><span class="nv">$parentData</span><span class="p">,</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;image_property&#39;</span><span class="p">]);</span>
            <span class="p">}</span>

            <span class="c1">// устанавливает переменную &quot;image_url&quot;, которая будет доступна при отображении этого поля</span>
            <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">vars</span><span class="p">[</span><span class="s1">&#39;image_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$imageUrl</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id5">
<h2>Переопределите фрагмент шаблона виджета файла<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Каждый тип поля отображается фрагментом шаблона. Эти фрагменты шаблонов могут
быть пеоепределены, чтобы настроить отображение формы. Чтобы узнать больше, вы
можете обратиться к статье <a class="reference internal" href="form_customization-ru.html#form-customization-form-themes"><span>Что такое темы форм?</span></a>.</p>
<p>В вашем классе расширения, вы добавили новую переменную (<tt class="docutils literal"><code>image_url</code></tt>),
но вам всё ещё надо воспользоваться преимуществом этой новой переменной в
ваших шаблонах. Особенно вам надо переопределить блок <tt class="docutils literal"><code>file_widget</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# templates/form/fields.html.twig #}</span>
<span class="cp">{%</span> <span class="k">extends</span> <span class="s1">&#39;form_div_layout.html.twig&#39;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">file_widget</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">spaceless</span> <span class="cp">%}</span>

    <span class="cp">{{</span> <span class="nb">block</span><span class="o">(</span><span class="s1">&#39;form_widget&#39;</span><span class="o">)</span> <span class="cp">}}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">image_url</span> <span class="k">is</span> <span class="k">not</span> <span class="nf">null</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">asset</span><span class="o">(</span><span class="nv">image_url</span><span class="o">)</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">/&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

    <span class="cp">{%</span> <span class="k">endspaceless</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-html+php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- src/Resources/file_widget.html.php --&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;form&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">widget</span><span class="p">(</span><span class="nv">$form</span><span class="p">)</span> <span class="cp">?&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">!==</span> <span class="nv">$image_url</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;assets&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getUrl</span><span class="p">(</span><span class="nv">$image_url</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="p">/&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endif</span> <span class="cp">?&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Обязательно <a class="reference internal" href="form_themes.html#forms-theming-global"><span>сконфигурируйте шаблон темы этой формы</span></a> так,
чтобы система форм видела его.</p>
</div>
<div class="section" id="id6">
<h2>Использование расширения типа формы<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>Теперь, при добавлении типа поля <tt class="docutils literal"><code>FileType::class</code></tt> к вашей форме, вы можете
указать опцию <tt class="docutils literal"><code>image_property</code></tt>, которая будет использована для отображения
изображения рядом с полем файла. Например:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Form/Type/MediaType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\AbstractType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormBuilderInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\TextType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\FileType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MediaType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="nx">FileType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;image_property&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;webPath&#39;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>При отображении формы, если основная модель уже была ассоциирована с изображением,
вы увидите его, отображённым рядом с вводом файла.</p>
</div>
<div class="section" id="id7">
<h2>Общие расширения типа форм<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>Вы можете изменять несколько типов форм одновременно, указав их общего родителя
(<a class="reference internal" href="..\reference\forms\types.html"><em>Form Types Reference</em></a>). Например, несколько типов форм наследуют из типа
формы <tt class="docutils literal"><code>TextType</code></tt> (такие как``EmailType``, <tt class="docutils literal"><code>SearchType</code></tt>, <tt class="docutils literal"><code>UrlType</code></tt>, и т.д.).
Расширение типа формы, применённое к <tt class="docutils literal"><code>TextType</code></tt> (т.е. метод <tt class="docutils literal"><code>getExtendedType()</code></tt>
возвращает <tt class="docutils literal"><code>TextType::class</code></tt>) будет применяться ко всем типам этой формы.</p>
<p>Таким же образом, так как <strong>большинство</strong> типов форм доступных в Symfony наследуют
из типа формы <tt class="docutils literal"><code>FormType</code></tt>, расширение типа формы, применённое к <tt class="docutils literal"><code>FormType</code></tt>, будет
применено ко всем (заметным исключением являются типы формы <tt class="docutils literal"><code>ButtonType</code></tt>). Также
имейте в виду, что если вы создали (или используете) <em>пользовательский</em> тип формы,
то может быть так, что он <em>не</em> расширяет <tt class="docutils literal"><code>FormType</code></tt>, и тогда ваше расширение типа
формы нельзя будет применить к нему.</p>
</div>
</div>


            </div>

            
            <div class="navigation">
                <a href="create_form_type_extension.html">« How to Create a Form Type Extension</a>
                <span class="separator">|</span>
                <a href="data_based_validation.html">How to Choose Validation Groups Based on the Submitted Data »</a>
            </div>
            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>