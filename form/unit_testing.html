<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Как проводить модульное тестирование ваших форм &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css">
    <link rel="stylesheet" href="..\_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="..\index.html">
    <link rel="up" title="Forms" href="..\forms.html">
    <link rel="next" title="How to Configure empty Data for a Form Class" href="use_empty_data.html">
    <link rel="prev" title="How to Unit Test your Forms" href="unit_testing.html">

<link rel="stylesheet" href="..\_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="..\_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="..\_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="form doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\..\index.html">
                    <img src="..\..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="..\index.html">Главная</a>
        </li>
    
        <li>
            <a href="..\components\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="..\best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="..\quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="..\reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="..\genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="..\contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Как проводить модульное тестирование ваших форм</a><ul>
<li><a class="reference internal" href="#id2">Основы</a></li>
<li><a class="reference internal" href="#id3">Тестирование типов из сервис-контейнера</a></li>
<li><a class="reference internal" href="#id4">Добавление пользовательских расширений</a></li>
<li><a class="reference internal" href="#id5">Тестирование с разными наборами данных</a></li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="..\index.html">Документация</a></li>
                
                <li><a href="..\forms.html">Forms</a></li>
                
                <li class="active">Как проводить модульное тестирование ваших форм</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Как проводить модульное тестирование ваших форм<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Компонент Формы состоит из 3 базовых объектов: типа формы (реализующего
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/FormTypeInterface.html" title="Symfony\Component\Form\FormTypeInterface">FormTypeInterface</a></code></tt>),
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html" title="Symfony\Component\Form\Form">Form</a></code></tt> и
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/FormView.html" title="Symfony\Component\Form\FormView">FormView</a></code></tt>.</p>
<p>Единственный класс, который обычно изменяют программисты - это класс типа формы,
который служит схемой формы. Он используется для генерирования <tt class="docutils literal"><code>Form</code></tt> и
<tt class="docutils literal"><code>FormView</code></tt>. Вы можете протестировать его напрямую сымитировав его взаимодействия
с фабрикой, но это будет сложно. Лучше передать его в FormFactory так, как это
делается в настоящем приложении. Его легко использовать в начальной загрузке, и вы
можете доверять компонентам Symfony достаточно, чтобы использовать их в качестве базы
для тестирования.</p>
<p>Уже существует класс, от которого вы можете получить пользу в простом тестировании
FormTypes: <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Test/TypeTestCase.html" title="Symfony\Component\Form\Test\TypeTestCase">TypeTestCase</a></code></tt>. Он используется
для тестирования базовых типов и вы можете исползовать его для тестирования собственных
типов.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">В зависимости от того, как вы установили вашу Symfony или компонент Формы,
тесты могут быть не скачаны. В таком случае, используйте опцию <tt class="docutils literal"><code>--prefer-source</code></tt>
в Composer.</p>
</div></div>
<div class="section" id="id2">
<h2>Основы<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Простейшая реализация <tt class="docutils literal"><code>TypeTestCase</code></tt> выглядит так:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// tests/Form/Type/TestedTypeTest.php</span>
<span class="k">namespace</span> <span class="nx">App\Tests\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Form\Type\TestedType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Model\TestObject</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Test\TypeTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TestedTypeTest</span> <span class="k">extends</span> <span class="nx">TypeTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSubmitValidData</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$formData</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;test&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;test2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test2&#39;</span><span class="p">,</span>
        <span class="p">);</span>

        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nx">TestedType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TestObject</span><span class="p">();</span>
        <span class="c1">// ...наполнить свойства $object данными, хранящимися в $formData</span>

        <span class="c1">// отправить данные в форму напрямую</span>
        <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$formData</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSynchronized</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$object</span><span class="p">,</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>

        <span class="nv">$view</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">();</span>
        <span class="nv">$children</span> <span class="o">=</span> <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">;</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$formData</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertArrayHasKey</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$children</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Итак, что он тестирует? Вот детальное разъясение.</p>
<p>Во-первых, вы верифиуируете компиляцию <tt class="docutils literal"><code>FormType</code></tt>. Это включает в себя базовое
наследование классов, функцию <tt class="docutils literal"><code>buildForm()</code></tt> и резолюцию опций. Это должно быть
первым тестом, который вы напишете:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nx">TestedType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Этот тест проверяет, чтобы ни один из ваших преобразователей данных, использованных
формой, не потерпели неудачу. Метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/FormInterface.html#method_isSynchronized" title="Symfony\Component\Form\FormInterface::isSynchronized()">isSynchronized()</a></code></tt>
устаналивается, как <tt class="docutils literal"><code>false</code></tt> только, если преобразователь данных выдаёт исключение:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$formData</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSynchronized</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Не тестируйте валидацию: она применяется слушателем, который не
активен в случае тестирования и полагается на конфигурацию валидации.
Вместо этого, проведите модульное тестирование ваших пользовательских
ограничений напрямую.</p>
</div></div>
<p>Далее, верифицируйте отправку и отображение формы. Тест ниже проверяет,
правильно ли были указаны все поля:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$object</span><span class="p">,</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
<p>Наконец, проверьте создание <tt class="docutils literal"><code>FormView</code></tt>. Вы должны проверить, все ли виджеты,
которые вы хотите отобразить, доступны в дочернем свойстве:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$view</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">();</span>
<span class="nv">$children</span> <span class="o">=</span> <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$formData</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertArrayHasKey</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$children</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id3">
<h2>Тестирование типов из сервис-контейнера<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Ваша форма может быть использована в качестве сервиса, так как она зависит от
других сервисов (например, менеджера сущностей Doctrine). В таких случаях,
использование кода, показанного выше, не будет работать, так как компонент
Формы просто инстанциирует тип формы, не передавая в конструктор никаких
аргументов.</p>
<p>Чтобы решить это, вам нужно сымитировать внедрённые зависимости, инстанциировать
ваш собственный тип формы и использовать <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/PreloadedExtension.html" title="Symfony\Component\Form\PreloadedExtension">PreloadedExtension</a></code></tt>,
чтобы убедиться, что <tt class="docutils literal"><code>FormRegistry</code></tt> использует созданный экземпляр:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// tests/Form/Type/TestedTypeTest.php</span>
<span class="k">namespace</span> <span class="nx">App\Tests\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Form\Type\TestedType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\Common\Persistence\ObjectManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\PreloadedExtension</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Test\TypeTestCase</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">class</span> <span class="nc">TestedTypeTest</span> <span class="k">extends</span> <span class="nx">TypeTestCase</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$entityManager</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// симитировать любые зависимости</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entityManager</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">ObjectManager</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getExtensions</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// создать экземпляр типа с имимтированными зависимостями</span>
        <span class="nv">$type</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TestedType</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">entityManager</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// зарегистрировать экземляры типов в PreloadedExtension</span>
            <span class="k">new</span> <span class="nx">PreloadedExtension</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$type</span><span class="p">),</span> <span class="k">array</span><span class="p">()),</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSubmitValidData</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Вместо создания нового экземпляра, будет использован созданный в</span>
        <span class="c1">// getExtensions().</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">factory</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nx">TestedType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="c1">// ... ваш тест</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id4">
<h2>Добавление пользовательских расширений<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Часто случается так, что вы используете какие-то опции, добавленные
<a class="reference internal" href="create_form_type_extension.html"><em>расширениями формы</em></a>. Одним из случаев
может быть <tt class="docutils literal"><code>ValidatorExtension</code></tt> с его опцией <tt class="docutils literal"><code>invalid_message</code></tt>. <tt class="docutils literal"><code>TypeTestCase</code></tt>
загружает только базовое расширение формы, что означает, что
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/OptionsResolver/Exception/InvalidOptionsException.html" title="Symfony\Component\OptionsResolver\Exception\InvalidOptionsException">InvalidOptionsException</a></code></tt>
будет вызван, если вы попробуете протестировать класс, зависящий от других расширений.
Метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Test/TypeTestCase.html#method_getExtensions" title="Symfony\Component\Form\Test\TypeTestCase::getExtensions()">getExtensions()</a></code></tt> позволяет
вам возвращать список расширений для регистрации:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// tests/Form/Type/TestedTypeTest.php</span>
<span class="k">namespace</span> <span class="nx">App\Tests\Form\Type</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">App\Form\Type\TestedType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Validator\ValidatorExtension</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Form</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\ConstraintViolationList</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Mapping\ClassMetadata</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Validator\ValidatorInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TestedTypeTest</span> <span class="k">extends</span> <span class="nx">TypeTestCase</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$validator</span><span class="p">;</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getExtensions</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createMock</span><span class="p">(</span><span class="nx">ValidatorInterface</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="c1">// использовать getMock() в PHPUnit 5.3 или более ранних версиях</span>
        <span class="c1">// $this-&gt;validator = $this-&gt;getMock(ValidatorInterface::class);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span>
            <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="k">new</span> <span class="nx">ConstraintViolationList</span><span class="p">()));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span>
            <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;getMetadataFor&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="k">new</span> <span class="nx">ClassMetadata</span><span class="p">(</span><span class="nx">Form</span><span class="o">::</span><span class="na">class</span><span class="p">)));</span>

        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">ValidatorExtension</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">validator</span><span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ... ваши тесты</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Также возможно загружать пользовательские типы форм, расширения типов форм или
отгадыватели типов, используя методы
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Test/FormIntegrationTestCase.html#method_getTypes" title="Symfony\Component\Form\Test\FormIntegrationTestCase::getTypes()">getTypes()</a></code></tt>,
<cite>:method:`Symfony\Component\Form\Test\FormIntegrationTestCase::`getTypeExtensions</cite>
и <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Test/FormIntegrationTestCase.html#method_getTypeGuessers" title="Symfony\Component\Form\Test\FormIntegrationTestCase::getTypeGuessers()">getTypeGuessers()</a></code></tt>.</p>
</div>
<div class="section" id="id5">
<h2>Тестирование с разными наборами данных<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Если вы ещё не знакомы с <a class="reference external" href="https://phpunit.de/manual/current/en/writing-tests-for-phpunit.html#writing-tests-for-phpunit.data-providers">поставщиками данных</a> PHPUnit, это может стать
хорошим случаем, чтобы их использовать:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// tests/Form/Type/TestedTypeTest.php</span>
<span class="k">namespace</span> <span class="nx">App\Tests\Form\Type</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Form\Type\TestedType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Test\TypeTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TestedTypeTest</span> <span class="k">extends</span> <span class="nx">TypeTestCase</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @dataProvider getValidTestData</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testForm</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ... your test</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getValidTestData</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;test&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;test2&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test2&#39;</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(),</span>
            <span class="p">),</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;test&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
                    <span class="s1">&#39;test2&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Код выше запустит ваши тесты три раза с 3 разными наборами данных. Это
позволяет разделить тест над общим набором объектов и тесты, а также
облегчает тестирование с несколькими наборами данных.</p>
<p>Вы также можете передать другой аргумент, например, булев, если форма
должна быть синхроизирована с данными набором данных или нет, и т.д.</p>
</div>
</div>


            </div>

            
            <div class="navigation">
                <a href="unit_testing.html">« How to Unit Test your Forms</a>
                <span class="separator">|</span>
                <a href="use_empty_data.html">How to Configure empty Data for a Form Class »</a>
            </div>
            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>