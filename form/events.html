<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>События формы &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css">
    <link rel="stylesheet" href="..\_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="..\index.html">
    <link rel="up" title="Forms" href="..\forms.html">
    <link rel="next" title="How to Embed a Collection of Forms" href="form_collections.html">
    <link rel="prev" title="Form Events" href="events.html">

<link rel="stylesheet" href="..\_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="..\_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="..\_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="form doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\..\index.html">
                    <img src="..\..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="..\index.html">Главная</a>
        </li>
    
        <li>
            <a href="..\components\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="..\best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="..\quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="..\reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="..\genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="..\contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">События формы</a><ul>
<li><a class="reference internal" href="#id2">Рабочий процесс формы</a><ul>
<li><a class="reference internal" href="#id3">Рабочий процесс отправки формы</a></li>
<li><a class="reference internal" href="#formevents-pre-set-data-formevents-post-set-data">1) Предварительное заполнение формы (<tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt> и <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt>)</a><ul>
<li><a class="reference internal" href="#a-formevents-pre-set-data">A) Событие <tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt></a></li>
<li><a class="reference internal" href="#b-formevents-post-set-data">B) Событие <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#formevents-pre-submit-formevents-submit-formevents-post-submit">2) Отправка формы (<tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt>, <tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt> и <tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt>)</a><ul>
<li><a class="reference internal" href="#a-formevents-pre-submit">A) Событие <tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt></a></li>
<li><a class="reference internal" href="#b-formevents-submit">B) Событие <tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt></a></li>
<li><a class="reference internal" href="#c-formevents-post-submit">C) Событие <tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id4">Регистрация слушателей или подписчиков событий</a><ul>
<li><a class="reference internal" href="#id5">Слушатели событий</a></li>
<li><a class="reference internal" href="#id6">Подписчики событий</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="..\index.html">Документация</a></li>
                
                <li><a href="..\forms.html">Forms</a></li>
                
                <li class="active">События формы</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>События формы<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Компонент Формы предоставляет структурированный процесс, чтобы позволить вам
настроить ваши формы, используя <a class="reference internal" href="..\components\event_dispatcher.html"><em>компонент EventDispatcher</em></a>.
Используя события формы, вы можете изменять информацию или поля на разных этапах
рабочего процесса: от наполнения формы до отправи данных из запроса.</p>
<p>Регистрирование слушателя событий очень простое при использовании компонента Формы.</p>
<p>Например, если вы хотите зарегистрировать функцию в событии
<tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt>, следующий код позволяет вам добавить поле,
в зависимости от значений запроса:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormEvents</span><span class="p">;</span>

<span class="nv">$listener</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nx">FormEvent</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">};</span>

<span class="nv">$form</span> <span class="o">=</span> <span class="nv">$formFactory</span><span class="o">-&gt;</span><span class="na">createBuilder</span><span class="p">()</span>
    <span class="c1">// ... добавить поля формы</span>
    <span class="o">-&gt;</span><span class="na">addEventListener</span><span class="p">(</span><span class="nx">FormEvents</span><span class="o">::</span><span class="na">PRE_SUBMIT</span><span class="p">,</span> <span class="nv">$listener</span><span class="p">);</span>

<span class="c1">// ...</span>
</pre></div>
</td></tr></table></div></div>
<div class="section" id="id2">
<h2>Рабочий процесс формы<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Рабочий процесс отправки формы<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/general_flow.png" class="align-center" src="..\_images\general_flow.png">
</div>
<div class="section" id="formevents-pre-set-data-formevents-post-set-data">
<h3>1) Предварительное заполнение формы (<tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt> и <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt>)<a class="headerlink" href="#formevents-pre-set-data-formevents-post-set-data" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/set_data_flow.png" class="align-center" src="..\_images\set_data_flow.png">
<p>Во время предварительного заполнения формы, развёртываются два события,
когда вызывается метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html#method_setData" title="Symfony\Component\Form\Form::setData()">Form::setData()</a></code></tt>:
<tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt> и <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt>.</p>
<div class="section" id="a-formevents-pre-set-data">
<h4>A) Событие <tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt><a class="headerlink" href="#a-formevents-pre-set-data" title="Permalink to this headline">¶</a></h4>
<p>Событие <tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt> развёртывается в начале метода <tt class="docutils literal"><code>Form::setData()</code></tt>.
Оно может быть использовано для:</p>
<ul class="simple">
<li>Изменения данных, предоставленных во время предварительного заполнения;</li>
<li>Изменения формы, в зависимости от данных предварительного заполнения
(динамическое добавление или удаление полей).</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="75%">
<col width="25%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Тип данных</th>
<th class="head">Значение</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Модельные данные</td>
<td><tt class="docutils literal"><code>null</code></tt></td>
</tr>
<tr class="row-odd"><td>Нормализованные данные</td>
<td><tt class="docutils literal"><code>null</code></tt></td>
</tr>
<tr class="row-even"><td>Данные просмотра</td>
<td><tt class="docutils literal"><code>null</code></tt></td>
</tr>
</tbody>
</table>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">Увидеть все события форм одномоментно вы можете в
<a class="reference internal" href="events.html#component-form-event-table"><span>Информационной таблице о событиях форм</span></a>.</div></div>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">Во время <tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt>,
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html#method_setData" title="Symfony\Component\Form\Form::setData()">Form::setData()</a></code></tt>
заблокирован и будет выдавать исключение при использовании. Если вы хотите
измеить данные, вместо этого вам стоит использовать
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/FormEvent.html#method_setData" title="Symfony\Component\Form\FormEvent::setData()">FormEvent::setData()</a></code></tt>.</p>
</div></div>
<div class="admonition-wrapper">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title"><tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt> в компоненте Формы</p>
<p class="last">Тип формы <tt class="docutils literal"><code>Symfony\Component\Form\Extension\Core\Type\CollectionType</code></tt> полагается
на подписчика <tt class="docutils literal"><code>Symfony\Component\Form\Extension\Core\EventListener\ResizeFormListener</code></tt>,
слушающего событие <tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt> для того, чтобы переупорядочить
поля формы, в зависимости от данных из объекта редварительного заполнения, путём
удаления или добавления всех строк формы.</p>
</div></div>
</div>
<div class="section" id="b-formevents-post-set-data">
<h4>B) Событие <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt><a class="headerlink" href="#b-formevents-post-set-data" title="Permalink to this headline">¶</a></h4>
<p>Событие <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt> развёртывается в конце метода
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html#method_setData" title="Symfony\Component\Form\Form::setData()">Form::setData()</a></code></tt>.
Это событие в основном предназначено для чтения данных после предварительного
заполнения формы.</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%">
<col width="76%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Тип данных</th>
<th class="head">Значение</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Модельные данные</td>
<td>Внедрённые модельные данные</td>
</tr>
<tr class="row-odd"><td>Нормализованные данные</td>
<td>Модельные данные, преобразованные с помощью модельного преобразователя</td>
</tr>
<tr class="row-even"><td>Данные просмотра</td>
<td>Нормализованные данные, преобразованные с помощью преобразователя просмотра</td>
</tr>
</tbody>
</table>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">Увидеть все события форм одномоментно вы можете в
<a class="reference internal" href="events.html#component-form-event-table"><span>Информационной таблице о событиях форм</span></a>.</div></div>
<div class="admonition-wrapper">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title"><tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt> в компоненте Формы</p>
<p class="last">Класс <tt class="docutils literal"><code>Symfony\Component\Form\Extension\DataCollector\EventListener\DataCollectorListener</code></tt>
подписан для прослушивания события <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt>, чтобы
собирать информацию о формах из денормализированных модельных данных и
данных просмотра.</p>
</div></div>
</div>
</div>
<div class="section" id="formevents-pre-submit-formevents-submit-formevents-post-submit">
<h3>2) Отправка формы (<tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt>, <tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt> и <tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt>)<a class="headerlink" href="#formevents-pre-submit-formevents-submit-formevents-post-submit" title="Permalink to this headline">¶</a></h3>
<img alt="../_images/submission_flow.png" class="align-center" src="..\_images\submission_flow.png">
<p>При вызове метода
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html#method_handleRequest" title="Symfony\Component\Form\Form::handleRequest()">Form::handleRequest()</a></code></tt>
или <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html#method_submit" title="Symfony\Component\Form\Form::submit()">Form::submit()</a></code></tt>,
развёртываются три события: <tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt>, <tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt>,
<tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt>.</p>
<div class="section" id="a-formevents-pre-submit">
<h4>A) Событие <tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt><a class="headerlink" href="#a-formevents-pre-submit" title="Permalink to this headline">¶</a></h4>
<p>Событие <tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt> развёртывается в начале метода
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html#method_submit" title="Symfony\Component\Form\Form::submit()">Form::submit()</a></code></tt>.</p>
<p>Оно может быть использовано для:</p>
<ul class="simple">
<li>Изменения данных из запроса, до отправки данных в форму;</li>
<li>Добавления или удаления полей формы,до отправки данных в форму.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%">
<col width="65%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Тип данных</th>
<th class="head">Значение</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Модельные данные</td>
<td>Такое же, как в <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt></td>
</tr>
<tr class="row-odd"><td>Нормализованные данные</td>
<td>Такое же, как в <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt></td>
</tr>
<tr class="row-even"><td>Данные просмотра</td>
<td>Такое же, как в <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt></td>
</tr>
</tbody>
</table>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">Увидеть все события форм одномоментно вы можете в
<a class="reference internal" href="events.html#component-form-event-table"><span>Информационной таблице о событиях форм</span></a>.</div></div>
<div class="admonition-wrapper">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title"><tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt> в компоненте Формы</p>
<p class="last">Подписчик <tt class="docutils literal"><code>Symfony\Component\Form\Extension\Core\EventListener\TrimListener</code></tt>
подписывается на событие <tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt>, чтобы обрезать данные запроса
(для значений строк).
Подписчик <tt class="docutils literal"><code>Symfony\Component\Form\Extension\Csrf\EventListener\CsrfValidationListener</code></tt>
подписывается на событие <tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt>, чтобы валидировать CSRF-токен.</p>
</div></div>
</div>
<div class="section" id="b-formevents-submit">
<h4>B) Событие <tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt><a class="headerlink" href="#b-formevents-submit" title="Permalink to this headline">¶</a></h4>
<p>Событие <tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt> развёртывается прямо перед тем, как метод
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html#method_submit" title="Symfony\Component\Form\Form::submit()">Form::submit()</a></code></tt> преобразует
нормализированные данные в модельные данные и данные просмотра.</p>
<p>Оно может быть использовано для изменения данных из нормализированного представления
данных.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%">
<col width="79%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Тип данных</th>
<th class="head">Значение</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Модельные данные</td>
<td>Такое же, как в <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt></td>
</tr>
<tr class="row-odd"><td>Нормализованные данные</td>
<td>Данные из запроса обратно преобразованные из запроса с использованием преобразователя</td>
</tr>
<tr class="row-even"><td>Данные просмотра</td>
<td>Такое же, как в <tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt></td>
</tr>
</tbody>
</table>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">Увидеть все события форм одномоментно вы можете в
<a class="reference internal" href="events.html#component-form-event-table"><span>Информационной таблице о событиях форм</span></a>.</div></div>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">На этом этапе вы не можете добавлять или удалять поля из формы.</p>
</div></div>
<div class="admonition-wrapper">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title"><tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt> в компоненте Формы</p>
<p class="last"><tt class="docutils literal"><code>Symfony\Component\Form\Extension\Core\EventListener\FixUrlProtocolListener</code></tt>
подписывается на событие <tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt>, чтобы добавить протокол по
умолчаниюк полям URL, которые были отправлены без протокола.</p>
</div></div>
</div>
<div class="section" id="c-formevents-post-submit">
<h4>C) Событие <tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt><a class="headerlink" href="#c-formevents-post-submit" title="Permalink to this headline">¶</a></h4>
<p>Событие <tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt> развёртывается после
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/Form.html#method_submit" title="Symfony\Component\Form\Form::submit()">Form::submit()</a></code></tt>, когда
были денормализированы модельные данные и данные просмотра.</p>
<p>Оно может быть использовано, чтобы извлекать данные после денормализации.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%">
<col width="77%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Тип данных</th>
<th class="head">Значение</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Модельные данные</td>
<td>Нормализованные данные обратно преобразованные с помощью преобразователя модели</td>
</tr>
<tr class="row-odd"><td>Нормализованные данные</td>
<td>Такое же, как в <tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt></td>
</tr>
<tr class="row-even"><td>Данные просмотра</td>
<td>Нормализованные данные преобразованные с помощью преобразователя просмотра</td>
</tr>
</tbody>
</table>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">Увидеть все события форм одномоментно вы можете в
<a class="reference internal" href="events.html#component-form-event-table"><span>Информационной таблице о событиях форм</span></a>.</div></div>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">На этом этапе вы не можете добавлять или удалять поля из формы.</p>
</div></div>
<div class="admonition-wrapper">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title"><tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt> в компоненте Формы</p>
<p class="last"><tt class="docutils literal"><code>Symfony\Component\Form\Extension\DataCollector\EventListener\DataCollectorListener</code></tt>
подписывается на событие <tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt>, чтобы собирать информацию о
формах.
<tt class="docutils literal"><code>Symfony\Component\Form\Extension\Validator\EventListener\ValidationListener</code></tt>
подписывается на событие <tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt>, чтобы автоматически валидировать
денормализованный объект.</p>
</div></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h2>Регистрация слушателей или подписчиков событий<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Для того, чтобы иметь возможность использовать события формы, вам нужно создать
слушателя или подписчика событий и зарегистрировать его в событии.</p>
<p>Имя каждого события &quot;формы&quot; определяется как константа в классе
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/FormEvents.html" title="Symfony\Component\Form\FormEvents">FormEvents</a></code></tt>. Дополнительно,
каждому обратному вызову события (метод слушателя или подписчика)
передаётся один аргумент, который является экземпляром класса
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Form/FormEvent.html" title="Symfony\Component\Form\FormEvent">FormEvent</a></code></tt>. Объект события содержит
ссылку на текущее состояние формы и текущие данные, которые обрабатываются.</p>
<table border="1" class="docutils" id="component-form-event-table-ru">
<colgroup>
<col width="30%">
<col width="40%">
<col width="30%">
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Имя</th>
<th class="head">Константа <tt class="docutils literal"><code>FormEvents</code></tt></th>
<th class="head">Данные события</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><code>form.pre_set_data</code></tt></td>
<td><tt class="docutils literal"><code>FormEvents::PRE_SET_DATA</code></tt></td>
<td>Модельные данные</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><code>form.post_set_data</code></tt></td>
<td><tt class="docutils literal"><code>FormEvents::POST_SET_DATA</code></tt></td>
<td>Модельные данные</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><code>form.pre_bind</code></tt></td>
<td><tt class="docutils literal"><code>FormEvents::PRE_SUBMIT</code></tt></td>
<td>Данные запроса</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><code>form.bind</code></tt></td>
<td><tt class="docutils literal"><code>FormEvents::SUBMIT</code></tt></td>
<td>Нормализованные данные</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><code>form.post_bind</code></tt></td>
<td><tt class="docutils literal"><code>FormEvents::POST_SUBMIT</code></tt></td>
<td>Данные просмотра</td>
</tr>
</tbody>
</table>
<div class="section" id="id5">
<h3>Слушатели событий<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Слушатель событий может быть любым типом валидного вызываемого.</p>
<p>Создание и привязка слушателя собыйти - это очень просто:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormEvents</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\TextType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\CheckboxType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\EmailType</span><span class="p">;</span>

<span class="nv">$form</span> <span class="o">=</span> <span class="nv">$formFactory</span><span class="o">-&gt;</span><span class="na">createBuilder</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;show_email&#39;</span><span class="p">,</span> <span class="nx">CheckboxType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addEventListener</span><span class="p">(</span><span class="nx">FormEvents</span><span class="o">::</span><span class="na">PRE_SUBMIT</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">FormEvent</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getForm</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Проверяет, выбрал ли пользователь отображать его электронную почту.</span>
        <span class="c1">// Если данные были отправлены ранее, дополнительное значение,</span>
        <span class="c1">// включённое в переменных запроса, должно быть удалено.</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">true</span> <span class="o">===</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;show_email&#39;</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nx">EmailType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]);</span>
            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setData</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">getForm</span><span class="p">();</span>

<span class="c1">// ...</span>
</pre></div>
</td></tr></table></div></div>
<p>Когда вы уже создали класс типа формы, вы можете использовать один из его методов
в качестве обратного вызова для лучшей читаемости:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Form/SubscriptionType.php</span>
<span class="k">namespace</span> <span class="nx">App\Form</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\TextType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\CheckboxType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormEvents</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">SubscriptionType</span> <span class="k">extends</span> <span class="nx">AbstractType</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$builder</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;show_email&#39;</span><span class="p">,</span> <span class="nx">CheckboxType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">addEventListener</span><span class="p">(</span>
                <span class="nx">FormEvents</span><span class="o">::</span><span class="na">PRE_SET_DATA</span><span class="p">,</span>
                <span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="s1">&#39;onPreSetData&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">onPreSetData</span><span class="p">(</span><span class="nx">FormEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id6">
<h3>Подписчики событий<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Подписчики событий имеют разные применения:</p>
<ul class="simple">
<li>Улучшение читаемости;</li>
<li>Прослушивание нескольких событий;</li>
<li>Регруппировка нескольких слушателей внутри одного класса.</li>
</ul>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Form/EventListener/AddEmailFieldListener.php</span>
<span class="k">namespace</span> <span class="nx">App\Form\EventListener</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\EventDispatcher\EventSubscriberInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\FormEvents</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\EmailType</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AddEmailFieldListener</span> <span class="k">implements</span> <span class="nx">EventSubscriberInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getSubscribedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="nx">FormEvents</span><span class="o">::</span><span class="na">PRE_SET_DATA</span> <span class="o">=&gt;</span> <span class="s1">&#39;onPreSetData&#39;</span><span class="p">,</span>
            <span class="nx">FormEvents</span><span class="o">::</span><span class="na">PRE_SUBMIT</span>   <span class="o">=&gt;</span> <span class="s1">&#39;onPreSubmit&#39;</span><span class="p">,</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">onPreSetData</span><span class="p">(</span><span class="nx">FormEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getForm</span><span class="p">();</span>

        <span class="c1">// Проверяет, выбрал ли пользователь из первоначальных данных</span>
        <span class="c1">// отображать свою электронную почту</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">true</span> <span class="o">===</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isShowEmail</span><span class="p">())</span> <span class="p">{</span>
            <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nx">EmailType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">onPreSubmit</span><span class="p">(</span><span class="nx">FormEvent</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">();</span>
        <span class="nv">$form</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getForm</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Проверяет, выбрал ли пользователь отображать свою электронную почту.</span>
        <span class="c1">// Если данные были отправлены ранее, дополнительное значение,</span>
        <span class="c1">// включенное в переменных запроса, должно быть удалено.</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">true</span> <span class="o">===</span> <span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;show_email&#39;</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="nx">EmailType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]);</span>
            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setData</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Для того, чтобы зарегистрировать подписчика событий, используйте метод <tt class="docutils literal"><code>addEventSubscriber()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">App\Form\EventListener\AddEmailFieldListener</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\TextType</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Form\Extension\Core\Type\CheckboxType</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="nv">$form</span> <span class="o">=</span> <span class="nv">$formFactory</span><span class="o">-&gt;</span><span class="na">createBuilder</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nx">TextType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;show_email&#39;</span><span class="p">,</span> <span class="nx">CheckboxType</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">addEventSubscriber</span><span class="p">(</span><span class="k">new</span> <span class="nx">AddEmailFieldListener</span><span class="p">())</span>
    <span class="o">-&gt;</span><span class="na">getForm</span><span class="p">();</span>

<span class="c1">// ...</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
</div>


            </div>

            
            <div class="navigation">
                <a href="events.html">« Form Events</a>
                <span class="separator">|</span>
                <a href="form_collections.html">How to Embed a Collection of Forms »</a>
            </div>
            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>