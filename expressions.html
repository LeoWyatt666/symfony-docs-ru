<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Как использовать выражения в безопасности, маршрутизации, сервисах и валидации &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="_static/" type="text/css">
    <link rel="stylesheet" href="_static\pygments-1.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="index-2.html">

<link rel="stylesheet" href="_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="expressions-r doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\index-49.html">
                    <img src="..\..\_images\header-logo-1.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\_images\support-1.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="index-2.html">Главная</a>
        </li>
    
        <li>
            <a href="components\index-1.html">Компоненты</a>
        </li>
    
        <li>
            <a href="best_practices\index-1.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="quick_tour\index-1.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="reference\index-1.html">Справочник</a>
        </li>
    
        <li>
            <a href="genindex-1.html">Индекс</a>
        </li>
    
        <li>
            <a href="contributing\index-1.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Как использовать выражения в безопасности, маршрутизации, сервисах и валидации</a><ul>
<li><a class="reference internal" href="#expressions-security-ru">Безопасность: Сложный контроль доступа с помощью выражений</a></li>
<li><a class="reference internal" href="#id3">Узнать больше</a></li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\_images\logo-playtini-1.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="index-2.html">Документация</a></li>
                
                <li class="active">Как использовать выражения в безопасности, маршрутизации, сервисах и валидации</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Как использовать выражения в безопасности, маршрутизации, сервисах и валидации<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Symfony имеет мощный компонент <a class="reference internal" href="components\expression_language-1.html"><em>ExpressionLanguage</em></a>.
Он позволяет вам добавлять высоконастраиваемую логику внутри конфигурации.</p>
<p>Фреймворк Symfony использует выражения сразу после установки следующими
способами:</p>
<ul class="simple">
<li><a class="reference internal" href="service_container\expression_language-1.html"><em>Конфигурация сервисов</em></a>;</li>
<li><a class="reference internal" href="routing\conditions-1.html"><em>Условия совпадения маршуртов</em></a>;</li>
<li><span class="xref std std-ref">Проверка безопасности</span> (explained below) and
<a class="reference internal" href="security\access_control-1.html#security-allow-if"><span>доступ к контролю с помощью allow_if</span></a>;</li>
<li><a class="reference internal" href="reference\constraints\Expression-1.html"><em>Валидация</em></a>.</li>
</ul>
<p>Чтобы узнать больше о том, как создавать и работать с выражениями, см.
<a class="reference internal" href="components\expression_language\syntax-1.html"><em>Синтаксис</em></a>.</p>
<div class="section" id="expressions-security-ru">
<span id="id2"></span><h2>Безопасность: Сложный контроль доступа с помощью выражений<a class="headerlink" href="#expressions-security-ru" title="Permalink to this headline">¶</a></h2>
<p>В дополнение к роли вроде <tt class="docutils literal"><code>ROLE_ADMIN</code></tt>, метод <tt class="docutils literal"><code>isGranted()</code></tt> также принимает
объект <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/ExpressionLanguage/Expression.html" title="Symfony\Component\ExpressionLanguage\Expression">Expression</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\ExpressionLanguage\Expression</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="k">new</span> <span class="nx">Expression</span><span class="p">(</span>
        <span class="s1">&#39;&quot;ROLE_ADMIN&quot; in roles or (user and user.isSuperAdmin())&#39;</span>
    <span class="p">));</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>В этом примере, если текущий пользователь имеет <tt class="docutils literal"><code>ROLE_ADMIN</code></tt> или если метод
объекта текущего пользователя <tt class="docutils literal"><code>isSuperAdmin()</code></tt> возвращает <tt class="docutils literal"><code>true</code></tt>, тогда
доступ будет разрешен (примечание: ваш объект пользователя может не иметь метода
<tt class="docutils literal"><code>isSuperAdmin()</code></tt>, этот метод был придуман для данного примера).</p>
<p>Используется выражение, и вы можете узнать больше о синтаксисе языка выражений,
см. <a class="reference internal" href="components\expression_language\syntax-1.html"><em>Синтаксис</em></a>.</p>
<p id="security-expression-variables-ru">Внутри выражения у вас есть доступ к таким переменным:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><code>user</code></tt></dt>
<dd>Объект пользователя (или строка <tt class="docutils literal"><code>anon</code></tt>, если вы не аутентифицированы).</dd>
<dt><tt class="docutils literal"><code>roles</code></tt></dt>
<dd>Массив ролей, которые имеет пользователь, включая
<a class="reference internal" href="security-1.html#security-role-hierarchy"><span>иерархию ролей</span></a>, но не включая атрибуты
<tt class="docutils literal"><code>IS_AUTHENTICATED_*</code></tt> (см. функции ниже).</dd>
<dt><tt class="docutils literal"><code>object</code></tt></dt>
<dd>Объект (если он есть), который передается в качестве второго аргумента <tt class="docutils literal"><code>isGranted()</code></tt>.</dd>
<dt><tt class="docutils literal"><code>token</code></tt></dt>
<dd>Объект метки.</dd>
<dt><tt class="docutils literal"><code>trust_resolver</code></tt></dt>
<dd>Объект <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Security/Core/Authentication/AuthenticationTrustResolverInterface.html" title="Symfony\Component\Security\Core\Authentication\AuthenticationTrustResolverInterface">AuthenticationTrustResolverInterface</a></code></tt>:
вы скорее всего будете использовать функции <tt class="docutils literal"><code>is_*()</code></tt> ниже.</dd>
</dl>
<p>Дополнительно у вас есть доступ ко многим функциям внутри выражения:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><code>is_authenticated</code></tt></dt>
<dd>Возвращает <tt class="docutils literal"><code>true</code></tt> если пользователь аутентифицирован с помощью &quot;запомнить меня&quot; или
аутентифицирован &quot;полностью&quot;, т.е. возвращает &quot;true&quot; если пользователь &quot;выполнил вход&quot;.</dd>
<dt><tt class="docutils literal"><code>is_anonymous</code></tt></dt>
<dd>Приравнивается к использованию <tt class="docutils literal"><code>IS_AUTHENTICATED_ANONYMOUSLY</code></tt> с функцией <tt class="docutils literal"><code>isGranted()</code></tt>.</dd>
<dt><tt class="docutils literal"><code>is_remember_me</code></tt></dt>
<dd>Схоже, но не равно <tt class="docutils literal"><code>IS_AUTHENTICATED_REMEMBERED</code></tt>, см. ниже.</dd>
<dt><tt class="docutils literal"><code>is_fully_authenticated</code></tt></dt>
<dd>Схоже, но не равно <tt class="docutils literal"><code>IS_AUTHENTICATED_FULLY</code></tt>, см. ниже.</dd>
<dt><tt class="docutils literal"><code>has_role</code></tt></dt>
<dd>Проверяет, есть ли у пользователя роль - эквивалент выражения вроде <tt class="docutils literal"><code>'ROLE_ADMIN' in roles</code></tt>.</dd>
</dl>
<div class="admonition-wrapper">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title"><tt class="docutils literal"><code>is_remember_me</code></tt> отличается от проверки <tt class="docutils literal"><code>IS_AUTHENTICATED_REMEMBERED</code></tt></p>
<p>Функции <tt class="docutils literal"><code>is_remember_me()</code></tt> и <tt class="docutils literal"><code>is_authenticated_fully()</code></tt> <em>похожи</em> на использование
<tt class="docutils literal"><code>IS_AUTHENTICATED_REMEMBERED</code></tt> и <tt class="docutils literal"><code>IS_AUTHENTICATED_FULLY</code></tt> с функцией <tt class="docutils literal"><code>isGranted()</code></tt>,
но они <strong>не</strong> одинаковы. Ниженаписанное демонстрирует отличие:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\ExpressionLanguage\Expression</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="nv">$ac</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.authorization_checker&#39;</span><span class="p">);</span>
<span class="nv">$access1</span> <span class="o">=</span> <span class="nv">$ac</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;IS_AUTHENTICATED_REMEMBERED&#39;</span><span class="p">);</span>

<span class="nv">$access2</span> <span class="o">=</span> <span class="nv">$ac</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="k">new</span> <span class="nx">Expression</span><span class="p">(</span>
    <span class="s1">&#39;is_remember_me() or is_fully_authenticated()&#39;</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p class="last">Здесь, <tt class="docutils literal"><code>$access1</code></tt> м <tt class="docutils literal"><code>$access2</code></tt> будут иметь одинаковое значениe. В отличие от
поведения <tt class="docutils literal"><code>IS_AUTHENTICATED_REMEMBERED</code></tt> и <tt class="docutils literal"><code>IS_AUTHENTICATED_FULLY</code></tt>, функция
<tt class="docutils literal"><code>is_remember_me()</code></tt> возвращает &quot;true&quot; <em>только</em> если пользователь аутентифицирован
с помощью cookie &quot;запомнить меня&quot;, а <tt class="docutils literal"><code>is_fully_authenticated</code></tt> возвращает &quot;true&quot;
<em>только</em> если пользователь действительно выполнил вход в течение этой сессии (т.е.
является полноценным).</p>
</div></div>
</div>
<div class="section" id="id3">
<h2>Узнать больше<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="service_container\expression_language-1.html"><em>How to Inject Values Based on Complex Expressions</em></a></li>
<li><a class="reference internal" href="reference\constraints\Expression-1.html"><em>Expression</em></a></li>
</ul>
</div>
</div>


            </div>

            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>