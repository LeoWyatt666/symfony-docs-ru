<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Контроллер &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="_static/" type="text/css">
    <link rel="stylesheet" href="_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="index.html">

<link rel="stylesheet" href="_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="controller-r doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\index.html">
                    <img src="..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="index.html">Главная</a>
        </li>
    
        <li>
            <a href="components\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Контроллер</a><ul>
<li><a class="reference internal" href="#index-1">Простой контроллер</a><ul>
<li><a class="reference internal" href="#url">Связывание URL с контроллером</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-base-controller-class-services-ru">Базовый класс контроллера и сервисы</a><ul>
<li><a class="reference internal" href="#index-4">Генерирование URL</a></li>
<li><a class="reference internal" href="#id5">Перенаправление</a></li>
<li><a class="reference internal" href="#controller-rendering-templates-ru">Отображение шаблонов</a></li>
<li><a class="reference internal" href="#accessing-other-services-ru">Получение сервисов</a></li>
</ul>
</li>
<li><a class="reference internal" href="#index-7">Управление ошибками и 404 страницами</a></li>
<li><a class="reference internal" href="#request">Объект Request в качестве аргумента контроллера</a></li>
<li><a class="reference internal" href="#session-intro-ru">Управление сессиями</a><ul>
<li><a class="reference internal" href="#flash">Flash-сообщения</a></li>
</ul>
</li>
<li><a class="reference internal" href="#request-response">Объекты Request и Response</a><ul>
<li><a class="reference internal" href="#json">Возвращение JSON-ответов</a></li>
<li><a class="reference internal" href="#id10">Потоковая передача ответов файла</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">Заключение</a></li>
<li><a class="reference internal" href="#id12">Продолжайте!</a></li>
<li><a class="reference internal" href="#id13">Узнайте больше о контроллерах</a><ul>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="index.html">Документация</a></li>
                
                <li class="active">Контроллер</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Контроллер<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Контроллер - это PHP-функция, созданная вами, которая на основании объекта <tt class="docutils literal"><code>Request</code></tt>
создает и возвращает объект <tt class="docutils literal"><code>Response</code></tt>. Ответ может быть HTML-страницей,
документом XML, сериализованным JSON-массивом, изображением, редиректом, ошибкой 404
или чем-либо другим. Контроллер может содержать любую, совершенно произвольную логику,
с помощью которой <em>ваше приложение</em> отображает содержимое страницы.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Если вы еще не создали свою первую рабочую страницу, просмотрте главу
<a class="reference internal" href="page_creation.html"><em>создание страницы</em></a> и потом возвращайтесь!</p>
</div></div>
<div class="section" id="index-1">
<span id="id2"></span><h2>Простой контроллер<a class="headerlink" href="#index-1" title="Permalink to this headline">¶</a></h2>
<p>В то время как контроллер может быть любой PHP-сущностью (функцией,
методом объекта или <tt class="docutils literal"><code>Closure</code></tt>), обычно контроллер - это метод внутри класса контроллера:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Controller/LuckyController.php</span>
<span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LuckyController</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/lucky/number/{max}&quot;, name=&quot;app_lucky_number&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">number</span><span class="p">(</span><span class="nv">$max</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$number</span> <span class="o">=</span> <span class="nb">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$max</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span>
            <span class="s1">&#39;&lt;html&gt;&lt;body&gt;Lucky number: &#39;</span><span class="o">.</span><span class="nv">$number</span><span class="o">.</span><span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Контроллер - это метод <tt class="docutils literal"><code>number()</code></tt>, который расположен внутри класса
контроллера <tt class="docutils literal"><code>LuckyController</code></tt>.</p>
<p>Этот контроллер достаточно прямолинеен:</p>
<ul class="simple">
<li><em>Строчка 2</em>: Symfony использует преимущества пространства имён PHP,
чтобы указать пространство имён для класса контроллера.</li>
<li><em>Строчка 4</em>: Symfony снова использует преимущества пространства имён PHP:
ключевое слово <tt class="docutils literal"><code>use</code></tt> импортирует класс <tt class="docutils literal"><code>Response</code></tt>, который должен вернуть
контроллер.</li>
<li><em>Строчка 7</em>: Технически, класс можно назвать как угодно, но по соглашению, он
должен иметь суффикс <tt class="docutils literal"><code>Controller</code></tt>.</li>
<li><em>Строчка 12</em>: Методу действия разрешено иметь аргумент <tt class="docutils literal"><code>$max</code></tt> благодаря
<a class="reference internal" href="routing.html"><em>символу подстановки в маршруте</em></a> <tt class="docutils literal"><code>{max}</code></tt>.</li>
<li><em>Строчка 16</em>: Контроллер создает и возвращает объект  <tt class="docutils literal"><code>Response</code></tt>.</li>
</ul>
<div class="section" id="url">
<span id="index-2"></span><h3>Связывание URL с контроллером<a class="headerlink" href="#url" title="Permalink to this headline">¶</a></h3>
<p>Для того, чтобы <em>увидеть</em> результат этого контроллера, вам понадобится привязать
URL к нему с помощью маршрута. Это было сделано выше с помощью
<a class="reference internal" href="page_creation.html#annotation-routes"><span>аннотации маршрута</span></a> <tt class="docutils literal"><code>&#64;Route(&quot;/lucky/number/{max}&quot;)</code></tt>.</p>
<p>Чтобы увидеть вашу страницу, перейдите на этот URL в вашем браузере:</p>
<blockquote>
<div><a class="reference external" href="http://localhost:8000/lucky/number/100">http://localhost:8000/lucky/number/100</a></div></blockquote>
<p>Для того, чтобы узнать больше о маршрутизации, см. главу <a class="reference internal" href="routing.html"><em>Маршрутизация</em></a>.</p>
</div>
</div>
<div class="section" id="the-base-controller-class-services-ru">
<span id="index-3"></span><span id="id3"></span><h2>Базовый класс контроллера и сервисы<a class="headerlink" href="#the-base-controller-class-services-ru" title="Permalink to this headline">¶</a></h2>
<p>Чтобы жизнь была лучше, Symfony включает в себя два опциональных базовых класса
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Bundle/FrameworkBundle/Controller/Controller.html" title="Symfony\Bundle\FrameworkBundle\Controller\Controller">Controller</a></code></tt> и
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Bundle/FrameworkBundle/Controller/AbstractController.html" title="Symfony\Bundle\FrameworkBundle\Controller\AbstractController">AbstractController</a></code></tt>. Вы
можете расширить любой из них, чтобы получить доступ <a class="reference external" href="https://github.com/symfony/symfony/blob/master/src/Symfony/Bundle/FrameworkBundle/Controller/ControllerTrait.php">методам-помощникам</a>.</p>
<p>Добавьте выражение <tt class="docutils literal"><code>use</code></tt> сверху класса <tt class="docutils literal"><code>Controller</code></tt> и потом измените
<tt class="docutils literal"><code>LuckyController</code></tt>, чтобы расширить его:</p>
<div class="literal-block"><div class="highlight-diff"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span>// src/Controller/LuckyController.php
namespace App\Controller;

<span class="gi">+ use Symfony\Bundle\FrameworkBundle\Controller\Controller;</span>

<span class="gd">- class LuckyController</span>
<span class="gi">+ class LuckyController extends Controller</span>
{
    // ...
}
</pre></div>
</td></tr></table></div></div>
<p>Вот и все! Теперь у вас есть доступ к таким методам как
<a class="reference internal" href="controller.html#controller-rendering-templates"><span>$this-&gt;render()</span></a> и многим другим,
о которых вы узнаете далее.</p>
<div class="admonition-wrapper" id="controller-abstract-versus-controller-ru">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">В чём разница между <tt class="docutils literal"><code>Controller</code></tt> и <tt class="docutils literal"><code>AbstractController</code></tt>? Она небольшая:
оба идентичны, только <tt class="docutils literal"><code>AbstractController</code></tt> более ограниченный - он не позволяет
вам получить доступ к сервисам напрямую через <tt class="docutils literal"><code>$this-&gt;get()</code></tt> или
<tt class="docutils literal"><code>$this-&gt;container-&gt;get()</code></tt>. Это заставляет вас писать более обширный код, чтобы
получить доступ к сервисам. Но если вам <em>нужен</em> прямой доступ к контейнеру, вы
можете использовать <tt class="docutils literal"><code>Controller</code></tt>.</p>
</div></div>
<div class="section" id="index-4">
<span id="id4"></span><h3>Генерирование URL<a class="headerlink" href="#index-4" title="Permalink to this headline">¶</a></h3>
<p>Метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Bundle/FrameworkBundle/Controller/Controller.html#method_generateUrl" title="Symfony\Bundle\FrameworkBundle\Controller\Controller::generateUrl()">generateUrl()</a></code></tt> -
это просто метод-помощник, который генерирует URL для заданного маршрута:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$url</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">&#39;app_lucky_number&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;max&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id5">
<h3>Перенаправление<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Если вы хотите перенаправить пользователя на другую страницу, используйте методы</dt>
<dd><p class="first"><tt class="docutils literal"><code>redirectToRoute()</code></tt> и <tt class="docutils literal"><code>redirect()</code></tt>:</p>
<div class="literal-block"><div class="last highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\RedirectResponse</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// пенеправить по маршруту &quot;homepage&quot;</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;homepage&#39;</span><span class="p">);</span>

    <span class="c1">// redirectToRoute - это ярлык для:</span>
    <span class="c1">// вернуть новый RedirectResponse($this-&gt;generateUrl(&#39;homepage&#39;));</span>

    <span class="c1">// совершить постоянное перенаправление - 301</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;homepage&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="mi">301</span><span class="p">);</span>

    <span class="c1">// перенаправить по маршруту с параметрами</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="s1">&#39;app_lucky_number&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;max&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">));</span>

    <span class="c1">// перенаправляет внутренне</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="s1">&#39;http://symfony.com/doc&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</dd>
</dl>
<p>Чтобы узнать больше, см. статью <a class="reference internal" href="routing.html"><em>Маршрутизация</em></a>.</p>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">Метод <tt class="docutils literal"><code>redirect()</code></tt> никак не проверяет свое место назначеня. Если вы перенаправляете
по URL, предоставленному конечными пользователями, ваше приложение может быть
открыто к <a class="reference external" href="https://www.owasp.org/index.php/Open_redirect">уязвимости безопасности невалидированных редиректов</a>.</p>
</div></div>
</div>
<div class="section" id="controller-rendering-templates-ru">
<span id="index-5"></span><span id="id6"></span><h3>Отображение шаблонов<a class="headerlink" href="#controller-rendering-templates-ru" title="Permalink to this headline">¶</a></h3>
<p>Если вы работате с HTML, вам пригодится умение отображать шаблоны.
Метод <tt class="docutils literal"><code>render()</code></tt> отображает шаблон <strong>и</strong> помещает его содержимое в объект
<tt class="docutils literal"><code>Response</code></tt> для вашего удобства:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// отображает templates/lucky/number.html.twig</span>
<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;lucky/number.html.twig&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>Шаблонизирование и Twig обяснены в статье <a class="reference internal" href="templating.html"><em>Создание и использование шаблонов</em></a>.</p>
</div>
<div class="section" id="accessing-other-services-ru">
<span id="controller-accessing-services-ru"></span><span id="index-6"></span><span id="id7"></span><h3>Получение сервисов<a class="headerlink" href="#accessing-other-services-ru" title="Permalink to this headline">¶</a></h3>
<p>Symfony по умолчанию <em>наполнена</em> большим количеством полезных объектов, называемых
<a class="reference internal" href="service_container.html"><em>сервисами</em></a>. Они используются для отображения шаблонов, отправки
email'ов, запросов к базе данных и любой другой &quot;работы&quot;, которую вы можете себе
представить.</p>
<p>Если вам нужен сервис в контроллере, просто укажите класс или интерфейс аргумента.
Symfony автоматически передаст вам необходимый сервис:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Psr\Log\LoggerInterface</span>
<span class="c1">// ...</span>

<span class="sd">/**</span>
<span class="sd"> * @Route(&quot;/lucky/number/{max}&quot;)</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">number</span><span class="p">(</span><span class="nv">$max</span><span class="p">,</span> <span class="nx">LoggerInterface</span> <span class="nv">$logger</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$logger</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;We are logging!&#39;</span><span class="p">);</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Отлично!</p>
<p>Какие еще сервисы можно подключить с помощью указания типа? Чтобы увидеть их,
запустите консольную команду <tt class="docutils literal"><code>debug:autowiring</code></tt>:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> php bin/console debug:autowiring
</pre></div>
</td></tr></table></div></div>
<p>Если вам необходим контроль над <em>точным</em> значением аргумента, вы можете <a class="reference internal" href="service_container.html#services-binding"><span>cвязать</span></a>
аргумент с его именем:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/services.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="c1"># ясно сконфигурировать сервис</span>
    <span class="l l-Scalar l-Scalar-Plain">App\Controller\LuckyController</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">public</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="l l-Scalar l-Scalar-Plain">bind</span><span class="p p-Indicator">:</span>
            <span class="c1"># for any $logger argument, pass this specific service</span>
            <span class="l l-Scalar l-Scalar-Plain">$logger</span><span class="p p-Indicator">:</span> <span class="s">&#39;@monolog.logger.doctrine&#39;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/services.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="c">&lt;!-- Ясно сконфигурировать сервис --&gt;</span>
        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;App\Controller\LuckyController&quot;</span> <span class="na">public=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;bind</span> <span class="na">key=</span><span class="s">&quot;$logger&quot;</span>
                <span class="na">type=</span><span class="s">&quot;service&quot;</span>
                <span class="na">id=</span><span class="s">&quot;monolog.logger.doctrine&quot;</span>
            <span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/services.php</span>
<span class="k">use</span> <span class="nx">App\Controller\LuckyController</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\DependencyInjection\Reference</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="nx">LuckyController</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setPublic</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setBindings</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;$logger&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">Reference</span><span class="p">(</span><span class="s1">&#39;monolog.logger.doctrine&#39;</span><span class="p">),</span>
    <span class="p">))</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Конечно же вы можете использовать обычное <a class="reference internal" href="service_container.html#services-constructor-injection"><span>внедрение через конструктор</span></a> в ваших контроллерах.</p>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">Вы можете передавать <em>сервисы</em> вашим аргументам контроллера <em>только</em> этим способом.
Невозможно, к примеру, передать параметр сервиса в качестве аргумента контроллера,
даже используя <tt class="docutils literal"><code>bind</code></tt>. Если вам нужен параметр, используйте сокращение
<tt class="docutils literal"><code>$this-&gt;getParameter('kernel.debug')</code></tt> или передайте значение через метод вашего
контроллера <tt class="docutils literal"><code>__construct()</code></tt> и укажите его значение с <tt class="docutils literal"><code>bind</code></tt>.</p>
</div></div>
<p>Чтобы узнать больше о сервисах, см. статью <a class="reference internal" href="service_container.html"><em>Service Container</em></a>.</p>
</div>
</div>
<div class="section" id="index-7">
<span id="id8"></span><h2>Управление ошибками и 404 страницами<a class="headerlink" href="#index-7" title="Permalink to this headline">¶</a></h2>
<p>Когда что-то не найдено, вы должны вернуть ответ 404. Чтобы сделать это, вызовите
специальный тип исключения:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Exception\NotFoundHttpException</span><span class="p">;</span>

<span class="c1">// ...</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// извлечь объект из БД</span>
    <span class="nv">$product</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$product</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createNotFoundException</span><span class="p">(</span><span class="s1">&#39;The product does not exist&#39;</span><span class="p">);</span>

        <span class="c1">// вышенаписанное - просто сокращение для:</span>
        <span class="c1">// вызвать новый NotFoundHttpException(&#39;Продукт не существует&#39;);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Bundle/FrameworkBundle/Controller/ControllerTrait.html#method_createNotFoundException" title="Symfony\Bundle\FrameworkBundle\Controller\ControllerTrait::createNotFoundException()">createNotFoundException()</a></code></tt>
- это лишь сокращение для создания специального объекта <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpKernel/Exception/NotFoundHttpException.html" title="Symfony\Component\HttpKernel\Exception\NotFoundHttpException">NotFoundHttpException</a></code></tt>,
который в конечном счете запускает ответ 404 внутри Symfony.</p>
<p>Конечно же, вы можете использовать любой класс <tt class="docutils literal"><code>Exception</code></tt> в вашем
контроллере - Symfony автоматически вернет HTTP-код ответа 500.</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s1">&#39;Something went wrong!&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>В обоих случаях, конечному пользователю отображается страница ошибки, а
разработчику отображается полная страница отладки ошибки (например, когда
вы в режиме &quot;отладки&quot; - см. <a class="reference internal" href="configuration.html#page-creation-environments"><span>The parameters Key: Parameters (Variables)</span></a>).</p>
<p>Чтобы настроить страницу ошибки, отображаемую пользователю, см. статью
<a class="reference internal" href="controller\error_pages.html"><em>How to Customize Error Pages</em></a>.</p>
</div>
<div class="section" id="request">
<span id="controller-request-argument-ru"></span><h2>Объект Request в качестве аргумента контроллера<a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h2>
<p>Что вы будете делать, если вам понадобится узнать параметры запроса, заголовок
запроса или получить доступ к загруженному файлу? Вся эта информация в Symfony
содержится в объекте <tt class="docutils literal"><code>Request</code></tt>. Чтобы получить доступ к этой информации в контроллере,
просто добавьте его в качестве аргумента и <strong>выполните типизирование по классу Request</strong>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$firstName</span><span class="p">,</span> <span class="nv">$lastName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$page</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p><a class="reference internal" href="controller.html#request-object-info"><span>Продолжайте читать</span></a> для более детальной
информации об использовании объекта Request.</p>
</div>
<div class="section" id="session-intro-ru">
<span id="index-8"></span><span id="id9"></span><h2>Управление сессиями<a class="headerlink" href="#session-intro-ru" title="Permalink to this headline">¶</a></h2>
<p>Symfony предоставляет сервис сессии, который вы можете использовать для
хранения информации о пользователе между запросами. Хранение сессии и другую
конфигурацию можно контролировать в <a class="reference internal" href="reference\configuration\framework.html#config-framework-session"><span>конфигурации framework.session</span></a>.</p>
<p>Для начала, активируйте сессию, убрав комментарий из ключа <tt class="docutils literal"><code>session</code></tt> в
<tt class="docutils literal"><code>config/packages/framework.yaml</code></tt>:</p>
<div class="literal-block"><div class="highlight-diff"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span># config/packages/framework.yaml
framework:
    # ...

<span class="gd">-     #сессия:</span>
<span class="gd">-     #    # Будет использован родной PHP обработчик сессий</span>
<span class="gd">-     #    handler_id: ~</span>
<span class="gi">+     сессия:</span>
<span class="gi">+         # Будет использован родной PHP обработчик сессий</span>
<span class="gi">+         handler_id: ~</span>
    # ...
</pre></div>
</td></tr></table></div></div>
<p>Чтобы получить сессию, добавьте аргумент и типизируйте его с помощью
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Session/SessionInterface.html" title="Symfony\Component\HttpFoundation\Session\SessionInterface">SessionInterface</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Session\SessionInterface</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">SessionInterface</span> <span class="nv">$session</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// сохраняет атрибут для повторного использования во время следующего запроса пользователя</span>
    <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">);</span>

    <span class="c1">// устанавливает атрибут с помощью другого контроллера в другом запросе</span>
    <span class="nv">$foobar</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">);</span>

    <span class="c1">// использует значение по умолчанию, если атрибут не существует</span>
    <span class="nv">$filters</span> <span class="o">=</span> <span class="nv">$session</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;filters&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Сохраненные атрибуты будут соответствовать сессии пользователя до конца этой сессии.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Поддерживаются все реализации <tt class="docutils literal"><code>SessionInterface</code></tt>. Если у вас есть
ваша собственная реализация, типизируйте ее в аргументе.</p>
</div></div>
<p>Чтобы узнать больше, см. <a class="reference internal" href="session.html"><em>Sessions</em></a>.</p>
<div class="section" id="flash">
<span id="index-9"></span><h3>Flash-сообщения<a class="headerlink" href="#flash" title="Permalink to this headline">¶</a></h3>
<p>Также, вы можете сохранять специальные сообщения, которые называют flash-сообщениями,
в пользовательской сессии. Согласно замыслу, flash-сообщения предполагается использовать
один раз: они автоматически исчезают из сессии, как только вы их возвращаете. Эта
особенность делает flash-сообщения особенно удобными для хранения пользовательских оповещений.</p>
<p>Для примера представьте, что вы обрабатываете отправку <a class="reference internal" href="forms.html"><em>формы</em></a>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isSubmitted</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// выполните какую-то обработку</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">addFlash</span><span class="p">(</span>
            <span class="s1">&#39;notice&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Изменения сохранены!&#39;</span>
        <span class="p">);</span>
        <span class="c1">// $this-&gt;addFlash() это эквивалент $request-&gt;getSession()-&gt;getFlashBag()-&gt;add()</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirectToRoute</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="o">...</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>После обработки запроса контроллер устанавливает flash-сообщение в сессии и затем
выполняет редирект. Ключ к сообщению (<tt class="docutils literal"><code>notice</code></tt> в нашем примере) может быть любым:
вы будете его использовать только для того, чтобы получить доступ к самому сообщению.</p>
<p>В шаблоне следующей страницы (или ещё лучше, в вашем базовом шаблоне макета страницы),
прочитайте любое flash-сообщение из сессии используя <tt class="docutils literal"><code>app.flashes()</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">{# templates/base.html.twig #}</span>

<span class="c">{# вы можете прочитать и отобразить только один тип флеш-сообщений... #}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">app.flashes</span><span class="o">(</span><span class="s1">&#39;notice&#39;</span><span class="o">)</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flash-notice&quot;</span><span class="p">&gt;</span>
        <span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>

<span class="c">{# ...или вы можете прочитатьи отобразить все доступные флеш-сообщения #}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">label</span><span class="o">,</span> <span class="nv">messages</span> <span class="k">in</span> <span class="nv">app.flashes</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">for</span> <span class="nv">message</span> <span class="k">in</span> <span class="nv">messages</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flash-</span><span class="cp">{{</span> <span class="nv">label</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
            <span class="cp">{{</span> <span class="nv">message</span> <span class="cp">}}</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-html+php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- templates/base.html.php --&gt;</span>

// вы можете прочитать и отобразить только один тип флеш-сообщений...
<span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getFlashBag</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;notice&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$message</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flash-notice&quot;</span><span class="p">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span> <span class="cp">?&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endforeach</span> <span class="cp">?&gt;</span>

// ...или вы можете прочитатьи отобразить все доступные флеш-сообщения
<span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">getFlashBag</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$type</span> <span class="o">=&gt;</span> <span class="nv">$flash_messages</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$flash_messages</span> <span class="k">as</span> <span class="nv">$flash_message</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flash-</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$type</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="p">&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$message</span> <span class="cp">?&gt;</span>
        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endforeach</span> <span class="cp">?&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endforeach</span> <span class="cp">?&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Общепринятой практикой является использование ключей <tt class="docutils literal"><code>notice</code></tt>, <tt class="docutils literal"><code>warning</code></tt> и
<tt class="docutils literal"><code>error</code></tt> в качестве разных типов flash-сообщений, но вы можете использовать
любой ключ, который вам подходит.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">В качестве альтернативы вы можете использовать метод
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Session/Flash/FlashBagInterface.html#method_peek" title="Symfony\Component\HttpFoundation\Session\Flash\FlashBagInterface::peek()">peek()</a></code></tt>
для того, чтобы получить сообщение, не удаляя его.</p>
</div></div>
</div>
</div>
<div class="section" id="request-response">
<span id="request-object-info-ru"></span><span id="index-10"></span><h2>Объекты Request и Response<a class="headerlink" href="#request-response" title="Permalink to this headline">¶</a></h2>
<p>Как упоминалось <a class="reference internal" href="controller.html#controller-request-argument"><span>ранее</span></a>, Symfony
передаст объект <tt class="docutils literal"><code>Request</code></tt> любому аргументу контроллера, который будет
типизирован по классу <tt class="docutils literal"><code>Request</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isXmlHttpRequest</span><span class="p">();</span> <span class="c1">//  это запрос Ajax?</span>

    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPreferredLanguage</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;fr&#39;</span><span class="p">));</span>

    <span class="c1">// извлекает переменные GET и POST соответственно</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">);</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">);</span>

    <span class="c1">// извлекает переменные SERVER’а</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">server</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">);</span>

    <span class="c1">// извлекает объект UploadedFile по ключу foo</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">files</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

    <span class="c1">// извлекает значение COOKIE</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">cookies</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;PHPSESSID&#39;</span><span class="p">);</span>

    <span class="c1">// извлекает заголовок запроса HTTP с нормализированными ключами строчными буквами</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">);</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>У класса <tt class="docutils literal"><code>Request</code></tt> есть несколько общедоступных свойств и методов, которые
возвращают любую нужную вам информацию о запросе.</p>
<p>Как и у <tt class="docutils literal"><code>Request</code></tt>, у объекта <tt class="docutils literal"><code>Response</code></tt> также есть общедоступное свойство заголовков
(<tt class="docutils literal"><code>headers</code></tt>). Речь идёт об объекте <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ResponseHeaderBag.html" title="Symfony\Component\HttpFoundation\ResponseHeaderBag">ResponseHeaderBag</a></code></tt>,
который содержит методы для чтения и изменения заголовков ответов. Имена заголовков
нормализованны таким образом, чтобы использование <tt class="docutils literal"><code>Content-Type</code></tt> было эквивалентно
использованию <tt class="docutils literal"><code>content-type</code></tt> и даже <tt class="docutils literal"><code>content_type</code></tt>.</p>
<p>Единственное, что требуется от контроллера - это возвращать объект <tt class="docutils literal"><code>Response</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="c1">// создаёт простой Response со статус-кодом 200 (по умолчанию)</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span><span class="o">.</span><span class="nv">$name</span><span class="p">,</span> <span class="nx">Response</span><span class="o">::</span><span class="na">HTTP_OK</span><span class="p">);</span>

<span class="c1">// создаёт CSS-ответ со статус-кодом 200</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;&lt;style&gt; ... &lt;/style&gt;&#39;</span><span class="p">);</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/css&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Существуют специальные классы, которые облегчают некоторые виды ответов. Некоторые из
них описаны ниже. Чтобы узнать больше о <tt class="docutils literal"><code>Request</code></tt> и <tt class="docutils literal"><code>Response</code></tt> (и специальных классах
<tt class="docutils literal"><code>Response</code></tt>), см. <a class="reference internal" href="components\http_foundation.html#component-http-foundation-request"><span>документацию компонента HttpFoundation</span></a>.</p>
<div class="section" id="json">
<h3>Возвращение JSON-ответов<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p>Чтобы вернуть JSON из контроллера, используйте метод помощника <tt class="docutils literal"><code>json()</code></tt>. Он
вернёт специальный объект <tt class="docutils literal"><code>JsonResponse</code></tt>, который автоматически зашифровывает
данные:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// возвращает &#39;{&quot;username&quot;:&quot;jane.doe&quot;}&#39; и устанавливает правильный заголовок Content-Type</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jane.doe&#39;</span><span class="p">));</span>

    <span class="c1">// сокращеиие определяет три необязательных аргумента</span>
    <span class="c1">// вернуть $this-&gt;json($data, $status = 200, $headers = array(), $context = array());</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Если в вашем приложении включен <a class="reference internal" href="serializer.html"><em>сервис сериализации</em></a>,
то он будет использован для сериализации данных в JSON. В обратном случае,
будет использована функция <tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.json-encode.php" title="json_encode">json_encode</a></code></tt>.</p>
</div>
<div class="section" id="id10">
<h3>Потоковая передача ответов файла<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Вы можете использовать помощник <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Bundle/FrameworkBundle/Controller/Controller.html#method_file" title="Symfony\Bundle\FrameworkBundle\Controller\Controller::file()">file()</a></code></tt>,
чтобы подавать файл изнутри контроллера:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">fileAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// отправить содержание файла и заставить браузер скачать его</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;/path/to/some_file.pdf&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Помощник <tt class="docutils literal"><code>file()</code></tt> предоставляет некоторые аргументы, чтобы сконфигурировать его поведение:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\File</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\ResponseHeaderBag</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">fileAction</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// загрузить файл из файловой системы</span>
    <span class="nv">$file</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">File</span><span class="p">(</span><span class="s1">&#39;/path/to/some_file.pdf&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>

    <span class="c1">// переименовать скачанный файл</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s1">&#39;custom_name.pdf&#39;</span><span class="p">);</span>

    <span class="c1">// отобразить содержание файла в браузере вместо скачивания</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">(</span><span class="s1">&#39;invoice_3241.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;my_invoice.pdf&#39;</span><span class="p">,</span> <span class="nx">ResponseHeaderBag</span><span class="o">::</span><span class="na">DISPOSITION_INLINE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="id11">
<h2>Заключение<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<p>Когда вы создаете страницу, вам неизбежно нужно будет написать код, который
бы отображал логику этой страницы. В Symfony эта логика называется контроллером.
Это PHP-функция, используя которую вы можете выполнить любые действия для
возвращения объекта <tt class="docutils literal"><code>Response</code></tt>, который в свою очередь будет отправлен пользователю.</p>
<p>Чтобы упростить себе жизнь, вы можете наследовать класс <tt class="docutils literal"><code>Controller</code></tt>, который
содержит методы-сокращения (как <tt class="docutils literal"><code>render()</code></tt> и <tt class="docutils literal"><code>redirectToRoute()</code></tt>).</p>
<p>В других статьях, вы узнаете, как использовать спецаильные сервисы изнутри вашего
контроллера, что поможет вам сохранять и получать объекты из базы данных, обрабатывать
отправленные формы, работать с кэшем и т.д.</p>
</div>
<div class="section" id="id12">
<h2>Продолжайте!<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>Далее, узнайте все об <a class="reference internal" href="templating.html"><em>Отображении шаблонов с помощью Twig</em></a>.</p>
</div>
<div class="section" id="id13">
<h2>Узнайте больше о контроллерах<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="controller\argument_value_resolver.html">Extending Action Argument Resolving</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller/argument_value_resolver-ru.html">Расширения разрешения аргумента действия</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller\error_pages.html">How to Customize Error Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller/error_pages-ru.html">Как настроить страницы ошибок</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller\forwarding.html">How to Forward Requests to another Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller/forwarding-ru.html">Как пересылать запросы другому контроллеру</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller\service.html">How to Define Controllers as Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller/service-ru.html">Как определять контроллеры как сервисы</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller\soap_web_service.html">How to Create a SOAP Web Service in a Symfony Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller/soap_web_service-ru.html">Как создать SOAP веб-сервис в контроллере Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller\upload_file.html">How to Upload Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="controller/upload_file-ru.html">Как загружать файлы</a></li>
</ul>
</div>
</div>
</div>


            </div>

            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>