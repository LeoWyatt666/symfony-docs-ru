<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Ленивые сервисы &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css">
    <link rel="stylesheet" href="..\_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="..\index.html">
    <link rel="up" title="Service Container" href="..\service_container.html">
    <link rel="next" title="How to Make Service Arguments/References Optional" href="optional_dependencies.html">
    <link rel="prev" title="Lazy Services" href="lazy_services.html">

<link rel="stylesheet" href="..\_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="..\_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="..\_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="service_container doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\..\index.html">
                    <img src="..\..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="..\index.html">Главная</a>
        </li>
    
        <li>
            <a href="..\components\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="..\best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="..\quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="..\reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="..\genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="..\contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Ленивые сервисы</a><ul>
<li><a class="reference internal" href="#id2">Почему ленивые сервисы?</a></li>
<li><a class="reference internal" href="#id3">Установка</a></li>
<li><a class="reference internal" href="#id4">Конфигурация</a></li>
<li><a class="reference internal" href="#id5">Дополнительные источники</a></li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="..\index.html">Документация</a></li>
                
                <li><a href="..\service_container.html">Service Container</a></li>
                
                <li class="active">Ленивые сервисы</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Ленивые сервисы<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">Ещё один способом лениво внедрять сервисы - через <tt class="xref doc docutils literal"><code>настройщик сервисов</code></tt>.</div></div>
<div class="section" id="id2">
<h2>Почему ленивые сервисы?<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>В некоторых случаях, вы можете захотеть внедрить сервис, который немного тяжёлый для
инстанциации, но не всегда используется внутри вашего объекта. Например, представьте,
что у вас есть <tt class="docutils literal"><code>NewsletterManager</code></tt> и вы внедряете в него сервис <tt class="docutils literal"><code>mailer</code></tt>. Только
несколько методов в вашем <tt class="docutils literal"><code>NewsletterManager</code></tt> действительно используют <tt class="docutils literal"><code>mailer</code></tt>,
но даже когда он вам не нужн, сервис <tt class="docutils literal"><code>mailer</code></tt> всегда инстанциируется, чтобы построить
ваш <tt class="docutils literal"><code>NewsletterManager</code></tt>.</p>
<p>Решением этого являются ленивые сервисы. С ленивым сервисом на самом деле
внедряется &quot;прокси&quot; сервиса <tt class="docutils literal"><code>mailer</code></tt>. Он выглядит и ведёт себя точно так
же, как <tt class="docutils literal"><code>mailer</code></tt>, кроме того, что <tt class="docutils literal"><code>mailer</code></tt> на самом деле не инстанциируется
до того, как вы начнёте какое-либо взаимодействие с прокси.</p>
</div>
<div class="section" id="id3">
<h2>Установка<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Чтобы использовать инстанциацию ленивого сервиса, вам всегда в первую очередь
понадобится установить пакет <tt class="docutils literal"><code>ocramius/proxy-manager</code></tt>:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require ocramius/proxy-manager
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p>Если вы не используете комплексный фреймворк, вы также должны установить
<a class="reference external" href="https://github.com/symfony/symfony/tree/master/src/Symfony/Bridge/ProxyManager">мост ProxyManager</a></p>
<div class="literal-block"><div class="last highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/proxy-manager-bridge
</pre></div>
</td></tr></table></div></div>
</div></div>
</div>
<div class="section" id="id4">
<h2>Конфигурация<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Вы можете отметить сервис как <tt class="docutils literal"><code>lazy</code></tt> (ленивый), изменив его определение:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
   <span class="l l-Scalar l-Scalar-Plain">AppBundle\Twig\AppExtension</span><span class="p p-Indicator">:</span>
     <span class="l l-Scalar l-Scalar-Plain">lazy</span><span class="p p-Indicator">:</span>  <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>
        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;AppBundle\Twig\AppExtension&quot;</span> <span class="na">lazy=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/services&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">AppBundle\Twig\AppExtension</span><span class="p">;</span>

<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">(</span><span class="nx">AppExtension</span><span class="o">::</span><span class="na">class</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">setLazy</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Как только вы внедрите сервис в другой сервис, должен внедриться виртуальный
<a class="reference external" href="https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BC%D0%B5%D1%81%D1%82%D0%B8%D1%82%D0%B5%D0%BB%D1%8C_(%D1%88%D0%B0%D0%B1%D0%BB%D0%BE%D0%BD_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F)">прокси</a> с той же подписью класса, который будет представлять сервис. То же
самое происходит при вызове <tt class="docutils literal"><code>Container::get()</code></tt> напрямую.</p>
<p>Сам класс будет инстанциирован как только вы попробуете взаимодействовать с
сервисом (например, вызвать один из его методов).</p>
<p>Чтобы проверить, работает ли ваш прокси, вы можете просто проверить интерфейс
полученного объекта:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">dump</span><span class="p">(</span><span class="nb">class_implements</span><span class="p">(</span><span class="nv">$service</span><span class="p">));</span>
<span class="c1">// вывод должен включать в себя &quot;ProxyManager\Proxy\LazyLoadingInterface&quot;</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Если вы не установите <a class="reference external" href="https://github.com/symfony/symfony/tree/master/src/Symfony/Bridge/ProxyManager">мост ProxyManager</a> и <a class="reference external" href="https://github.com/Ocramius/ProxyManager">ocramius/proxy-manager</a>,
контейнер будет просто пропускать метку <tt class="docutils literal"><code>lazy</code></tt> и инстанциировать сервис,
как обычно.</p>
</div></div>
</div>
<div class="section" id="id5">
<h2>Дополнительные источники<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>Вы можете прочитать больше о том, как инстанциируются, генерируются и инициализируются
прокси в <a class="reference external" href="https://github.com/Ocramius/ProxyManager/blob/master/docs/lazy-loading-value-holder.md">документации ProxyManager</a>.</p>
</div>
</div>


            </div>

            
            <div class="navigation">
                <a href="lazy_services.html">« Lazy Services</a>
                <span class="separator">|</span>
                <a href="optional_dependencies.html">How to Make Service Arguments/References Optional »</a>
            </div>
            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>