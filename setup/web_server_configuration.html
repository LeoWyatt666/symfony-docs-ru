<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Конфигурация веб-сервера &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css">
    <link rel="stylesheet" href="..\_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="..\index.html">
    <link rel="up" title="Installing &amp; Setting up the Symfony Framework" href="..\setup.html">
    <link rel="next" title="The Bundle System" href="..\bundles.html">
    <link rel="prev" title="Обновление версии патча (например с 2.6.0 до 2.6.1)" href="upgrade_patch-ru.html">

<link rel="stylesheet" href="..\_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="..\_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="..\_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="setup doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\..\index.html">
                    <img src="..\..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="..\index.html">Главная</a>
        </li>
    
        <li>
            <a href="..\components\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="..\best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="..\quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="..\reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="..\genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="..\contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Конфигурация веб-сервера</a><ul>
<li><a class="reference internal" href="#apache-mod-php-php-cgi">Apache с mod_php/PHP-CGI</a><ul>
<li><a class="reference internal" href="#mod-php-php-cgi-apache-2-4">Использование mod_php/PHP-CGI с Apache 2.4</a></li>
</ul>
</li>
<li><a class="reference internal" href="#apache-php-fpm">Apache с PHP-FPM</a><ul>
<li><a class="reference internal" href="#mod-proxy-fcgi-apache-2-4">Использование mod_proxy_fcgi с Apache 2.4</a></li>
<li><a class="reference internal" href="#php-fpm-apache-2-2">PHP-FPM с Apache 2.2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nginx">Nginx</a></li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="..\index.html">Документация</a></li>
                
                <li><a href="..\getting_started\index.html">Getting Started</a></li>
                
                <li><a href="..\setup.html">Installing &amp; Setting up the Symfony Framework</a></li>
                
                <li class="active">Конфигурация веб-сервера</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Конфигурация веб-сервера<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Предпочитаемым способом разработки вашего приложения Symfony является использование
<a class="reference internal" href="built_in_web_server.html"><em>внутреннего веб-сервера PHP</em></a>. Однако, при
использовании более старой версии PHP или при загрузке приложения в окружении
производства, вам понадобится использовать веб-сервер с полным функционалом. Эта
статья описывает несколько способов использования Symfony с Apache или Nginx.</p>
<p>При использовании Apache, вы можете сконфигурировать PHP как
<a class="reference internal" href="web_server_configuration.html#web-server-apache-mod-php"><span>Apache-модуль</span></a> или с FastCGI, используя
<a class="reference internal" href="web_server_configuration.html#web-server-apache-fpm"><span>PHP FPM</span></a>. FastCGI также является предпочитаемым
способом использования PHP <a class="reference internal" href="web_server_configuration.html#web-server-nginx"><span>с Nginx</span></a>.</p>
<div class="admonition-wrapper">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title">Веб-каталог</p>
<p>Веб-каталог - это дом всех публичных и статических файлов вашего приложения,
включая изображения, таблицы стилей, и файлы Java-скриптов. Также там живут
фронт-контроллеры (<tt class="docutils literal"><code>app.php</code></tt> и <tt class="docutils literal"><code>app_dev.php</code></tt>).</p>
<p>Веб-каталог служит в качестве корня документа при конфигурации вашего
веб-сервера. В примерах ниже, каталог <tt class="docutils literal"><code>web/</code></tt> будет корнем документа.
Этот каталог - <tt class="docutils literal"><code>/var/www/project/web/</code></tt>.</p>
<p class="last">Если ваш провайдер хостинга требует, чтобы вы изменили каталог <tt class="docutils literal"><code>web/</code></tt>
на другую локацию (например, <tt class="docutils literal"><code>public_html/</code></tt>), то убедитесь в том, что
вы <a class="reference internal" href="..\configuration\override_dir_structure.html#override-web-dir"><span>переопределите локацию каталога web/</span></a>.</p>
</div></div>
<div class="section" id="apache-mod-php-php-cgi">
<span id="web-server-apache-mod-php-ru"></span><h2>Apache с mod_php/PHP-CGI<a class="headerlink" href="#apache-mod-php-php-cgi" title="Permalink to this headline">¶</a></h2>
<p><strong>Минимальной конфигурацией</strong> необходимой для запуска вашего приложения под Apache является:</p>
<div class="literal-block"><div class="highlight-apache"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> domain.tld
    <span class="nb">ServerAlias</span> www.domain.tld

    <span class="nb">DocumentRoot</span> <span class="sx">/var/www/project/web</span>
    <span class="nt">&lt;Directory</span> <span class="s">/var/www/project/web</span><span class="nt">&gt;</span>
        <span class="nb">AllowOverride</span> <span class="k">All</span>
        <span class="nb">Order</span> Allow,Deny
        <span class="nb">Allow</span> from <span class="k">All</span>
    <span class="nt">&lt;/Directory&gt;</span>

    <span class="c"># Уберите комментарии из следующих строк, если вы установили ресурсы как символьные ссылки</span>
    <span class="c"># или столкнётесь с проблемами при компиляции ресурсов LESS/Sass/CoffeeScript</span>
    <span class="c"># &lt;Directory /var/www/project&gt;</span>
    <span class="c">#     Options FollowSymlinks</span>
    <span class="c"># &lt;/Directory&gt;</span>

    <span class="nb">ErrorLog</span> <span class="sx">/var/log/apache2/project_error.log</span>
    <span class="nb">CustomLog</span> <span class="sx">/var/log/apache2/project_access.log</span> combined
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">If your system supports the <tt class="docutils literal"><code>APACHE_LOG_DIR</code></tt> variable, you may want
to use <tt class="docutils literal"><code>${APACHE_LOG_DIR}/</code></tt> instead of hardcoding <tt class="docutils literal"><code>/var/log/apache2/</code></tt>.</p>
</div></div>
<p>Используйте следующую <strong>оптимизированную конфигурацию</strong>, чтобы отключить поддержку <tt class="docutils literal"><code>.htaccess</code></tt>
и увеличить производительность веб-сервера:</p>
<div class="literal-block"><div class="highlight-apache"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> domain.tld
    <span class="nb">ServerAlias</span> www.domain.tld

    <span class="nb">DocumentRoot</span> <span class="sx">/var/www/project/web</span>
    <span class="nt">&lt;Directory</span> <span class="s">/var/www/project/web</span><span class="nt">&gt;</span>
        <span class="nb">AllowOverride</span> <span class="k">None</span>
        <span class="nb">Order</span> Allow,Deny
        <span class="nb">Allow</span> from <span class="k">All</span>

        <span class="nt">&lt;IfModule</span> <span class="s">mod_rewrite.c</span><span class="nt">&gt;</span>
            <span class="nb">Options</span> -MultiViews
            <span class="nb">RewriteEngine</span> <span class="k">On</span>
            <span class="nb">RewriteCond</span> %{REQUEST_FILENAME} !-f
            <span class="nb">RewriteRule</span> ^(.*)$ app.php [QSA,L]
        <span class="nt">&lt;/IfModule&gt;</span>
    <span class="nt">&lt;/Directory&gt;</span>

    <span class="c"># Уберите комментарии из следующих строк, если вы установили ресурсы как символьные ссылки</span>
    <span class="c"># или столкнётесь с проблемами при компиляции ресурсов LESS/Sass/CoffeeScript</span>
    <span class="c"># &lt;Directory /var/www/project&gt;</span>
    <span class="c">#     Options FollowSymlinks</span>
    <span class="c"># &lt;/Directory&gt;</span>

    <span class="c"># по желанию отключите RewriteEngine для каталогов ресурсов,</span>
    <span class="c"># что позволит apache просто отвечать ошибкой 404, когда файлы</span>
    <span class="c"># не найдены, вместо того, чтобы передавать запрос в symfony</span>
    <span class="nt">&lt;Directory</span> <span class="s">/var/www/project/web/bundles</span><span class="nt">&gt;</span>
        <span class="nt">&lt;IfModule</span> <span class="s">mod_rewrite.c</span><span class="nt">&gt;</span>
            <span class="nb">RewriteEngine</span> <span class="k">Off</span>
        <span class="nt">&lt;/IfModule&gt;</span>
    <span class="nt">&lt;/Directory&gt;</span>
    <span class="nb">ErrorLog</span> <span class="sx">/var/log/apache2/project_error.log</span>
    <span class="nb">CustomLog</span> <span class="sx">/var/log/apache2/project_access.log</span> combined
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p>Если вы используете <strong>php-cgi</strong>, Apache не передаёт базовые HTTP имя пользователя
и пароль в PHP по умолчанию. Чтобы обойти это ограничение, вам стоит использовать
следующий отрезок конфигурации:</p>
<div class="literal-block"><div class="last highlight-apache"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">RewriteRule</span> .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
</pre></div>
</td></tr></table></div></div>
</div></div>
<div class="section" id="mod-php-php-cgi-apache-2-4">
<h3>Использование mod_php/PHP-CGI с Apache 2.4<a class="headerlink" href="#mod-php-php-cgi-apache-2-4" title="Permalink to this headline">¶</a></h3>
<p>В Apache 2.4, <tt class="docutils literal"><code>Order Allow,Deny</code></tt> был заменён <tt class="docutils literal"><code>Require all granted</code></tt>. Поэтому
вам нужно будет изменить ваши настройки доступа <tt class="docutils literal"><code>Directory</code></tt> следующим образом:</p>
<div class="literal-block"><div class="highlight-apache"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;Directory</span> <span class="s">/var/www/project/web</span><span class="nt">&gt;</span>
    <span class="nb">Require</span> <span class="k">all</span> granted
    <span class="c"># ...</span>
<span class="nt">&lt;/Directory&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>Для продвинутых опций конфигурации Apache, прочтите официальную <a class="reference external" href="http://httpd.apache.org/docs/">Документацию Apache</a>.</p>
</div>
</div>
<div class="section" id="apache-php-fpm">
<span id="web-server-apache-fpm-ru"></span><h2>Apache с PHP-FPM<a class="headerlink" href="#apache-php-fpm" title="Permalink to this headline">¶</a></h2>
<p>Чтобы воспользоваться PHP5-FPM в Apache, вам для начала надо убедиться в том,
что у вас установлены менеджер бинарный процессов FastCGI <tt class="docutils literal"><code>php-fpm</code></tt> и модуль
Apache FastCGI (например, в системе, основанной на Debian, вам понадобится
установить пакеты <tt class="docutils literal"><code>libapache2-mod-fastcgi</code></tt> и <tt class="docutils literal"><code>php5-fpm</code></tt>).</p>
<p>PHP-FPM использует так называемые <em>пулы</em> для обработки входящих FastCGI-запровос.
Вы можете сконфигурировать произвольное количество пулов в конфигурации FPM. В
пуле, вы конфигурируете либо канал TCP (IP и порт), либо канал Unix-домена для
прослушивания. Каждый пул также можно запускать под разными UID и GID:</p>
<div class="literal-block"><div class="highlight-ini"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">; a pool called www</span>
<span class="k">[www]</span>
<span class="na">user</span> <span class="o">=</span> <span class="s">www-data</span>
<span class="na">group</span> <span class="o">=</span> <span class="s">www-data</span>

<span class="c1">; использовать канал unix-домена</span>
<span class="na">listen</span> <span class="o">=</span> <span class="s">/var/run/php5-fpm.sock</span>

<span class="c1">; или прослушивать канал TCP</span>
<span class="na">listen</span> <span class="o">=</span> <span class="s">127.0.0.1:9000</span>
</pre></div>
</td></tr></table></div></div>
<div class="section" id="mod-proxy-fcgi-apache-2-4">
<h3>Использование mod_proxy_fcgi с Apache 2.4<a class="headerlink" href="#mod-proxy-fcgi-apache-2-4" title="Permalink to this headline">¶</a></h3>
<p>Если вы запускаете Apache 2.4, вы с лёгкостью можете использовать <tt class="docutils literal"><code>mod_proxy_fcgi</code></tt>,
чтобы передать входящие запросы PHP-FPM. Сконфигурируйте PHP-FPM для прослушивания
канала TCP или Unix-домена, включите <tt class="docutils literal"><code>mod_proxy</code></tt> и <tt class="docutils literal"><code>mod_proxy_fcgi</code></tt> в вашей
конфигурации Apache, и используйте указание <tt class="docutils literal"><code>SetHandler</code></tt>, чтобы передавать запросы
PHP-файлов PHP FPM:</p>
<div class="literal-block"><div class="highlight-apache"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> domain.tld
    <span class="nb">ServerAlias</span> www.domain.tld

    <span class="c"># Уберите комментарии из следующей строки, чтобы заставить Apache передать заголовок</span>
    <span class="c"># авторизации (Authorization) PHP: необходимо для &quot;basic_auth&quot; в PHP-FPM и FastCGI</span>
    <span class="c"># SetEnvIfNoCase ^Authorization$ &quot;(.+)&quot; HTTP_AUTHORIZATION=$1</span>

    <span class="c"># Для версии Apache 2.4.9 или новее</span>
    <span class="c"># Использование SetHandler помогает избежаь проблем при исползовании ProxyPassMatch в комбинации</span>
    <span class="c"># с mod_rewrite или mod_autoindex</span>
    <span class="nt">&lt;FilesMatch</span> <span class="s">\.php$</span><span class="nt">&gt;</span>
        <span class="nb">SetHandler</span> proxy:fcgi://127.0.0.1:9000
        <span class="c"># Для Unix-каналов, Apache 2.4.10 или новее,</span>
        <span class="c"># SetHandler proxy:unix:/path/to/fpm.sock|fcgi://dummy</span>
    <span class="nt">&lt;/FilesMatch&gt;</span>

    <span class="c"># Если вы используете более раннюю версию Apache, чем 2.4.9, вы должны рассмотреть вариант</span>
    <span class="c"># обновления или используйте вместо этого</span>
    <span class="c"># ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9000/var/www/project/web/$1</span>

    <span class="c"># Если вы запускаете ваше приложение Symfony на субпути вашего документа корня,</span>
    <span class="c"># регулярное выражение должно быть изменено соответственно:</span>
    <span class="c"># ProxyPassMatch ^/path-to-app/(.*\.php(/.*)?)$ fcgi://127.0.0.1:9000/var/www/project/web/$1</span>

    <span class="nb">DocumentRoot</span> <span class="sx">/var/www/project/web</span>
    <span class="nt">&lt;Directory</span> <span class="s">/var/www/project/web</span><span class="nt">&gt;</span>
        <span class="c"># enable the .htaccess rewrites</span>
        <span class="nb">AllowOverride</span> <span class="k">All</span>
        <span class="nb">Require</span> <span class="k">all</span> granted
    <span class="nt">&lt;/Directory&gt;</span>

    <span class="c"># Уберите комментарии из следующих строк, если вы устанавливаете ресурсы как символьные ссылки</span>
    <span class="c"># или столкнётесь с проблемами при компиляции ресурсов LESS/Sass/CoffeeScript</span>
    <span class="c"># &lt;Directory /var/www/project&gt;</span>
    <span class="c">#     Options FollowSymlinks</span>
    <span class="c"># &lt;/Directory&gt;</span>

    <span class="nb">ErrorLog</span> <span class="sx">/var/log/apache2/project_error.log</span>
    <span class="nb">CustomLog</span> <span class="sx">/var/log/apache2/project_access.log</span> combined
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="php-fpm-apache-2-2">
<h3>PHP-FPM с Apache 2.2<a class="headerlink" href="#php-fpm-apache-2-2" title="Permalink to this headline">¶</a></h3>
<p>В версии Apache 2.2, или старее, вы не можете использовать <tt class="docutils literal"><code>mod_proxy_fcgi</code></tt>. Вам нужно
использовать вместо этого указание <a class="reference external" href="https://docs.oracle.com/cd/B31017_01/web.1013/q20204/mod_fastcgi.html#FastCgiExternalServer">FastCgiExternalServer</a>. Поэтому, ваша конфигурация
Apache должна выглядеть как-то так:</p>
<div class="literal-block"><div class="highlight-apache"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> domain.tld
    <span class="nb">ServerAlias</span> www.domain.tld

    <span class="nb">AddHandler</span> php5-fcgi .php
    <span class="nb">Action</span> php5-fcgi <span class="sx">/php5-fcgi</span>
    <span class="nb">Alias</span> <span class="sx">/php5-fcgi</span> <span class="sx">/usr/lib/cgi-bin/php5-fcgi</span>
    <span class="nb">FastCgiExternalServer</span> <span class="sx">/usr/lib/cgi-bin/php5-fcgi</span> -host <span class="m">127.0.0.1</span>:9000 -pass-header Authorization

    <span class="nb">DocumentRoot</span> <span class="sx">/var/www/project/web</span>
    <span class="nt">&lt;Directory</span> <span class="s">/var/www/project/web</span><span class="nt">&gt;</span>
        <span class="c"># включите перезапись .htaccess</span>
        <span class="nb">AllowOverride</span> <span class="k">All</span>
        <span class="nb">Order</span> Allow,Deny
        <span class="nb">Allow</span> from <span class="k">all</span>
    <span class="nt">&lt;/Directory&gt;</span>

    <span class="c"># уберите комментарии из следующих строк, если вы устаналиваете ресурсы как символьные ссылки</span>
    <span class="c"># или столкнётесь с проблемами при компиляции ресурсов LESS/Sass/CoffeeScript</span>
    <span class="c"># &lt;Directory /var/www/project&gt;</span>
    <span class="c">#     Options FollowSymlinks</span>
    <span class="c"># &lt;/Directory&gt;</span>

    <span class="nb">ErrorLog</span> <span class="sx">/var/log/apache2/project_error.log</span>
    <span class="nb">CustomLog</span> <span class="sx">/var/log/apache2/project_access.log</span> combined
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>Если вы предпочитаете использовать Unix-канал, то вместо этого вам стоит использовать
опцию <tt class="docutils literal"><code>-socket</code></tt>:</p>
<div class="literal-block"><div class="highlight-apache"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nb">FastCgiExternalServer</span> <span class="sx">/usr/lib/cgi-bin/php5-fcgi</span> -socket <span class="sx">/var/run/php5-fpm.sock</span> -pass-header Authorization
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="nginx">
<span id="web-server-nginx-ru"></span><h2>Nginx<a class="headerlink" href="#nginx" title="Permalink to this headline">¶</a></h2>
<p><strong>Минимальной конфигурацией</strong> для запуска вашего приложения под Nginx является:</p>
<div class="literal-block"><div class="highlight-nginx"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
    <span class="kn">server_name</span> <span class="s">domain.tld</span> <span class="s">www.domain.tld</span><span class="p">;</span>
    <span class="kn">root</span> <span class="s">/var/www/project/web</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="c1"># попробуйте обслужить файл напрямую, резервный откат - app.php</span>
        <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="s">/app.php</span><span class="nv">$is_args$args</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1"># DEV</span>
    <span class="c1"># Это правило стоит помещать только в вашем окружении разработки</span>
    <span class="c1"># В производстве не включайте это и не развёртывайте app_dev.php или config.php</span>
    <span class="kn">location</span> <span class="p">~</span> <span class="sr">^/(app_dev|config)\.php(/|$)</span> <span class="p">{</span>
        <span class="kn">fastcgi_pass</span> <span class="s">unix:/var/run/php5-fpm.sock</span><span class="p">;</span>
        <span class="kn">fastcgi_split_path_info</span> <span class="s">^(.+\.php)(/.*)</span>$<span class="p">;</span>
        <span class="kn">include</span> <span class="s">fastcgi_params</span><span class="p">;</span>
        <span class="c1"># Когда вы используете символьные ссылки для связи корня документа</span>
        <span class="c1"># с текущей версией вашего приложения, вы должны передать настоящий</span>
        <span class="c1"># путь приложения, вместо пути к символьной ссылке PHP FPM.</span>
        <span class="c1"># В обратном случае, OPcache PHP может некорректно уловить изменения</span>
        <span class="c1"># в ваших PHP-файлах (смотрите https://github.com/zendtech/ZendOptimizerPlus/issues/126,</span>
        <span class="c1"># чтобы узнать больше).</span>
        <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="nv">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">DOCUMENT_ROOT</span> <span class="nv">$realpath_root</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1"># PROD</span>
    <span class="kn">location</span> <span class="p">~</span> <span class="sr">^/app\.php(/|$)</span> <span class="p">{</span>
        <span class="kn">fastcgi_pass</span> <span class="s">unix:/var/run/php5-fpm.sock</span><span class="p">;</span>
        <span class="kn">fastcgi_split_path_info</span> <span class="s">^(.+\.php)(/.*)</span>$<span class="p">;</span>
        <span class="kn">include</span> <span class="s">fastcgi_params</span><span class="p">;</span>
        <span class="c1"># Когда вы используете символьные ссылки для связи корня документа</span>
        <span class="c1"># с текущей версией вашего приложения, вы должны передать настоящий</span>
        <span class="c1"># путь приложения, вместо пути к символьной ссылке PHP FPM.</span>
        <span class="c1"># В обратном случае, OPcache PHP может некорректно уловить изменения</span>
        <span class="c1"># в ваших PHP-файлах (смотрите https://github.com/zendtech/ZendOptimizerPlus/issues/126,</span>
        <span class="c1"># чтобы узнать больше).</span>
        <span class="kn">fastcgi_param</span> <span class="s">SCRIPT_FILENAME</span> <span class="nv">$realpath_root$fastcgi_script_name</span><span class="p">;</span>
        <span class="kn">fastcgi_param</span> <span class="s">DOCUMENT_ROOT</span> <span class="nv">$realpath_root</span><span class="p">;</span>
        <span class="c1"># Предотвращает URI, которые включают фронт-контроллер. Это вызовет ошибку 404:</span>
        <span class="c1"># http://domain.tld/app.php/some-path</span>
        <span class="c1"># Удалите внутренне указание, чтобы внутренне разрешить такие URI, как эта;</span>
    <span class="p">}</span>

    <span class="c1"># вернуть 404 для всех других файлов, не соответствующих фронт-контроллеру</span>
    <span class="c1"># это предотвращает доступ к другим php-файлам, которые вы не хотите делать доступными.</span>
    <span class="kn">location</span> <span class="p">~</span> <span class="sr">\.php$</span> <span class="p">{</span>
        <span class="kn">return</span> <span class="mi">404</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kn">error_log</span> <span class="s">/var/log/nginx/project_error.log</span><span class="p">;</span>
    <span class="kn">access_log</span> <span class="s">/var/log/nginx/project_access.log</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">В зависимости от вашей конфигурации PHP-FPM config, <tt class="docutils literal"><code>fastcgi_pass</code></tt> также может быть
<tt class="docutils literal"><code>fastcgi_pass 127.0.0.1:9000</code></tt>.</p>
</div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p>Это выполняет <strong>только</strong> <tt class="docutils literal"><code>app.php</code></tt>, <tt class="docutils literal"><code>app_dev.php</code></tt> и <tt class="docutils literal"><code>config.php</code></tt> в
веб-каталоге. Все другие файлы, заканчивающиеся на &quot;.php&quot;, получат отказ.</p>
<p class="last">Если у вас есть другие PHP-файлы в вашем веб-каталоге, которые нужно выполнить,
убелитесь в том, что вы включили их в блок <tt class="docutils literal"><code>location</code></tt> выше.</p>
</div></div>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">После развёртывания в производство, убедитесь, что вы <strong>не можете</strong> получить доступ к
скриптам <tt class="docutils literal"><code>app_dev.php</code></tt> или``config.php`` (т.е. <tt class="docutils literal"><code>http://example.com/app_dev.php</code></tt> и
<tt class="docutils literal"><code>http://example.com/config.php</code></tt>). Если вы <em>можете</em> получить к ним доступ, обязательно
удалте раздел <tt class="docutils literal"><code>DEV</code></tt> из конфигурации выше.</p>
</div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">По умолчанию, приложения Symfony включают несколько файлов <tt class="docutils literal"><code>.htaccess</code></tt>, чтобы
конфигурировать перенаправления и чтобы избегать неавторизованный доступ к некоторым
чувствительным каталогам. Эти файлы полезны только при использовании Apache, так что
вы можете спокойно удалить их при использованииNginx.</p>
</div></div>
<p>Для продвинутых опций конфигурации Nginx, прочтите официальную <a class="reference external" href="https://www.nginx.com/resources/wiki/start/topics/recipes/symfony/">Документацию Nginx</a>.</p>
</div>
</div>


            </div>

            
            <div class="navigation">
                <a href="upgrade_patch-ru.html">« Обновление версии патча (например с 2.6.0 до 2.6.1)</a>
                <span class="separator">|</span>
                <a href="..\bundles.html">The Bundle System »</a>
            </div>
            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>