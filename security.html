<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Безопасность &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="_static/" type="text/css">
    <link rel="stylesheet" href="_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="index.html">

<link rel="stylesheet" href="_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="security-r doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\index.html">
                    <img src="..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="index.html">Главная</a>
        </li>
    
        <li>
            <a href="components\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Безопасность</a><ul>
<li><a class="reference internal" href="#id2">Установка</a></li>
<li><a class="reference internal" href="#security-yaml">1) Начальная установка security.yaml (аутентификация)</a><ul>
<li><a class="reference internal" href="#a">A) Конфигурирование аутентификации ваших пользователей</a></li>
<li><a class="reference internal" href="#b">B) Конфигурирование загрузки пользователей</a><ul>
<li><a class="reference internal" href="#id3">Загрузка пользователей из БД</a></li>
</ul>
</li>
<li><a class="reference internal" href="#c">C) Шифрование пароля пользователя</a></li>
<li><a class="reference internal" href="#d">D) Конфигурация готова!</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-authorization-ru">2) Отказ в доступе, роли и другая авторизация</a><ul>
<li><a class="reference internal" href="#id5">Роли</a></li>
<li><a class="reference internal" href="#security-role-authorization-ru">Добавление кода для запрета доступа</a><ul>
<li><a class="reference internal" href="#url-access-control">Безопасность шаблонов URL (access_control)</a></li>
<li><a class="reference internal" href="#security-securing-controller-ru">Безопасность контроллеров и другого кода</a></li>
<li><a class="reference internal" href="#security-template-ru">Контроль доступа в шаблонах</a></li>
<li><a class="reference internal" href="#id9">Безопасность других сервисов</a></li>
</ul>
</li>
<li><a class="reference internal" href="#is-athenticated-fully">Проверка выполнения входа пользователем (IS_ATHENTICATED_FULLY)</a></li>
<li><a class="reference internal" href="#acl">Списки контроля доступа (ACL): Безопасность отдельных объектов БД</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user">3) Извлечение объекта User</a><ul>
<li><a class="reference internal" href="#id10">Всегда проверяйте, выполнил ли пользователь вход</a></li>
<li><a class="reference internal" href="#id11">Поиск пользователя в шаблоне</a></li>
</ul>
</li>
<li><a class="reference internal" href="#security-logging-out-ru">Выход из системы</a></li>
<li><a class="reference internal" href="#security-role-hierarchy-ru">Иерархические роли</a></li>
<li><a class="reference internal" href="#id14">Заключение</a></li>
<li><a class="reference internal" href="#id15">Узнать больше</a><ul>
<li><a class="reference internal" href="#id16">Аутентификация (Идентификация/Выполнение входа пользователем)</a></li>
<li><a class="reference internal" href="#id17">Авторизация (Отказ в доступе)</a></li>
<li><a class="reference internal" href="#id18">Другие темы по безопасности</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="index.html">Документация</a></li>
                
                <li class="active">Безопасность</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Безопасность<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Система безопасности Symfony невероятно мощная, но в то же время может быть
сложной в установке. В этой главе вы научитесь устанавливать безопасность
вашего приложения шаг за шагом; от конфигурации вашего фаервола и загрузки
пользователей до отказа в доступе и вызова объекта User. В зависимости от того,
что вам нужно, иногда начальная установка может быть непростой. Но как только
вы это сделаете, система безопасности Symfony станет и гибкой, и (надеемся)
простой для работы.</p>
<p>Так как нам предстоит о многом поговорить, эта глава поделена на несколько
больших разделов:</p>
<ol class="arabic simple">
<li>Установка поддержки безопасности;</li>
<li>Начальная установка <tt class="docutils literal"><code>security.yaml</code></tt> (<em>аутентификация</em>);</li>
<li>Отказ в доступе к вашему приложению (<em>авторизация</em>);</li>
<li>Вызов текущего объекта User.</li>
</ol>
<p>За этими разделами последуют маленькие (но все равно захватывающие)
подразделы вроде <a class="reference internal" href="security.html#security-logging-out"><span>выхода из системы</span></a> и
<a class="reference internal" href="security\password_encoding.html"><em>шифрования пользовательских паролей</em></a>.</p>
<div class="section" id="id2">
<h2>Установка<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>В приложениях, использующих <a class="reference internal" href="setup\flex.html"><em>Symfony Flex</em></a>,
выполните эту команду, чтобы установить функцию безопасности перед её
использованием:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require security
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="security-yaml">
<span id="initial-security-yml-setup-authentication-ru"></span><span id="firewalls-authentication-ru"></span><span id="security-firewalls-ru"></span><h2>1) Начальная установка security.yaml (аутентификация)<a class="headerlink" href="#security-yaml" title="Permalink to this headline">¶</a></h2>
<p>Система безопасности конфигурируется в <tt class="docutils literal"><code>config/packages/security.yaml</code></tt>. Конфигурация
по умолчанию выглядит так:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">providers</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">in_memory</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span> <span class="nv">memory</span><span class="p p-Indicator">:</span> <span class="nv">~</span> <span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">dev</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">pattern</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">^/(_(profiler|wdt)|css|images|js)/</span>
            <span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">anonymous</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">~</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;in_memory&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;memory</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/provider&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;dev&quot;</span>
            <span class="na">pattern=</span><span class="s">&quot;^/(_(profiler|wdt)|css|images|js)/&quot;</span>
            <span class="na">security=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;anonymous</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;in_memory&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;memory&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;dev&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;pattern&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;^/(_(profiler|wdt)|css|images|js)/&#39;</span><span class="p">,</span>
            <span class="s1">&#39;security&#39;</span>  <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;anonymous&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Ключ <tt class="docutils literal"><code>firewalls</code></tt> является <em>сердцем</em> вашей конфигурации. Брандмауэр <tt class="docutils literal"><code>dev</code></tt> не
является важным, он просто проверяет, чтобы ваши инструменты разработки Symfony,
которые находятся по URL типа <tt class="docutils literal"><code>/_profiler</code></tt> и <tt class="docutils literal"><code>/_wdt</code></tt>, не блокируются вашей
безопасностью.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Вы также можете сопоставлять запрос с другими деталями запроса (например, хостом).
Для более детальной информации и примеров, смотрите
<a class="reference internal" href="security\firewall_restriction.html"><em>Как ограничить брандмауэры</em></a>.</p>
</div></div>
<p>Все другие URL будут обрабатываться брандмауэром <tt class="docutils literal"><code>main</code></tt> (отсутствие
ключа <tt class="docutils literal"><code>pattern</code></tt> означает, что он совпадает со <em>всеми</em> URL). Вы можете
представлять брандмауэр в качестве вашей системы безопасности, поэтому
обычно имеет смысл делать только один главный брандмауэр. Но это <em>не</em> значит,
что каждый URL будет требовать аутентификацию - ключ <tt class="docutils literal"><code>anonymous</code></tt> заботится об
этом. Если вы перейдете на домашнюю страницу прямо сейчас, вы будете иметь
доступ и увидите, что прошли «аутентификацию» как <tt class="docutils literal"><code>anon</code></tt>. Не обманывайтесь
значением «yes» возле Authenticated, вы - просто анонимный пользователь:</p>
<img alt="_images/anonymous_wdt.png" class="align-center" src="_images\anonymous_wdt.png">
<p>Позже вы узнаете, как отказывать в доступе конкретным URL или контроллерам.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Безопасность имеет <em>массу</em> возможностей конфигурации, и существует
<a class="reference internal" href="reference\configuration\security.html"><em>Справочник конфигурации безопасностиe</em></a>,
в котором указывают все опции с дополнительными разъяснениями.</p>
</div></div>
<div class="section" id="a">
<h3>A) Конфигурирование аутентификации ваших пользователей<a class="headerlink" href="#a" title="Permalink to this headline">¶</a></h3>
<p>Главной задачей брандмауэра является конфигурирование того, <em>как</em> будут аутентифицироваться
ваши пользователи. Они будут использовать форму логина? Базовую аутентификацию HTTP?
Маркер API? Все вышеперечисленное?</p>
<p>Давайте начнем с базовой аутентификации HTTP (старомодные подсказки (prompt)) и будем
постепенно углубляться. Чтобы активировать это, добавьте в ваш брандмауэр ключ <tt class="docutils literal"><code>http_basic</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">anonymous</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">~</span>
            <span class="l l-Scalar l-Scalar-Plain">http_basic</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">~</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;anonymous</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;http-basic</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="c1">// ...</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;anonymous&#39;</span>  <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
            <span class="s1">&#39;http_basic&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Легко! Чтобы попробовать это, вам понадобится, заставить пользователя
войти в систему, чтобы увидеть страницу. Чтобы сделать все интереснее,
создайте новую страницу <tt class="docutils literal"><code>/admin</code></tt>. Например, если вы используете
аннотации, создайте что-то вроде этого:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/Controller/DefaultController.php</span>
<span class="c1">// ...</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Annotation\Route</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DefaultController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @Route(&quot;/admin&quot;)</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">admin</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;&lt;html&gt;&lt;body&gt;Admin page!&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Теперь, добавьте запись <tt class="docutils literal"><code>access_control</code></tt> в <tt class="docutils literal"><code>security.yaml</code></tt>, которая будет
требовать, чтобы пользовать вошел в систему для доступа к этому URL:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>
    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="c1"># потребовать ROLE_ADMIN для /admin*</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/admin</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>

        <span class="c">&lt;!-- потребовать ROLE_ADMIN для /admin* --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>
    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="c1">// ...</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// ...</span>
        <span class="p">),</span>
    <span class="p">),</span>
   <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
       <span class="c1">// потребовать ROLE_ADMIN для /admin*</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Вы узнаете больше о  <tt class="docutils literal"><code>ROLE_ADMIN</code></tt> и отказе в доступе позже в разделе
<span class="xref std std-ref">Отказ в доступе, роли и другая авторизация security-authorization</span>.</p>
</div></div>
<p>Отлично! Теперь, если вы перейдете на <tt class="docutils literal"><code>/admin</code></tt>, вы увидите, базовую подсказку
аутентификации HTTP:</p>
<img alt="_images/http_basic_popup.png" class="align-center" src="_images\http_basic_popup.png">
<p>Но как кто вы можете выполнить вход? Откуда приходят пользователи?</p>
<div class="admonition-wrapper" id="security-form-login-ru">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Хотите использовать традиционную форму входа? Отлично! Смотрите
<a class="reference internal" href="security\form_login_setup.html"><em>Как построить традиционную форму входа</em></a>.
Какие еще методы поддерживаются? Смотрите <a class="reference internal" href="reference\configuration\security.html"><em>Справочник конфигурации</em></a>
или <a class="reference internal" href="security\custom_authentication_provider.html"><em>создайте сами</em></a>.</p>
</div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Если ваше приложение впускает пользователей через сторонний сервис типа Google,
Facebook или Twitter, посмотрите общедоступный пакет <a class="reference external" href="https://github.com/hwi/HWIOAuthBundle">HWIOAuthBundle</a> .</p>
</div></div>
</div>
<div class="section" id="b">
<span id="where-do-users-come-from-user-providers-ru"></span><span id="security-user-providers-ru"></span><h3>B) Конфигурирование загрузки пользователей<a class="headerlink" href="#b" title="Permalink to this headline">¶</a></h3>
<p>Когда вы вводите свое имя пользователя, Symfony должен откуда-то загрузить
информацию этого пользователя. Это называется «провайдером пользователя», и
когда вы отвечаете за его конфигурирование, Symfony имеет встроенный способ
<a class="reference internal" href="security\entity_provider.html"><em>загружать пользователей из БД</em></a>, или же вы
можете <a class="reference internal" href="security\custom_provider.html"><em>сами создать провайдер пользователя</em></a>.</p>
<p>Самый простой (но самый ограниченный) способ - настроить Symfony так, чтобы он
загружал жестко закодированных пользователей напрямую из файла <tt class="docutils literal"><code>security.yaml</code></tt>.
Это называется провайдер «в памяти», но лучше думать о нем, как о провайдере «в
конфигурации»:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">providers</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">in_memory</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">ryan</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ryanpass</span>
                        <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span> <span class="s">&#39;ROLE_USER&#39;</span>
                    <span class="l l-Scalar l-Scalar-Plain">admin</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kitten</span>
                        <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span> <span class="s">&#39;ROLE_ADMIN&#39;</span>
    <span class="c1"># ...</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;in_memory&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;memory&gt;</span>
                <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;ryan&quot;</span> <span class="na">password=</span><span class="s">&quot;ryanpass&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_USER&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;admin&quot;</span> <span class="na">password=</span><span class="s">&quot;kitten&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/memory&gt;</span>
        <span class="nt">&lt;/provider&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;in_memory&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;memory&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;ryan&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ryanpass&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;admin&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;kitten&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="c1">// ...</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Как и с <tt class="docutils literal"><code>firewalls</code></tt>, у вас может быть несколько <tt class="docutils literal"><code>providers</code></tt>, но скорее
всего вам понадобится только один. Если же у вас <em>будет</em> несколько, вы можете
сконфигурировать, какой провайдер стоит использовать вашему брандмауэру в
ключе <tt class="docutils literal"><code>provider</code></tt> (например, <tt class="docutils literal"><code>provider: in_memory</code></tt>).</p>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">См. <a class="reference internal" href="security\multiple_user_providers.html"><em>Как использовать множественные провайдеры пользователя</em></a>,
чтобы узнать все детали о настройке множества провайдеров.</div></div>
<p>Попробуйте войти в систему, используя имя пользователя <tt class="docutils literal"><code>admin</code></tt> и пароль  <tt class="docutils literal"><code>kitten</code></tt>.
Вы должны увидеть ошибку!</p>
<blockquote>
<div>No encoder has been configured for account &quot;Symfony\Component\Security\Core\User\User&quot;
(Для аккаунта &quot;SymfonyComponentSecurityCoreUserUser&quot; не было создано кодировщика)</div></blockquote>
<p>Чтобы исправить это, добавьте ключ <tt class="docutils literal"><code>encoders</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">encoders</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Security\Core\User\User</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">plaintext</span>
    <span class="c1"># ...</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&quot;Symfony\Component\Security\Core\User\User&quot;</span>
            <span class="na">algorithm=</span><span class="s">&quot;plaintext&quot;</span> <span class="nt">/&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;encoders&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Symfony\Component\Security\Core\User\User&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;plaintext&#39;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="c1">// ...</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Провайдеры пользователя загружают информацию пользователя и помещают ее в
объект <tt class="docutils literal"><code>User</code></tt>. Если вы <a class="reference internal" href="security\entity_provider.html"><em>загружаете пользователей из БД</em></a>
или <a class="reference internal" href="security\custom_provider.html"><em>какого-то другого источника</em></a>, вы будете
использовать ваш личный класс User. Но при использовании провайдера «в памяти»,
вы получаете объект <tt class="docutils literal"><code>Symfony\Component\Security\Core\User\User</code></tt>.</p>
<p>Каким бы ни был ваш класс User, вам необходимо сказать Symfony, какой алгоритм
был использован для шифрования паролей. В этом случае, пароли являются простым
текстом, но через секунду вы измените их на <tt class="docutils literal"><code>bcrypt</code></tt>.</p>
<p>Если вы обновите страницу сейчас, вы будете в системе! Тулбар веб-отладки даже
сообщает вам кто вы, и какие роли имеете:</p>
<img alt="_images/symfony_loggedin_wdt.png" class="align-center" src="_images\symfony_loggedin_wdt.png">
<p>Так как этот URL требует <tt class="docutils literal"><code>ROLE_ADMIN</code></tt>, если бы вы вошли как <tt class="docutils literal"><code>ryan</code></tt>, вам было
бы отказано в доступе. Больше вы узнаете дальше
(<span class="xref std std-ref">Безопасность шаблонов URL (access_control)</span>).</p>
<div class="section" id="id3">
<h4>Загрузка пользователей из БД<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Если вы хотите загружать ваших пользователей через ORM Doctrine, то это
очень легко сделать! Смотрите <a class="reference internal" href="security\entity_provider.html"><em>Как загружать безопасных пользователей из БД</em></a>,
чтобы узнать все детали.</p>
</div>
</div>
<div class="section" id="c">
<span id="encoding-the-user-s-password-ru"></span><span id="security-encoding-user-password-ru"></span><h3>C) Шифрование пароля пользователя<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h3>
<p>Где бы ни хранились ваши пользователи, в <tt class="docutils literal"><code>security.yaml</code></tt>, базе данных, или
где-либо еще, вы захотите зашифровать их пароли. Наиболее подходящим алгоритмом для
использования является <tt class="docutils literal"><code>bcrypt</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">encoders</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">Symfony\Component\Security\Core\User\User</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">algorithm</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bcrypt</span>
            <span class="l l-Scalar l-Scalar-Plain">cost</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">12</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;encoder</span> <span class="na">class=</span><span class="s">&quot;Symfony\Component\Security\Core\User\User&quot;</span>
            <span class="na">algorithm=</span><span class="s">&quot;bcrypt&quot;</span>
            <span class="na">cost=</span><span class="s">&quot;12&quot;</span> <span class="nt">/&gt;</span>

        <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;encoders&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;Symfony\Component\Security\Core\User\User&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;algorithm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bcrypt&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cost&#39;</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">),</span>
    <span class="c1">// ...</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Конечно же, теперь пароли ваших пользователей должны быть зашифрованы именно этим
алгоритмом. Для жестко закодированных пользователей вы можете использовать встроенную
команду:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> php bin/console security:encode-password
</pre></div>
</td></tr></table></div></div>
<p>Она выдаст вам что-то такое:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">providers</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">in_memory</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">ryan</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$2a$12$LCY0MefVIEc3TYPHV9SNnuzOfyr2p/AXIGoQJEDs4am4JwhNz/jli</span>
                        <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span> <span class="s">&#39;ROLE_USER&#39;</span>
                    <span class="l l-Scalar l-Scalar-Plain">admin</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">$2a$12$cyTWeE9kpq1PjqKFiWUZFuCRPwVyAZwm4XzMZ1qPUFl7/flCM3V0G</span>
                        <span class="l l-Scalar l-Scalar-Plain">roles</span><span class="p p-Indicator">:</span> <span class="s">&#39;ROLE_ADMIN&#39;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;provider</span> <span class="na">name=</span><span class="s">&quot;in_memory&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;memory&gt;</span>
                <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;ryan&quot;</span> <span class="na">password=</span><span class="s">&quot;$2a$12$LCY0MefVIEc3TYPHV9SNnuzOfyr2p/AXIGoQJEDs4am4JwhNz/jli&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_USER&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;user</span> <span class="na">name=</span><span class="s">&quot;admin&quot;</span> <span class="na">password=</span><span class="s">&quot;$2a$12$cyTWeE9kpq1PjqKFiWUZFuCRPwVyAZwm4XzMZ1qPUFl7/flCM3V0G&quot;</span> <span class="na">roles=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/memory&gt;</span>
        <span class="nt">&lt;/provider&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;providers&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;in_memory&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;memory&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;users&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">&#39;ryan&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;$2a$12$LCY0MefVIEc3TYPHV9SNnuzOfyr2p/AXIGoQJEDs4am4JwhNz/jli&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="s1">&#39;admin&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;$2a$12$cyTWeE9kpq1PjqKFiWUZFuCRPwVyAZwm4XzMZ1qPUFl7/flCM3V0G&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;roles&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
    <span class="c1">// ...</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Теперь все будет работать точно так же, как и раньше. Но если у вас есть
динамичные пользователи (например, из БД), как можно программно зашифровать
пароль до того, как поместить их в БД? Не волнуйтесь, смотрите
<a class="reference internal" href="security\password_encoding.html"><em>Динамичное шифрование пароля</em></a>.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p>Поддерживаемые алгоритмы этого метода зависят от вашей версии PHP, но
включают алгоритмы, возвращаемые функцией <tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.hash-algos.php" title="hash_algos">hash_algos</a></code></tt>, а
также некоторые другие (например, bcrypt и argon2i). Смотрите ключ <tt class="docutils literal"><code>encoders</code></tt> в
разделе  <a class="reference internal" href="reference\configuration\security.html"><em>Справочник безопасности»</em></a>
для примеров.</p>
<p class="last">Также возможно использовать разные алгоритмы хеширования на основании
пользователь за пользователем. См.
<a class="reference internal" href="security\named_encoders.html"><em>Как динамично выбрать алгоритм шифрования пароля</em></a>.</p>
</div></div>
</div>
<div class="section" id="d">
<h3>D) Конфигурация готова!<a class="headerlink" href="#d" title="Permalink to this headline">¶</a></h3>
<p>Поздравляем! Теперь у вас есть работающая система аутентификации, которая
использует базовую аутентификацию HTTP и загружает пользователей прямо из
файла <tt class="docutils literal"><code>security.yaml</code></tt>.</p>
<p>Ваши следующие шаги зависят от вашей установки:</p>
<ul class="simple">
<li>Создайте другой способ для входа пользователей в систему, например, <a class="reference internal" href="security.html#security-form-login"><span>форму входа</span></a>
или <a class="reference internal" href="security\custom_authentication_provider.html"><em>что-то полностью заказное</em></a>;</li>
<li>Загрузите пользователей из другого источника, например <a class="reference internal" href="security\entity_provider.html"><em>БД</em></a>
или <a class="reference internal" href="security\custom_provider.html"><em>какого-то другого</em></a> еще;</li>
<li>Узнайте, как отказать в доступе, загрузить объект User и справиться с ролями
в разделе <a class="reference internal" href="security.html#security-authorization"><span>Авторизация</span></a>.</li>
</ul>
</div>
</div>
<div class="section" id="security-authorization-ru">
<span id="id4"></span><h2>2) Отказ в доступе, роли и другая авторизация<a class="headerlink" href="#security-authorization-ru" title="Permalink to this headline">¶</a></h2>
<p>Теперь пользователи могут входить в ваше приложение, используя <tt class="docutils literal"><code>http_basic</code></tt>
или какой-то другой метод. Отлично! Теперь вам надо узнать, как отказать в
доступе и работать с объектом User. Это называется <strong>авторизация</strong>, и ее задача -
решить, имеет ли пользователь доступ к какому-то ресурсу (URL, объекту модели,
методу вызова и т.д.).</p>
<p>Процесс авторизации имеет две стороны:</p>
<ol class="arabic simple">
<li>Пользователь получает конкретный набор ролей, когда входит в систему
(например, <tt class="docutils literal"><code>ROLE_ADMIN</code></tt>);</li>
<li>Вы добавляет код, чтобы ресурс (например, URL или контроллер) требовал
специальный «атрибут» (чаще всего роль вроде <tt class="docutils literal"><code>ROLE_ADMIN</code></tt>) для получения доступа.</li>
</ol>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Вдобавок к ролям (например, <tt class="docutils literal"><code>ROLE_ADMIN</code></tt>), вы можете защитить ресурс,
используя другие атрибуты/строки (например,  <tt class="docutils literal"><code>EDIT</code></tt>), и использовать
избирателя, чтобы придать им значение. Это может быть удобным,
если вам нужно проверить, может ли пользователь А EDIT (править) некий объект
Б (например, продукт с id 5). См. <span class="xref std std-ref">Безопасные объекты security-secure-objects</span>.
See <a class="reference internal" href="security.html#security-secure-objects"><span>Access Control Lists (ACLs): Securing individual Database Objects</span></a>.</p>
</div></div>
<div class="section" id="id5">
<h3>Роли<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Когда пользователь выполняет вход, он получает набор ролей (например,
<tt class="docutils literal"><code>ROLE_ADMIN</code></tt>). В примере выше, они жестко закодированы в <tt class="docutils literal"><code>security.yaml</code></tt>.
Если вы загружаете пользователей из базы данных, они, скорее всего,
хранятся в столбце вашей таблицы.</p>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">Все роли, которые вы назначаете пользователям, <strong>должны</strong> начинаться с
префикса <tt class="docutils literal"><code>ROLE_</code></tt>. В другом случае, они не будут нормально восприниматься
системой безопасности Symfony (т.е. кроме случаев, когда вы делаете
что-то продвинутое, назначение пользователю роли вроде <tt class="docutils literal"><code>FOO</code></tt>, а потом
поиск <tt class="docutils literal"><code>FOO</code></tt> методом,  <a class="reference internal" href="security.html#security-role-authorization"><span>описанным ниже</span></a>, не сработает).</p>
</div></div>
<p>Роли - это просто, и по сути они являются строками, которые вы придумываете и
используете так, как вам нужно. Например, если вам нужно начать ограничивать
доступ к админской секции блога, вы можете защитить ее, используя роль
<tt class="docutils literal"><code>ROLE_BLOG_ADMIN</code></tt>. Эта роль не должна быть нигде обозначена - вы просто
можете начать ее использовать.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Убедитесь, что каждый пользователь имеет как минимум <em>одну</em> роль, иначе
ваш пользователь будет выглядеть не аутентифицированным. Общим соглашением
является давать <em>каждому</em> пользователю роль <tt class="docutils literal"><code>ROLE_USER</code></tt>.</p>
</div></div>
<p>Вы также можете указать <a class="reference internal" href="security.html#security-role-hierarchy"><span>иерархию ролей</span></a>, где
некоторые роли автоматически означают,что у вас есть еще другие роли.</p>
</div>
<div class="section" id="security-role-authorization-ru">
<span id="id6"></span><h3>Добавление кода для запрета доступа<a class="headerlink" href="#security-role-authorization-ru" title="Permalink to this headline">¶</a></h3>
<p>Существует <strong>два</strong> способа запретить доступ к чему-либо:</p>
<ol class="arabic simple">
<li><a class="reference internal" href="security.html#security-authorization-access-control"><span>access_control в security.yaml</span></a>
позволяет вам защитить шаблоны URL (например, <tt class="docutils literal"><code>/admin/*</code></tt>). Это легкий,
но не гибкий способ;</li>
<li><a class="reference internal" href="security.html#security-securing-controller"><span>запрет в вашем коде с помощью сервиса security.authorization_checker</span></a>.</li>
</ol>
<div class="section" id="url-access-control">
<span id="security-authorization-access-control-ru"></span><h4>Безопасность шаблонов URL (access_control)<a class="headerlink" href="#url-access-control" title="Permalink to this headline">¶</a></h4>
<p>Самым базовым способом защитить часть вашего приложения является защита всего
шаблона URL. Вы видели это раньше, когда всему, совпадающему с регулярным
выражением <tt class="docutils literal"><code>^/admin</code></tt> необходима роль <tt class="docutils literal"><code>ROLE_ADMIN</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="c1"># ...</span>
        <span class="l l-Scalar l-Scalar-Plain">main</span><span class="p p-Indicator">:</span>
            <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="c1"># потребовать ROLE_ADMIN для /admin*</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/admin</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>

        <span class="c">&lt;!-- потребовать ROLE_ADMIN для /admin* --&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="c1">// ...</span>
        <span class="s1">&#39;main&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// ...</span>
        <span class="p">),</span>
    <span class="p">),</span>
   <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
       <span class="c1">// потребовать ROLE_ADMIN для /admin*</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Это прекрасно для защиты целых разделов, но вам также может захотеться
<a class="reference internal" href="security.html#security-securing-controller"><span>обезопасить индивидуальные контроллеры</span></a>.</p>
<p>Вы можете определить столько шаблонов URL, сколько вам нужно - каждый является
регулярным выражением. <strong>НО</strong> только <strong>один</strong> будет сопоставлен. Symfony будет
рассматривать каждый, начиная с начала, и остановится как только найдет запись
<tt class="docutils literal"><code>access_control</code></tt>, которая совпадает с URL.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">access_control</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/admin/users</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_SUPER_ADMIN</span> <span class="p p-Indicator">}</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span> <span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">^/admin</span><span class="p p-Indicator">,</span> <span class="nv">roles</span><span class="p p-Indicator">:</span> <span class="nv">ROLE_ADMIN</span> <span class="p p-Indicator">}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin/users&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_SUPER_ADMIN&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;rule</span> <span class="na">path=</span><span class="s">&quot;^/admin&quot;</span> <span class="na">role=</span><span class="s">&quot;ROLE_ADMIN&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;access_control&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin/users&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_SUPER_ADMIN&#39;</span><span class="p">),</span>
        <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;^/admin&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Вставка в начале маршрута символа ^ означает, что только URL <em>начинающиеся</em> с
шаблона, будут сопоставлены. Например, маршрут simply  <tt class="docutils literal"><code>/admin</code></tt> (без ^) будет
сопоставлен с <tt class="docutils literal"><code>/admin/foo</code></tt>, но кроме того еще и с URL вроде <tt class="docutils literal"><code>/foo/admin</code></tt>.</p>
<div class="admonition-wrapper" id="security-access-control-explanation-ru">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title">Понимание принципа работы <tt class="docutils literal"><code>access_control</code></tt></p>
<p>Раздел <tt class="docutils literal"><code>access_control</code></tt> - очень мощный, но может быть опасным (так
как имеет отношение к безопасности), если вы не понимаете <em>принципа</em> его
работы. Вдобавок к URL, <tt class="docutils literal"><code>access_control</code></tt> может совпадать с IP-адресом,
именем хоста и методами HTTP. Он также может быть использован для перенаправления
пользователя на <tt class="docutils literal"><code>https</code></tt> версии шаблона URL.</p>
<p class="last">Чтобы узнать обо всем этом, см. <a class="reference internal" href="security\access_control.html"><em>Как работает безопасность access_control?</em></a>.</p>
</div></div>
</div>
<div class="section" id="security-securing-controller-ru">
<span id="id7"></span><h4>Безопасность контроллеров и другого кода<a class="headerlink" href="#security-securing-controller-ru" title="Permalink to this headline">¶</a></h4>
<p>Вы можете с легкостью отказать в доступе из контроллера:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Второй параметр используется для указания объекта тестирования роли.</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;Unable to access this page!&#39;</span><span class="p">);</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p><tt class="docutils literal"><code>denyAccessUnlessGranted()</code></tt> - это сокращение, предоставленное необязательным
<a class="reference internal" href="controller.html#the-base-controller-class-services"><span>базовым контроллером, предоставленным Symfony</span></a>.
Он эквивалентен следующему коду:</p>
<div class="literal-block"><div class="last highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Authorization\AuthorizationCheckerInterface</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\Exception\AccessDeniedException</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nx">AuthorizationCheckerInterface</span> <span class="nv">$authChecker</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">false</span> <span class="o">===</span> <span class="nv">$authChecker</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">AccessDeniedException</span><span class="p">(</span><span class="s1">&#39;Unable to access this page!&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
<p>Если доступ не предоставлен, вызывается специальный
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/AccessDeniedException Symfony/Component/Security/Core/Exception/AccessDeniedException.html" title="AccessDeniedException Symfony\Component\Security\Core\Exception\AccessDeniedException">AccessDeniedException</a></code></tt>,
который, в конечном счете, запускает ответ HTTP 403 в Symfony.</p>
<p>Вот и все! Если пользователь еще не выполнил вход, приложение попросит его это сделать
(например, перенаправит на страницу входа). Если он <em>уже</em> вошел, но <em>не</em> имеет роли
<tt class="docutils literal"><code>ROLE_ADMIN</code></tt>, будет отображена страница отказа в доступе 403 (которую вы можете
<a class="reference internal" href="controller\error_pages.html#controller-error-pages-by-status-code"><span>настроить</span></a>). Если пользователь в системе
и имеет правильные роли, код будет выполнен.</p>
<p id="security-securing-controller-annotations-ru">Благодаря SensioFrameworkExtraBundle вы также можете обезопасить ваш контроллер
с помощью аннотаций:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="k">use</span> <span class="nx">Sensio\Bundle\FrameworkExtraBundle\Configuration\Security</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @Security(&quot;has_role(&#39;ROLE_ADMIN&#39;)&quot;)</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">hello</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Для более подробной информации смотрите документацию  <a class="reference external" href="https://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/index.html">FrameworkExtraBundle documentation</a>.</p>
</div>
<div class="section" id="security-template-ru">
<span id="id8"></span><h4>Контроль доступа в шаблонах<a class="headerlink" href="#security-template-ru" title="Permalink to this headline">¶</a></h4>
<p>Если вы хотите проверить, имеет ли текущий пользователь роль в шаблоне, используйте
встроенную функцию помощника <tt class="docutils literal"><code>is_granted()</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="o">)</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-html+php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;security&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endif</span> <span class="cp">?&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
</div>
<div class="section" id="id9">
<h4>Безопасность других сервисов<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>Все в Symfony можно защитить, если сделать с кодом что-то похожее на защиту
контроллера. Например, представьте, что у вас есть сревис (т.е. PHP-класс),
задачей которого является отправка email’ов. Вы можете ограничить использование
этого класса - независимо от того, откуда он используется - для некоторых
пользователей.</p>
<p>Для более детальной информации см.
<a class="reference internal" href="security\securing_services.html"><em>Как защитить любой сервис или метод в вашем приложении</em></a>.</p>
</div>
</div>
<div class="section" id="is-athenticated-fully">
<h3>Проверка выполнения входа пользователем (IS_ATHENTICATED_FULLY)<a class="headerlink" href="#is-athenticated-fully" title="Permalink to this headline">¶</a></h3>
<p>До сих пор, вы проверяли доступ, основываясь на ролях - строках, начинающихся
с <tt class="docutils literal"><code>ROLE_</code></tt> и приписанных пользователям. Но если вы <em>только</em> хотите проверить,
выполнил ли пользователь вход (вас не волнуют роли), вы можете использовать
<tt class="docutils literal"><code>IS_AUTHENTICATED_FULLY</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">helloAction</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;security.authorization_checker&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createAccessDeniedException</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Конечно, вы также можете использовать это в <tt class="docutils literal"><code>access_control</code></tt>.</p>
</div></div>
<p><tt class="docutils literal"><code>IS_AUTHENTICATED_FULLY</code></tt> не роль, но ведет себя похоже на нее, и каждый
пользователь, который успешно выполнил вход, будет иметь его. На самом деле,
есть три таких специальных атрибута:</p>
<ul class="simple">
<li><tt class="docutils literal"><code>IS_AUTHENTICATED_REMEMBERED</code></tt>: <em>Все</em> пользователи, выполнившие вход, имеют
это, даже если они в системе благодаря куки-файлу <a class="reference internal" href="security\remember_me.html"><em>запомнить меня functionality</em></a>.
Даже если вы не используете функционал «запомнить меня», вы можете использовать
это, чтобы проверить, вошел ли пользователь.</li>
<li><tt class="docutils literal"><code>IS_AUTHENTICATED_FULLY</code></tt>:  Это похоже на <tt class="docutils literal"><code>IS_AUTHENTICATED_REMEMBERED</code></tt>, но
сильнее. Пользователи, которые вошли только благодаря куки-файлу «запомнить
меня», будут иметь <tt class="docutils literal"><code>IS_AUTHENTICATED_REMEMBERED</code></tt>, но не будут иметь
<tt class="docutils literal"><code>IS_AUTHENTICATED_FULLY</code></tt>.</li>
<li><tt class="docutils literal"><code>IS_AUTHENTICATED_ANONYMOUSLY</code></tt>: <em>Все</em> пользователи (даже анонимные) имеют это
- это удобно при использовании технологии <em>белых списков</em> URL для гарантии доступа
- некоторые детали можно узнать в <a class="reference internal" href="security\access_control.html"><em>Как работает безопасность access_control</em></a>.</li>
</ul>
<p id="security-template-expression-ru">Вы также можете использовать выражения внутри ваших шаблонов:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="literal-block"><div class="highlight-html+jinja"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="nv">expression</span><span class="o">(</span>
    <span class="s1">&#39;&quot;ROLE_ADMIN&quot; in roles or (user and user.isSuperAdmin())&#39;</span>
<span class="o">))</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-html+php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;security&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="k">new</span> <span class="nx">Expression</span><span class="p">(</span>
    <span class="s1">&#39;&quot;ROLE_ADMIN&quot; in roles or (user and user.isSuperAdmin())&#39;</span>
<span class="p">)))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;...&quot;</span><span class="p">&gt;</span>Delete<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Для более подробной информации о выражениях и безопасности, смотрите
<a class="reference internal" href="security\expressions.html"><em>Security: Complex Access Controls with Expressions</em></a>.</p>
</div>
<div class="section" id="acl">
<span id="security-secure-objects-ru"></span><h3>Списки контроля доступа (ACL): Безопасность отдельных объектов БД<a class="headerlink" href="#acl" title="Permalink to this headline">¶</a></h3>
<p>Представьте, что вы создаете блог, где пользователи могут комментировать ваши
записи. Вы также хотите, чтобы пользователь мог редактировать свои комментарии
(но не комментарии других пользователей). Кроме того, как администратор, вы
сами хотите иметь возможность редактировать <em>все</em> комментарии.</p>
<p><a class="reference internal" href="security\voters.html"><em>Избиратели</em></a> позволяют вам писать собственную бизнес-логику
(например, пользователь может редактировать этот пост, потому что он был его создателем),
для определения прав доступа. Поэтому избиратели официально рекомендуются Symfony для
создания систем безопасности, схожих с ACL.</p>
<p>Если вы всё равно предпочитаете использовать традиционные ACL, см.
<a class="reference external" href="https://github.com/symfony/acl-bundle">Пакет Symfony ACL</a>.</p>
</div>
</div>
<div class="section" id="user">
<h2>3) Извлечение объекта User<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h2>
<p>После аутентификации, к объекту <tt class="docutils literal"><code>User</code></tt> текущего пользователя можно получить
доступ через сокращение <tt class="docutils literal"><code>getUser()</code></tt> (которое использоует сервис
<tt class="docutils literal"><code>security.token_storage</code></tt>). Изнутри контроллера, это будет выглядеть так:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="p">);</span>

    <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Пользователь будет объектом, а класс этого объекта будет зависеть от
вашего <a class="reference internal" href="security.html#security-user-providers"><span>провайдера пользователя</span></a>.</p>
</div></div>
<p>Теперь вы можете вызывать любые методы, которые есть в <em>вашем</em> объекте User.
Например, если ваш объект User имеет метод <tt class="docutils literal"><code>getFirstName()</code></tt>, вы можете это
использовать:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">&#39;Well hi there &#39;</span><span class="o">.</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getFirstName</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="section" id="id10">
<h3>Всегда проверяйте, выполнил ли пользователь вход<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Очень важно в первую очередь проверять, аутентифицирован ли пользователь. Если
нет, тогда <tt class="docutils literal"><code>$user</code></tt> будет либо <tt class="docutils literal"><code>null</code></tt>, либо строкой <tt class="docutils literal"><code>anon.</code></tt>. Стоп, что?
Да, вот такая особенность. Если вы не выполнили вход, то пользователь технически
является строкой <tt class="docutils literal"><code>anon.</code></tt>, хотя сокращение контроллера <tt class="docutils literal"><code>getUser()</code></tt> конвертирует
ее в <tt class="docutils literal"><code>null</code></tt> для удобства.</p>
<p>Основная мысль: всегда проверяйте, выполнил ли пользователь вход перед тем,
как использовать объект User, и используйте метод <tt class="docutils literal"><code>isGranted()</code></tt> (или
<a class="reference internal" href="security.html#security-authorization-access-control"><span>access_control</span></a>) для этого:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ура! Используйте это, чтобы увидеть, выполнил ли пользователь вход</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">denyAccessUnlessGranted</span><span class="p">(</span><span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="p">);</span>

<span class="c1">//  бу :(. Никогда не проверяйте объект User для проверки выполнения входа</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p>Альтернативным способом получения текущего пользователя в контроллере является
типизирование аргумента контроллера с помощью
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Security/Core/User/UserInterface/UserInterface.html" title="Symfony\Component\Security\Core\User\UserInterface\UserInterface">UserInterface</a></code></tt>
(установите значение по умолчанию <tt class="docutils literal"><code>null</code></tt>, если вход в систему необязателен):</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Security\Core\User\UserInterface\UserInterface</span><span class="p">;</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">(</span><span class="nx">UserInterface</span> <span class="nv">$user</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// $user - null, если пользователь не выполил вход или анонимен.</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p class="last">Это рекомендуется только для опытных разработчиков, которые не расширяют из
<a class="reference internal" href="controller.html#the-base-controller-class-services"><span>базового контроллера Symfony</span></a> и
не используют <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Bundle/FrameworkBundle/Controller/ControllerTrait.html" title="Symfony\Bundle\FrameworkBundle\Controller\ControllerTrait">ControllerTrait</a></code></tt>.
В других случаях рекомендуется продолжать использоваиие ярлыка <tt class="docutils literal"><code>getUser()</code></tt>.</p>
</div></div>
</div>
<div class="section" id="id11">
<h3>Поиск пользователя в шаблоне<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>В шаблоне Twig доступ к объекту можно получить с помощью ключа
<a class="reference internal" href="reference\twig_reference.html#reference-twig-global-app"><span>app.user</span></a>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="literal-block"><div class="highlight-html+twig"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">is_granted</span><span class="o">(</span><span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="o">)</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Username: <span class="cp">{{</span> <span class="nv">app.user.username</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-html+php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;security&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">&#39;IS_AUTHENTICATED_FULLY&#39;</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Username: <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getUsername</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endif</span><span class="p">;</span> <span class="cp">?&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="security-logging-out-ru">
<span id="id12"></span><h2>Выход из системы<a class="headerlink" href="#security-logging-out-ru" title="Permalink to this headline">¶</a></h2>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">Заметьте, что при использовании базовых HTTP-аутентифицированных брендмауеров,
нет реального способа выполнить выход: единственный сопсоб <em>выйти</em> - это
заставить браузер перестать высылать ваше имя и пароль на каждый запрос. Очистка
кеша вашего браузера или его перезагрузка обычно помогает. Некоторые веб-инструменты
разработки могут также быть полезными.</p>
</div></div>
<p>Чаще всего вам может захотеться, чтобы ваши пользователи могли выйти из
системы. К счастью, брандмауэр может позаботиться об этом автоматически
при активации параметра конфигурации <tt class="docutils literal"><code>logout</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">firewalls</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">secured_area</span><span class="p p-Indicator">:</span>
            <span class="c1"># ...</span>
            <span class="l l-Scalar l-Scalar-Plain">logout</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span>   <span class="l l-Scalar l-Scalar-Plain">/logout</span>
                <span class="l l-Scalar l-Scalar-Plain">target</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;firewall</span> <span class="na">name=</span><span class="s">&quot;secured_area&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;logout</span> <span class="na">path=</span><span class="s">&quot;/logout&quot;</span> <span class="na">target=</span><span class="s">&quot;/&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/firewall&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;firewalls&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;secured_area&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// ...</span>
            <span class="s1">&#39;logout&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/&#39;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Далее вам понадобится создать маршрут для этого URL (но не контроллера):</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/routes.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">logout</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/logout</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/routes.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;routes</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/routing&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/routing</span>
<span class="s">        http://symfony.com/schema/routing/routing-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;route</span> <span class="na">id=</span><span class="s">&quot;logout&quot;</span> <span class="na">path=</span><span class="s">&quot;/logout&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/routes&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/routes.php</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\RouteCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Routing\Route</span><span class="p">;</span>

<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RouteCollection</span><span class="p">();</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">));</span>

<span class="k">return</span> <span class="nv">$collection</span><span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Вот и все! Перенавпрляя пользователя на <tt class="docutils literal"><code>/logout</code></tt> (или на любой созданный
вами <tt class="docutils literal"><code>path</code></tt> (путь)), Symfony разаутентифицирует текущего пользователя.</p>
<p>После того, как пользователь выйдет, он будет перенаправлен по пути,
обозначенному в параметре <tt class="docutils literal"><code>target</code></tt> выше (например, на <tt class="docutils literal"><code>homepage</code></tt>
(главную страницу)).</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Если вам нужно сделать что-то более интересное после выхода из системы,
вы можете указать обработчик выполнения успешного выхода, добавив ключ
<tt class="docutils literal"><code>success_handler</code></tt> и указав ему сервис-id класса выполняющего
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Security/Http/Logout/LogoutSuccessHandlerInterface.html" title="Symfony\Component\Security\Http\Logout\LogoutSuccessHandlerInterface">LogoutSuccessHandlerInterface</a></code></tt>.
Смотрите <a class="reference internal" href="reference\configuration\security.html"><em>Справочник конфигурации безопасности</em></a>.</p>
</div></div>
</div>
<div class="section" id="security-role-hierarchy-ru">
<span id="id13"></span><h2>Иерархические роли<a class="headerlink" href="#security-role-hierarchy-ru" title="Permalink to this headline">¶</a></h2>
<p>Вместо того, чтобы ассоциировать пользователей со многими ролями, вы можете
определить правила наследования, создав иерархию ролей:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># config/packages/security.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">security</span><span class="p p-Indicator">:</span>
    <span class="c1"># ...</span>

    <span class="l l-Scalar l-Scalar-Plain">role_hierarchy</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">ROLE_ADMIN</span><span class="p p-Indicator">:</span>       <span class="l l-Scalar l-Scalar-Plain">ROLE_USER</span>
        <span class="l l-Scalar l-Scalar-Plain">ROLE_SUPER_ADMIN</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">ROLE_ADMIN</span><span class="p p-Indicator">,</span> <span class="nv">ROLE_ALLOWED_TO_SWITCH</span><span class="p p-Indicator">]</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- config/packages/security.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;srv:container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/security&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:srv=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;config&gt;</span>
        <span class="c">&lt;!-- ... --&gt;</span>

        <span class="nt">&lt;role</span> <span class="na">id=</span><span class="s">&quot;ROLE_ADMIN&quot;</span><span class="nt">&gt;</span>ROLE_USER<span class="nt">&lt;/role&gt;</span>
        <span class="nt">&lt;role</span> <span class="na">id=</span><span class="s">&quot;ROLE_SUPER_ADMIN&quot;</span><span class="nt">&gt;</span>ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH<span class="nt">&lt;/role&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/srv:container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// config/packages/security.php</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="c1">// ...</span>

    <span class="s1">&#39;role_hierarchy&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;ROLE_ADMIN&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;ROLE_USER&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ROLE_SUPER_ADMIN&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;ROLE_ADMIN&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ROLE_ALLOWED_TO_SWITCH&#39;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>В конфигурации выше, пользователи с ролью <tt class="docutils literal"><code>ROLE_ADMIN</code></tt> также будут иметь роль
<tt class="docutils literal"><code>ROLE_USER</code></tt>. Роль <tt class="docutils literal"><code>ROLE_SUPER_ADMIN</code></tt> имеет роли <tt class="docutils literal"><code>ROLE_ADMIN</code></tt>, <tt class="docutils literal"><code>ROLE_ALLOWED_TO_SWITCH</code></tt>
и <tt class="docutils literal"><code>ROLE_USER</code></tt> (унаследованную от <tt class="docutils literal"><code>ROLE_ADMIN</code></tt>).</p>
</div>
<div class="section" id="id14">
<h2>Заключение<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>Фух, хорошая работа! Теперь вы знаете больше, чем просто основы безопасности.
Самые сложные моменты - когда у вас есть специфические требования. Например,
специальная стратегия аутентификации (например, маркеры API), сложная логика
авторизации и многие другие вещи (потому что безопасность - сложная!).</p>
<p>К счастью, есть много статей о безопасности, которые направлены на то, чтобы
описать многие из сложных ситуаций. Также смотрите раздел справочника
<a class="reference internal" href="reference\configuration\security.html"><em>Безопасность</em></a>. Многие опции не имеют
подробных деталей, но увидеть максимально полное древо конфигурации может быть
полезным.</p>
<p>Удачи!</p>
</div>
<div class="section" id="id15">
<h2>Узнать больше<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id16">
<h3>Аутентификация (Идентификация/Выполнение входа пользователем)<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="security\form_login_setup.html">How to Build a Traditional Login Form</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\ldap.html">Authenticating against an LDAP server</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\entity_provider.html">How to Load Security Users from the Database (the Entity Provider)</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\guard_authentication.html">How to Create a Custom Authentication System with Guard</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\remember_me.html">How to Add &quot;Remember Me&quot; Login Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\impersonating_user.html">How to Impersonate a User</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\form_login.html">How to Customize Redirect After Form Login</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\custom_provider.html">How to Create a custom User Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\custom_password_authenticator.html">How to Create a Custom Form Password Authenticator</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\api_key_authentication.html">How to Authenticate Users with API Keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\custom_authentication_provider.html">How to Create a custom Authentication Provider</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\pre_authenticated.html">Using pre Authenticated Security Firewalls</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\csrf.html">How to Implement CSRF Protection</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\named_encoders.html">How to Choose the Password Encoder Algorithm Dynamically</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\multiple_user_providers.html">How to Use multiple User Providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\multiple_guard_authenticators.html">How to Use Multiple Guard Authenticators</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\firewall_restriction.html">How to Restrict Firewalls to a Specific Request</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\host_restriction.html">How to Restrict Firewalls to a Specific Host</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\user_checkers.html">How to Create and Enable Custom User Checkers</a></li>
</ul>
</div>
</div>
<div class="section" id="id17">
<h3>Авторизация (Отказ в доступе)<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="security\voters.html">How to Use Voters to Check User Permissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\acl.html">How to Use Access Control Lists (ACLs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\acl_advanced.html">How to Use advanced ACL Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\force_https.html">How to Force HTTPS or HTTP for different URLs</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\securing_services.html">How to Secure any Service or Method in your Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\access_control.html">How Does the Security access_control Work?</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\access_denied_handler.html">How to Create a Custom Access Denied Handler</a></li>
</ul>
</div>
</div>
<div class="section" id="id18">
<h3>Другие темы по безопасности<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="security\password_encoding.html">How to Manually Encode a Password</a></li>
<li class="toctree-l1"><a class="reference internal" href="security\security_checker.html">How to Check for Known Security Vulnerabilities in Your Dependencies</a></li>
</ul>
</div>
</div>
</div>
</div>


            </div>

            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>