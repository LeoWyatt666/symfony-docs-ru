<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Компонент HttpFoundation &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css">
    <link rel="stylesheet" href="..\_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="..\index.html">
    <link rel="up" title="The Components" href="index.html">
    <link rel="next" title="The HttpKernel Component" href="http_kernel.html">
    <link rel="prev" title="Конфигурация каталога, где сохраняются файлы сессии" href="../session/sessions_directory-ru.html">

<link rel="stylesheet" href="..\_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="..\_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="..\_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="components doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\..\index.html">
                    <img src="..\..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="..\index.html">Главная</a>
        </li>
    
        <li>
            <a href="index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="..\best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="..\quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="..\reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="..\genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="..\contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Компонент HttpFoundation</a><ul>
<li><a class="reference internal" href="#id1">Установка</a></li>
<li><a class="reference internal" href="#id2">Запрос</a><ul>
<li><a class="reference internal" href="#id3">Оценка данных запроса</a></li>
<li><a class="reference internal" href="#id4">Идентификация запроса</a></li>
<li><a class="reference internal" href="#id5">Симуляция запроса</a></li>
<li><a class="reference internal" href="#id6">Доступ к сессии</a></li>
<li><a class="reference internal" href="#http">Обработка заголовков HTTP</a></li>
<li><a class="reference internal" href="#accept">Доступ к данным заголовков <tt class="docutils literal"><code>Accept-*</code></tt></a></li>
<li><a class="reference internal" href="#id7">Доступ к другим данным</a></li>
<li><a class="reference internal" href="#id8">Переопределение запроса</a></li>
</ul>
</li>
<li><a class="reference internal" href="#component-http-foundation-response-ru">Ответ</a><ul>
<li><a class="reference internal" href="#id10">Отправка ответа</a></li>
<li><a class="reference internal" href="#cookie">Установка Cookie</a></li>
<li><a class="reference internal" href="#id11">Управление HTTP-кешем</a></li>
<li><a class="reference internal" href="#redirect-response-ru">Перенаправление пользователя</a></li>
<li><a class="reference internal" href="#streaming-response-ru">Потоковая передача ответа</a></li>
<li><a class="reference internal" href="#component-http-foundation-serving-files-ru">Подача файлов</a></li>
<li><a class="reference internal" href="#json">Создание JSON Ответа</a></li>
<li><a class="reference internal" href="#jsonp">Обратный вызов JSONP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id15">Сессия</a></li>
<li><a class="reference internal" href="#id16">Узнайте больше</a></li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="..\index.html">Документация</a></li>
                
                <li><a href="index.html">The Components</a></li>
                
                <li class="active">Компонент HttpFoundation</li>
            </ol>

            <div class="page">
                
  <div class="section" id="httpfoundation">
<span id="index-0"></span><h1>Компонент HttpFoundation<a class="headerlink" href="#httpfoundation" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>Компонент HttpFoundation определяет объектно-ориентированный слой
спецификации HTTP.</div></blockquote>
<p>В PHP, запрос представлен некоторыми глобальными переменными (<tt class="docutils literal"><code>$_GET</code></tt>,
<tt class="docutils literal"><code>$_POST</code></tt>, <tt class="docutils literal"><code>$_FILES</code></tt>, <tt class="docutils literal"><code>$_COOKIE</code></tt>, <tt class="docutils literal"><code>$_SESSION</code></tt>, ...), а ответ генерируется
некоторыми функциям (<tt class="docutils literal"><code>echo</code></tt>, <tt class="docutils literal"><code>header()</code></tt>, <tt class="docutils literal"><code>setcookie()</code></tt>, ...).</p>
<p>Компонент Symfony HttpFoundation заменяет эти глобальные переменные и функции
объектно-ориентироанным слоем.</p>
<div class="section" id="id1">
<h2>Установка<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require symfony/http-kernel
</pre></div>
</td></tr></table></div></div>
<p>Также вы можете клонировать репозиторий <a class="reference external" href="https://github.com/symfony/http-kernel">https://github.com/symfony/http-kernel</a>.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">If you install this component outside of a Symfony application, you must
require the <tt class="docutils literal"><code>vendor/autoload.php</code></tt> file in your code to enable the class
autoloading mechanism provided by Composer. Read
<a class="reference internal" href="using_components.html"><em>this article</em></a> for more details.</p>
</div></div>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">Эта статья объясняет как использовать функции HttpFoundation как независимого
компонента в любом приложении PHP. В приложениях Symfony
уже всё настроено и готово к использованию. Прочитайте статью <a class="reference internal" href="..\controller.html"><em>Controller</em></a>
для понимания как использовать эти функции при создании контроллеров.</div></div>
</div>
<div class="section" id="id2">
<h2>Запрос<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Наиболее распространённый способ создать запрос - основать его на текущих глобальных
переменных PHP c <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_createFromGlobals" title="Symfony\Component\HttpFoundation\Request::createFromGlobals()">createFromGlobals()</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Что почти эквивалентно более многословному, но также более гибкому,
вызову <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method___construct" title="Symfony\Component\HttpFoundation\Request::__construct()">__construct()</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Request</span><span class="p">(</span>
    <span class="nv">$_GET</span><span class="p">,</span>
    <span class="nv">$_POST</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="nv">$_COOKIE</span><span class="p">,</span>
    <span class="nv">$_FILES</span><span class="p">,</span>
    <span class="nv">$_SERVER</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="section" id="id3">
<h3>Оценка данных запроса<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>Объект Запроса содержит информацию о запросе клиента. К этой информации можно
получить доступ через несколько публичных свойств:</p>
<ul class="simple">
<li><tt class="docutils literal"><code>request</code></tt>: эквивалент <tt class="docutils literal"><code>$_POST</code></tt>;</li>
<li><tt class="docutils literal"><code>query</code></tt>: эквивалент <tt class="docutils literal"><code>$_GET</code></tt> (<tt class="docutils literal"><code>$request-&gt;query-&gt;get('name')</code></tt>);</li>
<li><tt class="docutils literal"><code>cookies</code></tt>: эквивалент <tt class="docutils literal"><code>$_COOKIE</code></tt>;</li>
<li><tt class="docutils literal"><code>attributes</code></tt>: эквивалента нет - используется вашим приложением для хранения других данных (см. <a class="reference internal" href="http_foundation.html#component-foundation-attributes"><span>below</span></a>);</li>
<li><tt class="docutils literal"><code>files</code></tt>: эквивалент <tt class="docutils literal"><code>$_FILES</code></tt>;</li>
<li><tt class="docutils literal"><code>server</code></tt>: эквивалент <tt class="docutils literal"><code>$_SERVER</code></tt>;</li>
<li><tt class="docutils literal"><code>headers</code></tt>: наиболее эквивалентно субнабору <tt class="docutils literal"><code>$_SERVER</code></tt>
(<tt class="docutils literal"><code>$request-&gt;headers-&gt;get('User-Agent')</code></tt>).</li>
</ul>
<p>Каждое свойство - это экземпляр <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html" title="Symfony\Component\HttpFoundation\ParameterBag">ParameterBag</a></code></tt>
(или его подкласс), с классом содержания данных:</p>
<ul class="simple">
<li><tt class="docutils literal"><code>request</code></tt>: <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html" title="Symfony\Component\HttpFoundation\ParameterBag">ParameterBag</a></code></tt>;</li>
<li><tt class="docutils literal"><code>query</code></tt>:   <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html" title="Symfony\Component\HttpFoundation\ParameterBag">ParameterBag</a></code></tt>;</li>
<li><tt class="docutils literal"><code>cookies</code></tt>: <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html" title="Symfony\Component\HttpFoundation\ParameterBag">ParameterBag</a></code></tt>;</li>
<li><tt class="docutils literal"><code>attributes</code></tt>: <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html" title="Symfony\Component\HttpFoundation\ParameterBag">ParameterBag</a></code></tt>;</li>
<li><tt class="docutils literal"><code>files</code></tt>:   <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/FileBag.html" title="Symfony\Component\HttpFoundation\FileBag">FileBag</a></code></tt>;</li>
<li><tt class="docutils literal"><code>server</code></tt>:  <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ServerBag.html" title="Symfony\Component\HttpFoundation\ServerBag">ServerBag</a></code></tt>;</li>
<li><tt class="docutils literal"><code>headers</code></tt>: <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/HeaderBag.html" title="Symfony\Component\HttpFoundation\HeaderBag">HeaderBag</a></code></tt>.</li>
</ul>
<p>Все экземпляры <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html" title="Symfony\Component\HttpFoundation\ParameterBag">ParameterBag</a></code></tt> имеют методы
для извлечения и обновления данных:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_all" title="Symfony\Component\HttpFoundation\ParameterBag::all()">all()</a></code></tt></dt>
<dd>Возвращает параметры.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_keys" title="Symfony\Component\HttpFoundation\ParameterBag::keys()">keys()</a></code></tt></dt>
<dd>Возвращает ключи параметра.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_replace" title="Symfony\Component\HttpFoundation\ParameterBag::replace()">replace()</a></code></tt></dt>
<dd>Заменяет текущие параметры новым набором.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_add" title="Symfony\Component\HttpFoundation\ParameterBag::add()">add()</a></code></tt></dt>
<dd>Добавляет параметры.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_get" title="Symfony\Component\HttpFoundation\ParameterBag::get()">get()</a></code></tt></dt>
<dd>Возвращает параметр по имени.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_set" title="Symfony\Component\HttpFoundation\ParameterBag::set()">set()</a></code></tt></dt>
<dd>Устаналивает параметр по имени.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_has" title="Symfony\Component\HttpFoundation\ParameterBag::has()">has()</a></code></tt></dt>
<dd>Возвращает <tt class="docutils literal"><code>true</code></tt>, если параметр определён.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_remove" title="Symfony\Component\HttpFoundation\ParameterBag::remove()">remove()</a></code></tt></dt>
<dd>Удаляет параметр.</dd>
</dl>
<p>Экземпляр <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html" title="Symfony\Component\HttpFoundation\ParameterBag">ParameterBag</a></code></tt> также имеет
некоторые методы для фильтрации значений ввода:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_getAlpha" title="Symfony\Component\HttpFoundation\ParameterBag::getAlpha()">getAlpha()</a></code></tt></dt>
<dd>Возвращает алфавитные символы значения параметра;</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_getAlnum" title="Symfony\Component\HttpFoundation\ParameterBag::getAlnum()">getAlnum()</a></code></tt></dt>
<dd>Возвращает алфавитные символы и цифры значения параметра;</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_getBoolean" title="Symfony\Component\HttpFoundation\ParameterBag::getBoolean()">getBoolean()</a></code></tt></dt>
<dd>Возвращает значение параметра преобразованное в булево значение;</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_getDigits" title="Symfony\Component\HttpFoundation\ParameterBag::getDigits()">getDigits()</a></code></tt></dt>
<dd>Возвращает цифры значения параметра;</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_getInt" title="Symfony\Component\HttpFoundation\ParameterBag::getInt()">getInt()</a></code></tt></dt>
<dd>Возвращает значение параметра, преобразованное в число;</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html#method_filter" title="Symfony\Component\HttpFoundation\ParameterBag::filter()">filter()</a></code></tt></dt>
<dd>Фильтрует параметр, используя функцию <tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.filter-var.php" title="filter_var">filter_var</a></code></tt>.</dd>
</dl>
<p>Все геттеры имеют до двух аргументов: первый - это имя параметра, а второй
- значение по умолчанию, которое нужно вернуть, если параметр не существует:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// строка запроса - &#39;?foo=bar&#39;</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="c1">// возвращает &#39;bar&#39;</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="c1">// возвращает null</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">);</span>
<span class="c1">// возвращает &#39;baz&#39;</span>
</pre></div>
</td></tr></table></div></div>
<p>Когда PHP импортирует запрос на запрос, он обрабатывает параметры  запроса
как <tt class="docutils literal"><code>foo[bar]=baz</code></tt>, особенным способом, создавая массив. Так что выможете
получить параметр <tt class="docutils literal"><code>foo</code></tt> и вы получит обратно массив с элементом <tt class="docutils literal"><code>bar</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// строка запроса - &#39;?foo[bar]=baz&#39;</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="c1">// возвращает массив (&#39;bar&#39; =&gt; &#39;baz&#39;)</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;foo[bar]&#39;</span><span class="p">);</span>
<span class="c1">// возвращает null</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)[</span><span class="s1">&#39;bar&#39;</span><span class="p">];</span>
<span class="c1">// возвращает &#39;baz&#39;</span>
</pre></div>
</td></tr></table></div></div>
<p id="component-foundation-attributes-ru">Благодаря публичному свойству <tt class="docutils literal"><code>attributes</code></tt>, вы можете хранить дополнительные
данные в запросе, который также является экземпляром <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ParameterBag.html" title="Symfony\Component\HttpFoundation\ParameterBag">ParameterBag</a></code></tt>.
Это в основном используется для присоединения информации, которая принадлежит
Запросу и должна быть доступна из множества точек вашего приложения.</p>
<p>Наконец, сырые данные, отправленные в теле запроса, могут быть доступны,
используя <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getContent" title="Symfony\Component\HttpFoundation\Request::getContent()">getContent()</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$content</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Например, это может быть полезно для обработки JSON строки, отправленной
приложению удалённым сервисом, использующим метод HTTP POST.</p>
</div>
<div class="section" id="id4">
<h3>Идентификация запроса<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>В вашем приложении,вам нужен способ идентифицировать запрос; в большинстве
случаев, это делается через &quot;путь информации&quot; запроса, который доступен через
метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getPathInfo" title="Symfony\Component\HttpFoundation\Request::getPathInfo()">getPathInfo()</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// для запроса к http://example.com/blog/index.php/post/hello-world</span>
<span class="c1">// путь информации - &quot;/post/hello-world&quot;</span>
<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getPathInfo</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id5">
<h3>Симуляция запроса<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Вместо создания запроса, основанного на глобальных PHP, вы также можете симулировать
запрос:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">create</span><span class="p">(</span>
    <span class="s1">&#39;/hello-world&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_create" title="Symfony\Component\HttpFoundation\Request::create()">create()</a></code></tt> создаёт
запрос, основанный на URI, методе и некоторых параметрах (параметры запроса
или запроса (query), в зависимости от HTTP метода); и конечно, вы также можете
переопределить все другие переменные (по умолчанию, Symfony создаёт разумные
значения по умолчанию для всех глобальных переменных PHP).</p>
<p>Основываясь на таком запросе, вы можете переопределить глобальные переменные
PHP через <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_overrideGlobals" title="Symfony\Component\HttpFoundation\Request::overrideGlobals()">overrideGlobals()</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">overrideGlobals</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Вы также можете дублировать существующий запрос через
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_duplicate" title="Symfony\Component\HttpFoundation\Request::duplicate()">duplicate()</a></code></tt> или
изменить кучу параметров единственным вызовом к
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_initialize" title="Symfony\Component\HttpFoundation\Request::initialize()">initialize()</a></code></tt>.</p>
</div></div>
</div>
<div class="section" id="id6">
<h3>Доступ к сессии<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Если у вас есть сессия, присоединённая к запросу, вы можете получить к ней
доступ через метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getSession" title="Symfony\Component\HttpFoundation\Request::getSession()">getSession()</a></code></tt>;
метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_hasPreviousSession" title="Symfony\Component\HttpFoundation\Request::hasPreviousSession()">hasPreviousSession()</a></code></tt>
сообщает вам, содержит ли запрос сессию, которая была запущена в одном из
предыдущих запросов.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 4.1: </span>Использование <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getSession()" title="Symfony\Component\HttpFoundation\Request::getSession()()">getSession()()</a></code></tt>,
при неустановленной сессии стало устаревшим в Symfony 4.1. Это будет выбрасывать
исключение в Symfony 5.0, когда сессия является <tt class="docutils literal"><code>null</code></tt>. Сначала проверяйте существование
сессии вызывая <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_hasSession()" title="Symfony\Component\HttpFoundation\Request::hasSession()()">hasSession()()</a></code></tt>.</p>
</div>
</div>
<div class="section" id="http">
<h3>Обработка заголовков HTTP<a class="headerlink" href="#http" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 4.1: </span>Класс <tt class="docutils literal"><code>HeaderUtils</code></tt> появился в Symfony 4.1.</p>
</div>
<p>Обработка заголовков HTTP - это нетривиальная задача из-за экранирования и обработки
пробельных символов внитри заголовков. Symfony предоставляет класс
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/HeaderUtils.html" title="Symfony\Component\HttpFoundation\HeaderUtils">HeaderUtils</a></code></tt>, который позволяет абстрагировать
эту сложность и определяет несколько методов для наиболее частых задач:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\HeaderUtils</span><span class="p">;</span>

<span class="c1">// Разбивает заголовок HTTP с помощью одного или нескольких разделителей</span>
<span class="nx">HeaderUtils</span><span class="o">::</span><span class="na">split</span><span class="p">(</span><span class="s1">&#39;da, en-gb;q=0.8&#39;</span><span class="p">,</span> <span class="s1">&#39;,;&#39;</span><span class="p">)</span>
<span class="c1">// =&gt; array(array(&#39;da&#39;), array(&#39;en-gb&#39;), array(&#39;q&#39;, &#39;0.8&#39;))</span>

<span class="c1">// Объединяет массив массивов в один ассоциативный массив</span>
<span class="nx">HeaderUtils</span><span class="o">::</span><span class="na">combine</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)))</span>
<span class="c1">// =&gt; array(&#39;foo&#39; =&gt; &#39;abc&#39;, &#39;bar&#39; =&gt; true)</span>

<span class="c1">// Объединяет ассоциативный массив в строку для использования в заголовке HTTP</span>
<span class="nx">HeaderUtils</span><span class="o">::</span><span class="na">toString</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;a b c&#39;</span><span class="p">),</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="c1">// =&gt; &#39;foo=abc, bar, baz=&quot;a b c&quot;&#39;</span>

<span class="c1">// Экранирует строку, если необходимо</span>
<span class="nx">HeaderUtils</span><span class="o">::</span><span class="na">quote</span><span class="p">(</span><span class="s1">&#39;foo &quot;bar&quot;&#39;</span><span class="p">)</span>
<span class="c1">// =&gt; &#39;foo \&quot;bar\&quot;&#39;</span>

<span class="c1">// Деэкранирует строку</span>
<span class="nx">HeaderUtils</span><span class="o">::</span><span class="na">unquote</span><span class="p">(</span><span class="s1">&#39;foo \&quot;bar\&quot;&#39;</span><span class="p">)</span>
<span class="c1">// =&gt; &#39;foo &quot;bar&quot;&#39;</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="accept">
<h3>Доступ к данным заголовков <tt class="docutils literal"><code>Accept-*</code></tt><a class="headerlink" href="#accept" title="Permalink to this headline">¶</a></h3>
<p>Вы можете с лёгкостью получить доступ к базовым данным, извлечённым из
заголовков <tt class="docutils literal"><code>Accept-*</code></tt>, используя следующие методы:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getAcceptableContentTypes" title="Symfony\Component\HttpFoundation\Request::getAcceptableContentTypes()">getAcceptableContentTypes()</a></code></tt></dt>
<dd>Возвращает список приемлемых типов содержания, в порядке снижения качества.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getAcceptableFormats" title="Symfony\Component\HttpFoundation\Request::getAcceptableFormats()">getAcceptableFormats()</a></code></tt></dt>
<dd>Возвращает список приемлемых клиентских форматов, ассоциированных с запросом.</dd>
</dl>
<p>Заметьте, что
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getAcceptableFormats" title="Symfony\Component\HttpFoundation\Request::getAcceptableFormats()">getAcceptableFormats()</a></code></tt>
будет использовать данные из
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getAcceptableContentTypes" title="Symfony\Component\HttpFoundation\Request::getAcceptableContentTypes()">getAcceptableContentTypes()</a></code></tt>
и вернёт примлимые клиентские форматы:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getAcceptableContentTypes</span><span class="p">();</span>
<span class="c1">// returns [&#39;text/html&#39;, &#39;application/xhtml+xml&#39;, &#39;application/xml&#39;, &#39;*/*&#39;]</span>

<span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getAcceptableFormats</span><span class="p">();</span>
<span class="c1">// returns [&#39;html&#39;, &#39;xml&#39;]</span>
</pre></div>
</td></tr></table></div></div>
<dl class="docutils">
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getLanguages" title="Symfony\Component\HttpFoundation\Request::getLanguages()">getLanguages()</a></code></tt></dt>
<dd>Возвращает список приемлемых языков, в порядке снижения качества.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getCharsets" title="Symfony\Component\HttpFoundation\Request::getCharsets()">getCharsets()</a></code></tt></dt>
<dd>Возвращает список приемлемых наборов символов, в порядке снижения качества.</dd>
<dt><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html#method_getEncodings" title="Symfony\Component\HttpFoundation\Request::getEncodings()">getEncodings()</a></code></tt></dt>
<dd>Возвращает список приемлемых кодировок, в порядке снижения качества.</dd>
</dl>
<p>Если вам нужно получить полный доступ к проанализированным данным из <tt class="docutils literal"><code>Accept</code></tt>,
<tt class="docutils literal"><code>Accept-Language</code></tt>, <tt class="docutils literal"><code>Accept-Charset</code></tt> или <tt class="docutils literal"><code>Accept-Encoding</code></tt>, вы можете использовать
класс утилиты <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/AcceptHeader.html" title="Symfony\Component\HttpFoundation\AcceptHeader">AcceptHeader</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\AcceptHeader</span><span class="p">;</span>

<span class="nv">$acceptHeader</span> <span class="o">=</span> <span class="nx">AcceptHeader</span><span class="o">::</span><span class="na">fromString</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Accept&#39;</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$acceptHeader</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$acceptHeader</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">);</span>
    <span class="nv">$charset</span> <span class="o">=</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="s1">&#39;charset&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
    <span class="nv">$quality</span> <span class="o">=</span> <span class="nv">$item</span><span class="o">-&gt;</span><span class="na">getQuality</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Приемлемые объекты заголовков сортируются в порядке снижения качества</span>
<span class="nv">$acceptHeaders</span> <span class="o">=</span> <span class="nx">AcceptHeader</span><span class="o">::</span><span class="na">fromString</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Accept&#39;</span><span class="p">))</span>
    <span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Также поддерживаются значения по умолчанию, которые могут быть опционально включены
в заголовки <tt class="docutils literal"><code>Accept-*</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$acceptHeader</span> <span class="o">=</span> <span class="s1">&#39;text/plain;q=0.5, text/html, text/*;q=0.8, */*;q=0.3&#39;</span><span class="p">;</span>
<span class="nv">$accept</span> <span class="o">=</span> <span class="nx">AcceptHeader</span><span class="o">::</span><span class="na">fromString</span><span class="p">(</span><span class="nv">$acceptHeader</span><span class="p">);</span>

<span class="nv">$quality</span> <span class="o">=</span> <span class="nv">$accept</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;text/xml&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getQuality</span><span class="p">();</span> <span class="c1">// $quality = 0.8</span>
<span class="nv">$quality</span> <span class="o">=</span> <span class="nv">$accept</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;application/xml&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getQuality</span><span class="p">();</span> <span class="c1">// $quality = 0.3</span>
</pre></div>
</td></tr></table></div></div>
<div class="versionadded">
<p><span class="versionmodified">New in version 4.1: </span>Поддержка значений по умолчанию в заголовках <tt class="docutils literal"><code>Accept-*</code></tt> была представлена в
Symfony 4.1.</p>
</div>
</div>
<div class="section" id="id7">
<h3>Доступ к другим данным<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Класс <tt class="docutils literal"><code>Request</code></tt> имеет множество других методов, которые вы можете
использовать для доступа к информации запроса. Посмотрите на
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Request.html" title="Symfony\Component\HttpFoundation\Request">API Запроса</a></code></tt>,
чтобы узнать больше о них.</p>
</div>
<div class="section" id="id8">
<h3>Переопределение запроса<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Класс <tt class="docutils literal"><code>Request</code></tt> не должен быть переопределён, так как это объект данных,
который представляет HTTP сообщение. Но при перемещении из системы наследования,
добавление методов или изменение некоторого поведения по умолчанию может
помочь. В этом случае, зарегистрируйте вызываемое PHP, которое может создать
экземпляр вашего класса <tt class="docutils literal"><code>Request</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">App\Http\SpecialRequest</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Request</span><span class="o">::</span><span class="na">setFactory</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span>
    <span class="k">array</span> <span class="nv">$query</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$request</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$attributes</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$cookies</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span> <span class="nv">$server</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="k">null</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">SpecialRequest</span><span class="p">(</span>
        <span class="nv">$query</span><span class="p">,</span>
        <span class="nv">$request</span><span class="p">,</span>
        <span class="nv">$attributes</span><span class="p">,</span>
        <span class="nv">$cookies</span><span class="p">,</span>
        <span class="nv">$files</span><span class="p">,</span>
        <span class="nv">$server</span><span class="p">,</span>
        <span class="nv">$content</span>
    <span class="p">);</span>
<span class="p">});</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="component-http-foundation-response-ru">
<span id="id9"></span><h2>Ответ<a class="headerlink" href="#component-http-foundation-response-ru" title="Permalink to this headline">¶</a></h2>
<p>Объект <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html" title="Symfony\Component\HttpFoundation\Response">Response</a></code></tt> содержит всю
информацию, которую нужно отпрвить обратно клиенту из заданного запроса.
Конструктор имеет до трёх аргументов: содержимое ответа, статус-код и массив
HTTP-заголовков:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span>
    <span class="s1">&#39;Content&#39;</span><span class="p">,</span>
    <span class="nx">Response</span><span class="o">::</span><span class="na">HTTP_OK</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;content-type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text/html&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Эту информацию можно также изменять после создания объекта Ответ:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>

<span class="c1">// публичный атрибут заголовка - ResponseHeaderBag</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">);</span>

<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="nx">Response</span><span class="o">::</span><span class="na">HTTP_NOT_FOUND</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>При установке <tt class="docutils literal"><code>Content-Type</code></tt> Ответа, вы можете установить набор символов,
но лучше устанавливать его через метод
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setCharset" title="Symfony\Component\HttpFoundation\Response::setCharset()">setCharset()</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setCharset</span><span class="p">(</span><span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Отметьте, что по умолчанию, Symfony предполагает, что ваши Ответы зашифрованы
с помощью UTF-8.</p>
<div class="section" id="id10">
<h3>Отправка ответа<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>До отправки Ответа вы можете по опционально вызвать метод
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_prepare" title="Symfony\Component\HttpFoundation\Response::prepare()">prepare()</a></code></tt>, чтобы исправить
любую несовместимость со спецификацией HTTP (например, неправильный заголовок
<tt class="docutils literal"><code>Content-Type</code></tt>):</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Отправка ответа клиенту в таком случае заключается в простом вызове
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_send" title="Symfony\Component\HttpFoundation\Response::send()">send()</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="cookie">
<h3>Установка Cookie<a class="headerlink" href="#cookie" title="Permalink to this headline">¶</a></h3>
<p>Cookie ответа могут быть изменены через публичный атрибут <tt class="docutils literal"><code>headers</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Cookie</span><span class="p">;</span>

<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">setCookie</span><span class="p">(</span><span class="k">new</span> <span class="nx">Cookie</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>Метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ResponseHeaderBag.html#method_setCookie" title="Symfony\Component\HttpFoundation\ResponseHeaderBag::setCookie()">setCookie()</a></code></tt>
берёт экземпляр <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Cookie.html" title="Symfony\Component\HttpFoundation\Cookie">Cookie</a></code></tt> в качестве
аргумента.</p>
<p>Вы можете очистить cookie методом
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ResponseHeaderBag.html#method_clearCookie" title="Symfony\Component\HttpFoundation\ResponseHeaderBag::clearCookie()">clearCookie()</a></code></tt>.</p>
<p>Отметьте, что вы можете создать объект <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Cookie.html" title="Symfony\Component\HttpFoundation\Cookie">Cookie</a></code></tt>
из сырого значения заголовка, используя <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Cookie.html#method_fromString" title="Symfony\Component\HttpFoundation\Cookie::fromString()">fromString()</a></code></tt>.</p>
</div>
<div class="section" id="id11">
<h3>Управление HTTP-кешем<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Класс <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html" title="Symfony\Component\HttpFoundation\Response">Response</a></code></tt> имеет богатый набор
методов для управления HTTP-заголовками, относящимися к кешу:</p>
<ul class="simple">
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setPublic" title="Symfony\Component\HttpFoundation\Response::setPublic()">setPublic()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setPrivate" title="Symfony\Component\HttpFoundation\Response::setPrivate()">setPrivate()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_expire" title="Symfony\Component\HttpFoundation\Response::expire()">expire()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setExpires" title="Symfony\Component\HttpFoundation\Response::setExpires()">setExpires()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setMaxAge" title="Symfony\Component\HttpFoundation\Response::setMaxAge()">setMaxAge()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setSharedMaxAge" title="Symfony\Component\HttpFoundation\Response::setSharedMaxAge()">setSharedMaxAge()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setTtl" title="Symfony\Component\HttpFoundation\Response::setTtl()">setTtl()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setClientTtl" title="Symfony\Component\HttpFoundation\Response::setClientTtl()">setClientTtl()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setLastModified" title="Symfony\Component\HttpFoundation\Response::setLastModified()">setLastModified()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setEtag" title="Symfony\Component\HttpFoundation\Response::setEtag()">setEtag()</a></code></tt>;</li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setVary" title="Symfony\Component\HttpFoundation\Response::setVary()">setVary()</a></code></tt>;</li>
</ul>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Методы <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setExpires" title="Symfony\Component\HttpFoundation\Response::setExpires()">setExpires()</a></code></tt>,
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setLastModified" title="Symfony\Component\HttpFoundation\Response::setLastModified()">setLastModified()</a></code></tt> и
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setDate" title="Symfony\Component\HttpFoundation\Response::setDate()">setDate()</a></code></tt> рринимают
любой объект, релизующий <tt class="docutils literal"><code>\DateTimeInterface</code></tt>, включая неизменные объекты
дат.</p>
</div></div>
<p>Метод <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_setCache" title="Symfony\Component\HttpFoundation\Response::setCache()">setCache()</a></code></tt> может
быть использован дляустановки наиболее используемой кещ-информации в одном
вызове метода:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setCache</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;etag&#39;</span>          <span class="o">=&gt;</span> <span class="s1">&#39;abcdef&#39;</span><span class="p">,</span>
    <span class="s1">&#39;last_modified&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(),</span>
    <span class="s1">&#39;max_age&#39;</span>       <span class="o">=&gt;</span> <span class="mi">600</span><span class="p">,</span>
    <span class="s1">&#39;s_maxage&#39;</span>      <span class="o">=&gt;</span> <span class="mi">600</span><span class="p">,</span>
    <span class="s1">&#39;private&#39;</span>       <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
    <span class="s1">&#39;public&#39;</span>        <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>Чтобы проверить, соответствуют ли валидаторы Ответа (<tt class="docutils literal"><code>ETag</code></tt>, <tt class="docutils literal"><code>Last-Modified</code></tt>)
условному значению, указанному в Запросе клиента, используйте метод
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html#method_isNotModified" title="Symfony\Component\HttpFoundation\Response::isNotModified()">isNotModified()</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">isNotModified</span><span class="p">(</span><span class="nv">$request</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Если Ответ не был изменён, он устанавливает статус-код 304 и удаляет настоящее
содержимое ответа.</p>
</div>
<div class="section" id="redirect-response-ru">
<span id="id12"></span><h3>Перенаправление пользователя<a class="headerlink" href="#redirect-response-ru" title="Permalink to this headline">¶</a></h3>
<p>Чтобы перенаправить клиента по другому URL, вы можете использовать класс
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/RedirectResponse.html" title="Symfony\Component\HttpFoundation\RedirectResponse">RedirectResponse</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\RedirectResponse</span><span class="p">;</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RedirectResponse</span><span class="p">(</span><span class="s1">&#39;http://example.com/&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="streaming-response-ru">
<span id="id13"></span><h3>Потоковая передача ответа<a class="headerlink" href="#streaming-response-ru" title="Permalink to this headline">¶</a></h3>
<p>Класс <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/StreamedResponse.html" title="Symfony\Component\HttpFoundation\StreamedResponse">StreamedResponse</a></code></tt> позволяет
вам создавать поток с Ответом для клиента. Содержимое ответа представляется
PHP вызываемым, а не строкой:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\StreamedResponse</span><span class="p">;</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StreamedResponse</span><span class="p">();</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setCallback</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>
    <span class="nb">flush</span><span class="p">();</span>
    <span class="nb">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">);</span>
    <span class="nb">flush</span><span class="p">();</span>
<span class="p">});</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p>Функция <tt class="docutils literal"><code>flush()</code></tt> не сбрасывает буферизацию. Если <tt class="docutils literal"><code>ob_start()</code></tt> был вызван
до этого, или включена опция <tt class="docutils literal"><code>output_buffering</code></tt> <tt class="docutils literal"><code>php.ini</code></tt>, то вы должны
вызывать <tt class="docutils literal"><code>ob_flush()</code></tt> до <tt class="docutils literal"><code>flush()</code></tt>.</p>
<p>Кроме того, PHP не единственный слой, буферизирующий вывод. Ваш веб-сервер
может также использовать буфер, в зависимости от конфигурации. Некоторые
серверы, вроде Nginx, позволяют вам отключать буферизацию на уровне конфигурации
или добавлять спеицальный заголовок HTTP в ответе:</p>
<div class="literal-block"><div class="last highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// отключает буферизацию FastCGI в Nginx только для этого ответа</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;X-Accel-Buffering&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
</div>
<div class="section" id="component-http-foundation-serving-files-ru">
<span id="id14"></span><h3>Подача файлов<a class="headerlink" href="#component-http-foundation-serving-files-ru" title="Permalink to this headline">¶</a></h3>
<p>При отправке файла вы должны добавлять заголовок <tt class="docutils literal"><code>Content-Disposition</code></tt> к
вашему ответу. И хотя создание этого заголовка для базовых загрузок файлов
- это просто, использование не ASCII имён файлов требует больших усилий.
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/ResponseHeaderBag.html#method_makeDisposition" title="Symfony\Component\HttpFoundation\ResponseHeaderBag::makeDisposition()">makeDisposition()</a></code></tt>
абстрагирует тяжелую работу, скрывающуюся за простым API:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\ResponseHeaderBag</span><span class="p">;</span>

<span class="nv">$fileContent</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span> <span class="c1">// the generated file content</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$fileContent</span><span class="p">);</span>

<span class="nv">$disposition</span> <span class="o">=</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">makeDisposition</span><span class="p">(</span>
    <span class="nx">ResponseHeaderBag</span><span class="o">::</span><span class="na">DISPOSITION_ATTACHMENT</span><span class="p">,</span>
    <span class="s1">&#39;foo.pdf&#39;</span>
<span class="p">);</span>

<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="nv">$disposition</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Как вариант, если вы подаёте статичный файл, вы можете использовать
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/BinaryFileResponse.html" title="Symfony\Component\HttpFoundation\BinaryFileResponse">BinaryFileResponse</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\BinaryFileResponse</span><span class="p">;</span>

<span class="nv">$file</span> <span class="o">=</span> <span class="s1">&#39;path/to/file.txt&#39;</span><span class="p">;</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BinaryFileResponse</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p><tt class="docutils literal"><code>BinaryFileResponse</code></tt> автоматически обработает заголовки <tt class="docutils literal"><code>Range</code></tt> и
<tt class="docutils literal"><code>If-Range</code></tt> из запроса. Он также поддерживает``X-Sendfile`` (см. <a class="reference external" href="http://wiki.nginx.org/XSendfile">Nginx</a>
и <a class="reference external" href="https://tn123.org/mod_xsendfile/">Apache</a>). Чтобы воспользоваться этим, вам нужно определить, стоит ли
доверять заголовку <tt class="docutils literal"><code>X-Sendfile-Type</code></tt> и вызвать
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/BinaryFileResponse.html#method_trustXSendfileTypeHeader" title="Symfony\Component\HttpFoundation\BinaryFileResponse::trustXSendfileTypeHeader()">trustXSendfileTypeHeader()</a></code></tt>,
если стоит:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">BinaryFileResponse</span><span class="o">::</span><span class="na">trustXSendfileTypeHeader</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>С <tt class="docutils literal"><code>BinaryFileResponse</code></tt> вы можете продолжать устанавливать <tt class="docutils literal"><code>Content-Type</code></tt>
отправленного файла, или изменять его <tt class="docutils literal"><code>Content-Disposition</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">);</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setContentDisposition</span><span class="p">(</span>
    <span class="nx">ResponseHeaderBag</span><span class="o">::</span><span class="na">DISPOSITION_ATTACHMENT</span><span class="p">,</span>
    <span class="s1">&#39;filename.txt&#39;</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Файл можно удалить после отправки запроса методом
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/BinaryFileResponse.html#method_deleteFileAfterSend" title="Symfony\Component\HttpFoundation\BinaryFileResponse::deleteFileAfterSend()">deleteFileAfterSend()</a></code></tt>.
Пожалуйста, заметьте, что это не работает, если установлен заголовок <tt class="docutils literal"><code>X-Sendfile</code></tt>.</p>
<p>Если размер поданого файла неизвестен (например, потому что он создаётся на лету, или
потому что в нём зарегистрирован фильтр потока PHP  и т.д.), то вы можете передать
экземпляр <tt class="docutils literal"><code>Stream</code></tt> в <tt class="docutils literal"><code>BinaryFileResponse</code></tt>. Это отключит обработку <tt class="docutils literal"><code>Range</code></tt> и
<tt class="docutils literal"><code>Content-Length</code></tt>, переключившись на механизм передачи данных chunked encoding:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\BinaryFileResponse</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\Stream</span><span class="p">;</span>

<span class="nv">$stream</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">Stream</span><span class="p">(</span><span class="s1">&#39;path/to/stream&#39;</span><span class="p">);</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BinaryFileResponse</span><span class="p">(</span><span class="nv">$stream</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Если вы <em>только</em> создали файл во время этого же запроса, файл <em>может</em> быть
отправлен без содержания. Это может произойти в связи со статистикой кешированного
файла, которая возвращает ноль в качестве размера файла. Чтобы исправить эту
проблему, вызовите <tt class="docutils literal"><code>clearstatcache(true, $file)</code></tt> с путём к бинарному файлу.</p>
</div></div>
</div>
<div class="section" id="json">
<span id="component-http-foundation-json-response-ru"></span><h3>Создание JSON Ответа<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p>Любой тип ответа может быть создан через класс
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/Response.html" title="Symfony\Component\HttpFoundation\Response">Response</a></code></tt>, путём установки
правильного содержания и заголовков. JSON ответ может выглядеть так:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="mi">123</span><span class="p">,</span>
<span class="p">)));</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Также существует полезный класс <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/HttpFoundation/JsonResponse.html" title="Symfony\Component\HttpFoundation\JsonResponse">JsonResponse</a></code></tt>,
который может сделать это ешё проще:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\JsonResponse</span><span class="p">;</span>

<span class="c1">// если вы знаете, какие данные отправлять при создании запроса</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JsonResponse</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="mi">123</span><span class="p">));</span>

<span class="c1">// если вы не знаете, какие данные отправлять при создании запроса</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">JsonResponse</span><span class="p">();</span>
<span class="c1">// ...</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setData</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="mi">123</span><span class="p">));</span>

<span class="c1">// если данные дляотправки уже зашифрованы в JSON</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nx">JsonResponse</span><span class="o">::</span><span class="na">fromJsonString</span><span class="p">(</span><span class="s1">&#39;{ &quot;data&quot;: 123 }&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Класс <tt class="docutils literal"><code>JsonResponse</code></tt> устанавливает заголовок <tt class="docutils literal"><code>Content-Type</code></tt> в
<tt class="docutils literal"><code>application/json</code></tt> и шифрует ваши данные в JSON при необходимости.</p>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p>Чтобы избежать XSSI <a class="reference external" href="http://haacked.com/archive/2009/06/25/json-hijacking.aspx">перехвата JSON</a>, вам стоит передать ассоциативный массив
в <tt class="docutils literal"><code>JsonResponse</code></tt> в качестве крайнего массива, а не индексированного массива,
чтобы финальный результат был объектом (например, <tt class="docutils literal"><code>{&quot;object&quot;: &quot;not inside an array&quot;}</code></tt>)
вместо массива (например, <tt class="docutils literal"><code>[{&quot;object&quot;: &quot;inside an array&quot;}]</code></tt>). Прочтите <a class="reference external" href="https://www.owasp.org/index.php/OWASP_AJAX_Security_Guidelines#Always_return_JSON_with_an_Object_on_the_outside">справочник OWASP</a>,
чтобы узнать больше.</p>
<p class="last">Только методы, отвечающие на запросы GET уязвимы к XSSI 'перехвату JSON'. Методы,
отвечающие на запросы POST остаются неуязвимыми.</p>
</div></div>
</div>
<div class="section" id="jsonp">
<h3>Обратный вызов JSONP<a class="headerlink" href="#jsonp" title="Permalink to this headline">¶</a></h3>
<p>Есди вы используете JSONP, вы можете установить функцию обратного вызова, в которую
должны быть переданы данные:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setCallback</span><span class="p">(</span><span class="s1">&#39;handleResponse&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>В этом случае, заголовок <tt class="docutils literal"><code>Content-Type</code></tt> будет <tt class="docutils literal"><code>text/javascript</code></tt>, а содержание
ответа будет выглядеть так:</p>
<div class="literal-block"><div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">handleResponse</span><span class="p">({</span><span class="s1">&#39;data&#39;</span><span class="o">:</span> <span class="mi">123</span><span class="p">});</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="id15">
<h2>Сессия<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>Информация сессии хранится в отдельном документе: <a class="reference internal" href="http_foundation\sessions.html"><em>Session Management</em></a>.</p>
</div>
<div class="section" id="id16">
<h2>Узнайте больше<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="http_foundation\session_configuration.html">Configuring Sessions and Save Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_foundation/session_configuration-ru.html">Конфигурация сессий и обработчики сохранений</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_foundation\session_php_bridge.html">Integrating with Legacy Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_foundation/session_php_bridge-ru.html">Интеграция с унаследованными сессиями</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_foundation\session_testing.html">Testing with Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_foundation/session_testing-ru.html">Тестирование с сессиями</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_foundation\sessions.html">Session Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="http_foundation/sessions-ru.html">Управление сессиями</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\controller.html">Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\controller\argument_value_resolver.html">Extending Action Argument Resolving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller/argument_value_resolver-ru.html">Расширения разрешения аргумента действия</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\controller\error_pages.html">How to Customize Error Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller/error_pages-ru.html">Как настроить страницы ошибок</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\controller\forwarding.html">How to Forward Requests to another Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller/forwarding-ru.html">Как пересылать запросы другому контроллеру</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\controller\service.html">How to Define Controllers as Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller/service-ru.html">Как определять контроллеры как сервисы</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\controller\soap_web_service.html">How to Create a SOAP Web Service in a Symfony Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller/soap_web_service-ru.html">Как создать SOAP веб-сервис в контроллере Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\controller\upload_file.html">How to Upload Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controller/upload_file-ru.html">Как загружать файлы</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\session\avoid_session_start.html">Avoid Starting Sessions for Anonymous Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session/avoid_session_start-ru.html">Избегание запуска сессий для анонимных пользователей</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session/limit_metadata_writes-ru.html">Лимит записи метаданных сесии</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\session\locale_sticky_session.html">Making the Locale &quot;Sticky&quot; during a User's Session</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session/locale_sticky_session-ru.html">Как сделать локаль &quot;липкой&quot; во время сессии пользователя</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\session\php_bridge.html">Bridge a legacy Application with Symfony Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session/php_bridge-ru.html">Свяжите унаследованные приложение с сессиями Symfony</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\session\proxy_examples.html">Session Proxy Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session/proxy_examples-ru.html">Примеры прокси сессии</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\session\sessions_directory.html">Configuring the Directory where Session Files are Saved</a></li>
<li class="toctree-l1"><a class="reference internal" href="../session/sessions_directory-ru.html">Конфигурация каталога, где сохраняются файлы сессии</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\http_cache\cache_invalidation.html">Cache Invalidation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache/cache_invalidation-ru.html">Инвалидация кеша</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\http_cache\cache_vary.html">Varying the Response for HTTP Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache/cache_vary-ru.html">Варьирование ответа для HTTP-кеша</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\http_cache\esi.html">Working with Edge Side Includes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache/esi-ru.html">Работа с включениями крайней стороны</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\http_cache\expiration.html">HTTP Cache Expiration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache/expiration-ru.html">Окочание действия HTTP-кеша</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\http_cache\form_csrf_caching.html">Caching Pages that Contain CSRF Protected Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache/form_csrf_caching-ru.html">Кеширование страниц, содержащих CSRF-защищённые формы</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\http_cache\validation.html">HTTP Cache Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache/validation-ru.html">Валидация HTTP-кеша</a></li>
<li class="toctree-l1"><a class="reference internal" href="..\http_cache\varnish.html">How to Use Varnish to Speed up my Website</a></li>
<li class="toctree-l1"><a class="reference internal" href="../http_cache/varnish-ru.html">Как использовать Varnish для ускорения моего сайта</a></li>
</ul>
</div>
</div>
</div>


            </div>

            
            <div class="navigation">
                <a href="../session/sessions_directory-ru.html">« Конфигурация каталога, где сохраняются файлы сессии</a>
                <span class="separator">|</span>
                <a href="http_kernel.html">The HttpKernel Component »</a>
            </div>
            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>