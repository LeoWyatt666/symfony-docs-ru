<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Компонент PHPUnit Bridge &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="../_static/" type="text/css">
    <link rel="stylesheet" href="..\_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="..\index.html">
    <link rel="up" title="The Components" href="index.html">
    <link rel="next" title="Полизаполнение Symfony / Компонент APCu" href="polyfill_apcu-ru.html">
    <link rel="prev" title="Компонент OptionsResolver (Разрешитель опций)" href="options_resolver-ru.html">

<link rel="stylesheet" href="..\_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="..\_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="..\_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="components doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\..\index.html">
                    <img src="..\..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="..\index.html">Главная</a>
        </li>
    
        <li>
            <a href="index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="..\best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="..\quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="..\reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="..\genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="..\contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Компонент PHPUnit Bridge</a><ul>
<li><a class="reference internal" href="#id1">Установка</a></li>
<li><a class="reference internal" href="#id2">Использование</a></li>
<li><a class="reference internal" href="#id3">Вызов уведомлений об устаревании</a></li>
<li><a class="reference internal" href="#id4">Помечание тестов в качестве наследования</a></li>
<li><a class="reference internal" href="#id5">Конфигурация</a><ul>
<li><a class="reference internal" href="#id6">Как сделать, чтобы тест был неуспешным</a></li>
<li><a class="reference internal" href="#id7">Отключение помощника устареваний</a></li>
</ul>
</li>
<li><a class="reference internal" href="#write-assertions-about-deprecations-ru">Напишите утверждения об устареваниях</a></li>
<li><a class="reference internal" href="#id9">Тесты, чувствительные ко времени</a><ul>
<li><a class="reference internal" href="#id10">Случаи применения</a></li>
<li><a class="reference internal" href="#id11">Имитация часов</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id12">Тесты, чувствительные к СДИ</a><ul>
<li><a class="reference internal" href="#id13">Случаи применения</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id14">Диагностика и устранение неполадок</a></li>
<li><a class="reference internal" href="#phpunit">Изменённый скрипт PHPUnit</a></li>
<li><a class="reference internal" href="#id15">Слушатель покрытия кода</a><ul>
<li><a class="reference internal" href="#id16">Установка</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="..\index.html">Документация</a></li>
                
                <li><a href="index.html">The Components</a></li>
                
                <li class="active">Компонент PHPUnit Bridge</li>
            </ol>

            <div class="page">
                
  <div class="section" id="phpunit-bridge">
<span id="index-0"></span><h1>Компонент PHPUnit Bridge<a class="headerlink" href="#phpunit-bridge" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>PHPUnit Bridge предоставляет утилиты для отчётов о тестах наследия и
использовании устаревшего кода, а также помощника для тестов, чувствительных
ко времени.</div></blockquote>
<p>Он имеет следующие функции:</p>
<ul class="simple">
<li>Заставляет тесты использовать постоянную локаль (<tt class="docutils literal"><code>C</code></tt>);</li>
<li>Авторегистрирует <tt class="docutils literal"><code>class_exists</code></tt>, чтобы загружать аннотации Doctrine (когда они используются);</li>
<li>Отображает полный список устаревших функций, используемых в приложении;</li>
<li>Отображает отслеживание стека устаревшей функции по требованю;</li>
<li>Предоставляет классы помощника <tt class="docutils literal"><code>ClockMock</code></tt> и <tt class="docutils literal"><code>DnsMock</code></tt> для тестов, чувствительных ко времени
и сети;</li>
<li>Предоставляет изменённую версию PHPUnit, которая не имеет встроенного <tt class="docutils literal"><code>symfony/yaml</code></tt> или
<tt class="docutils literal"><code>prophecy</code></tt>, чтобы избежать конфликтов с этими зависимостями.</li>
</ul>
<div class="section" id="id1">
<h2>Установка<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> composer require --dev <span class="s2">&quot;symfony/phpunit-bridge:*&quot;</span>
</pre></div>
</td></tr></table></div></div>
<p>Также вы можете клонировать репозиторий <a class="reference external" href="https://github.com/symfony/phpunit-bridge">https://github.com/symfony/phpunit-bridge</a>.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">If you install this component outside of a Symfony application, you must
require the <tt class="docutils literal"><code>vendor/autoload.php</code></tt> file in your code to enable the class
autoloading mechanism provided by Composer. Read
<a class="reference internal" href="using_components.html"><em>this article</em></a> for more details.</p>
</div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">PHPUnit bridge настроен для всех поддерживаемых версий
компонентов Symfony, даже несколькими мажорными версиями. Вам следует
всегда использовать его последнюю стабильную мажорную версию для получения наиболее точного
отчёта об использовании устаревшего кода.</p>
</div></div>
<p>Если вы планируете <a class="reference internal" href="phpunit_bridge.html#write-assertions-about-deprecations"><span>Write Assertions about Deprecations</span></a> и использовать обычный
скрипт PHPUnit (а не изменённый скрипт PHPUnit, предоставленный Symfony), то вам нужно
зарегистрировать новый <a class="reference external" href="https://phpunit.de/manual/current/en/appendixes.configuration.html#appendixes.configuration.test-listeners">слушатель теста</a> под названием <tt class="docutils literal"><code>SymfonyTestsListener</code></tt>:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- http://phpunit.de/manual/6.0/en/appendixes.configuration.html --&gt;</span>
<span class="nt">&lt;phpunit</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">&quot;http://schema.phpunit.de/6.0/phpunit.xsd&quot;</span>
<span class="nt">&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;listeners&gt;</span>
        <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">&quot;Symfony\Bridge\PhpUnit\SymfonyTestsListener&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/listeners&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id2">
<h2>Использование<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="admonition-wrapper">
<div class="seealso"></div><div class="admonition admonition-seealso">Эта статья объясняет как использовать функции PhpUnitBridge как независимого
компонента в любом приложении PHP. Прочитайте статью <a class="reference internal" href="..\testing.html"><em>Testing</em></a>
для понимания как использовать его в приложениях Symfony.</div></div>
<p>Когда компонент установлен, создаётся скрипт <tt class="docutils literal"><code>simple-phpunit</code></tt> в каталоге <tt class="docutils literal"><code>vendor/</code></tt>
для запуска тестов. Этот скрипт создаёт оболочку для исходного бинарного PHPUnit,
чтобы предоставить больше функций:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> my-project/
<span class="gp">$</span> ./vendor/bin/simple-phpunit
</pre></div>
</td></tr></table></div></div>
<p>После выполнения ваших тестов PHPUnit, вы получите отчёт, похожий на этот:</p>
<img alt="../_images/report.png" src="..\_images\report.png">
<p>Этот отчёт включает в себя:</p>
<dl class="docutils">
<dt><strong>Незаглушенные</strong></dt>
<dd>Сообщает об уведомлениях об устаревании, которые были запущены без рекомендованного
<a class="reference external" href="https://php.net/manual/en/language.operators.errorcontrol.php">оператора &#64;-silencing</a>.</dd>
<dt><strong>Унаследованные</strong></dt>
<dd>Уведомления об устаревании помечают тесты, которые ясно тестируют какие-то функци
наследования.</dd>
<dt><strong>Оставшиеся/Другие</strong></dt>
<dd>Все другие (не наследственные) уведомления об устаревании, сгруппированные по
собщению, классу теста и методу.</dd>
</dl>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p>Если вы не хотите использовать скрипт <tt class="docutils literal"><code>simple-phpunit</code></tt>, зарегистрируйте следующий
<a class="reference external" href="https://phpunit.de/manual/current/en/extending-phpunit.html#extending-phpunit.PHPUnit_Framework_TestListener">слушатель событий PHPUnit</a> в вашем файле конфигурации PHPUnit, чтобы получить такой
же отчёт об устареваниях (который создаётся <a class="reference external" href="http://php.net/manual/en/book.errorfunc.php">обработчиком ошибок PHP</a>, под названием
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Bridge/PhpUnit/DeprecationErrorHandler.html" title="Symfony\Bridge\PhpUnit\DeprecationErrorHandler">DeprecationErrorHandler</a></code></tt>):</p>
<div class="literal-block"><div class="last highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- phpunit.xml.dist --&gt;</span>
<span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;listeners&gt;</span>
    <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">&quot;Symfony\Bridge\PhpUnit\SymfonyTestsListener&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/listeners&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
</div>
<div class="section" id="id3">
<h2>Вызов уведомлений об устаревании<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Уведомления об устаревании могут быть вызваны используя:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">@</span><span class="nb">trigger_error</span><span class="p">(</span><span class="s1">&#39;Your deprecation message&#39;</span><span class="p">,</span> <span class="nx">E_USER_DEPRECATED</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Без <a class="reference external" href="https://php.net/manual/en/language.operators.errorcontrol.php">оператора &#64;-silencing</a> пользователям было бы нужно отказываться от уведомлений
об устаревании. Заглушение этого поведения меняет его настройки по умолчанию и позволяет
пользователям самим выбирать, когда они готовы с ними справляться (путём добавления
пользовательского обработчика ошибок, вроде предоставленного этим мостом). Если они не
заглушены, уведомления об устаревании будут появляться в разделе <strong>Незаглушенные</strong> отчёта
об устаревании.</p>
</div>
<div class="section" id="id4">
<h2>Помечание тестов в качестве наследования<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Существует три способа отметить тест, как наследуемый:</p>
<ul class="simple">
<li>(<strong>Рекомендовано</strong>) Добавьте аннотацию <tt class="docutils literal"><code>&#64;group legacy</code></tt> к его классу или методу;</li>
<li>Сделайте так, чтобы имя его класса начиналось с префикса <tt class="docutils literal"><code>Legacy</code></tt>;</li>
<li>Сделайте так, чтобы имя его метода начиналось с <tt class="docutils literal"><code>testLegacy*()</code></tt> вместо <tt class="docutils literal"><code>test*()</code></tt>.</li>
</ul>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p>Если ваш поставщик данных вызывает код, который обычно вызывает устаревание,
вы можете добавить к его имени префикс <tt class="docutils literal"><code>provideLegacy</code></tt> или <tt class="docutils literal"><code>getLegacy</code></tt>,
чтобы заглушить эти устаревания. Если ваш поставщик данных не выполняет
устаревший код, то необязательно выбирать специальное именование просто потому,
что тест, используемый поставщиком данных, отмечен как наследуемый.</p>
<p class="last">Также имейте в виду, что выбор одного из двух наследственных префиксов не
отметит тесты, как наследуемые, которые используют этот поставщик данных.
Вам всё равно нужно будет ясно указывать их, как наследуемые.</p>
</div></div>
</div>
<div class="section" id="id5">
<h2>Конфигурация<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>В случае, если вам нужно ислледовать отслеживание стека определённого устаревания,
вызванного нашими модульными тестами, вы можете установить <a class="reference external" href="https://phpunit.de/manual/current/en/appendixes.configuration.html#appendixes.configuration.php-ini-constants-variables">переменную окружения</a>
<tt class="docutils literal"><code>SYMFONY_DEPRECATIONS_HELPER</code></tt> в регулярном выражении, которое соответствует сообщению
этого устаревания, заканчивающийся на <tt class="docutils literal"><code>/</code></tt>. Например:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- http://phpunit.de/manual/6.0/en/appendixes.configuration.html --&gt;</span>
<span class="nt">&lt;phpunit</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">&quot;http://schema.phpunit.de/6.0/phpunit.xsd&quot;</span>
<span class="nt">&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;php&gt;</span>
        <span class="nt">&lt;server</span> <span class="na">name=</span><span class="s">&quot;KERNEL_CLASS&quot;</span> <span class="na">value=</span><span class="s">&quot;App\Kernel&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;env</span> <span class="na">name=</span><span class="s">&quot;SYMFONY_DEPRECATIONS_HELPER&quot;</span> <span class="na">value=</span><span class="s">&quot;/foobar/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p><a class="reference external" href="https://phpunit.de">PHPUnit</a> остановит ваш пакет тестов, как только будет вызвано уведомление об
устаревании, сообщение которого содержит строку <tt class="docutils literal"><code>&quot;foobar&quot;</code></tt>.</p>
<div class="section" id="id6">
<h3>Как сделать, чтобы тест был неуспешным<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>По умолчанию, все сообщения об устаревании, тегированные не-наследственными или
не-<a class="reference external" href="https://php.net/manual/en/language.operators.errorcontrol.php">&#64;-silenced</a> заставят тесты терпеть неудачу. Как вариант, вы можете установить
<tt class="docutils literal"><code>SYMFONY_DEPRECATIONS_HELPER</code></tt> в арбитражное значение (например, <tt class="docutils literal"><code>320</code></tt>), что
сделает ваши тесты неуспешными только, если будет достигнуто большее количество
уведомлений об устаревании (<tt class="docutils literal"><code>0</code></tt> - значение по умолчанию). Вы можете также установить
значение <tt class="docutils literal"><code>&quot;weak&quot;</code></tt>, которое заставит мост игнорировать все уведомления об устаревании.
Это полезно для проктов. которые должны использовать устаревшие интерфейсы в связи
с обратной совместимостью.</p>
<p>Когда вы содержите библиотеку, неудача пакета тестов при первом появлении устаревания
в зависимости, нежелательно, так как это возлагает исправление этого устаревания на
любого вкладчика, который отправляет запрос на включение вскоре после того, как с
был сделан релиз поставщика с этим устареванием. Чтобы смягчить это, вы можете либо
использвать более чёткие требования, надеясь, что зависимости не вызовут новых устареваний
в версии патча, либо даже зафиксировать файл блокировки Composer, который будет создавать
другой класс проблем. Поэтому библиотеки будут часто использовать <tt class="docutils literal"><code>SYMFONY_DEPRECATIONS_HELPER=weak</code></tt>.
Это имеет недостаток в виде внесения вкладчиками своих устареваний, но:</p>
<ul class="simple">
<li>забывает исправлять устаревшие вызовы, если они есть;</li>
<li>забывает отмечать соответствующие тесты аннотациями <tt class="docutils literal"><code>&#64;group legacy</code></tt>.</li>
</ul>
<p>При использовании значения <tt class="docutils literal"><code>&quot;weak_vendors&quot;</code></tt>, устаревания, вызванные вне каталога
<tt class="docutils literal"><code>vendors</code></tt> будут делать пакет тестов неуспешным, а устаревания, вызыванные в библиотеке
внутри - не будут, что даст вам максимум преимуществ.</p>
</div>
<div class="section" id="id7">
<h3>Отключение помощника устареваний<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Установите переменную окружения <tt class="docutils literal"><code>SYMFONY_DEPRECATIONS_HELPER</code></tt>, как <tt class="docutils literal"><code>disabled</code></tt>,
чтобы полностью отключить помощника устареваний. Это полезно для использования
остальных функций, предоставляемых этим компонентом, не получая ошибок или сообщений,
относящихся к устареваниям.</p>
</div>
</div>
<div class="section" id="write-assertions-about-deprecations-ru">
<span id="id8"></span><h2>Напишите утверждения об устареваниях<a class="headerlink" href="#write-assertions-about-deprecations-ru" title="Permalink to this headline">¶</a></h2>
<p>При добавлении устареваний в ваш код, вам может захотеться писать тесты, проверяющие,
чтобы они вызывались, как требуется. Чтобы сделать это, мост предоставляет аннотацию
<tt class="docutils literal"><code>&#64;expectedDeprecation</code></tt>, которую вы можете использовать в ваших методах тестов. Она
требует, чтобы вы передали ожидаемое сообщение, данное в том же формате, что и для метода
<a class="reference external" href="https://phpunit.de/manual/current/en/appendixes.assertions.html#appendixes.assertions.assertStringMatchesFormat">PHPUnit assertStringMatchesFormat()</a>. Если вы ожидаете более одного сообщения об
устаревании для заданного метода теста, вы можете использовать аннотацию несколько раз
(порядок имеет значение):</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">/**</span>
<span class="sd"> * @group legacy</span>
<span class="sd"> * @expectedDeprecation This &quot;%s&quot; method is deprecated.</span>
<span class="sd"> * @expectedDeprecation The second argument of the &quot;%s&quot; method is deprecated.</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">testDeprecatedCode</span><span class="p">()</span>
<span class="p">{</span>
    <span class="o">@</span><span class="nb">trigger_error</span><span class="p">(</span><span class="s1">&#39;This &quot;Foo&quot; method is deprecated.&#39;</span><span class="p">,</span> <span class="nx">E_USER_DEPRECATED</span><span class="p">);</span>
    <span class="o">@</span><span class="nb">trigger_error</span><span class="p">(</span><span class="s1">&#39;The second argument of the &quot;Bar&quot; method is deprecated.&#39;</span><span class="p">,</span> <span class="nx">E_USER_DEPRECATED</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id9">
<h2>Тесты, чувствительные ко времени<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>Случаи применения<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Если у вас есть такие тесты, чувствительные ко времени:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Stopwatch\Stopwatch</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$stopwatch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stopwatch</span><span class="p">();</span>

        <span class="nv">$stopwatch</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">(</span><span class="s1">&#39;event_name&#39;</span><span class="p">);</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
        <span class="nv">$duration</span> <span class="o">=</span> <span class="nv">$stopwatch</span><span class="o">-&gt;</span><span class="na">stop</span><span class="p">(</span><span class="s1">&#39;event_name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getDuration</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="nv">$duration</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Вы использвали <a class="reference internal" href="stopwatch.html"><em>Компонент Symfony Секундомер</em></a>, чтобы
подсчитать длительность вашего процесс, тут - 10 секунд. Однако, в зависимости от
нагрузки на сервер или процессов, запущенных на вашей локальой машине, <tt class="docutils literal"><code>$duration</code></tt>
может, к примеру, быть <tt class="docutils literal"><code>10.000023s</code></tt> вместо <tt class="docutils literal"><code>10s</code></tt>.</p>
<p>Такие тесты называются переходными тестами: они терпят неудачи рандомно, в
зависимости от побочных и внешних обстоятельств. Они часто вызывают проблемы
при использовании постоянных публичных сервисов интеграции вроде <a class="reference external" href="https://travis-ci.org/">Travis CI</a>.</p>
</div>
<div class="section" id="id11">
<h3>Имитация часов<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Класс <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Bridge/PhpUnit/ClockMock.html" title="Symfony\Bridge\PhpUnit\ClockMock">ClockMock</a></code></tt>, предоставленный этим мостом,
позволяет вам имитировать встроенные PHP функции <tt class="docutils literal"><code>time()</code></tt>, <tt class="docutils literal"><code>microtime()</code></tt>, <tt class="docutils literal"><code>sleep()</code></tt>
и <tt class="docutils literal"><code>usleep()</code></tt>.</p>
<p>Чтобы использовать в вашем тесте класс <tt class="docutils literal"><code>ClockMock</code></tt>, добавьте аннотацию
<tt class="docutils literal"><code>&#64;group time-sensitive</code></tt> к его классу или методам. Эта аннотация работает
только при выполнении PHPUnit, используя скрипт <tt class="docutils literal"><code>vendor/bin/simple-phpunit</code></tt>,
или при регистрации следующего слушателя в вашей конфигурации PHPUnit:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- phpunit.xml.dist --&gt;</span>
<span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;listeners&gt;</span>
    <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">&quot;\Symfony\Bridge\PhpUnit\SymfonyTestsListener&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/listeners&gt;</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Если вы не хотите использовать аннотацию  <tt class="docutils literal"><code>&#64;group time-sensitive</code></tt>, вы
можете зарегистрировать класс <tt class="docutils literal"><code>ClockMock</code></tt> вручную, вызвав
<tt class="docutils literal"><code>ClockMock::register(__CLASS__)</code></tt> и <tt class="docutils literal"><code>ClockMock::withClockMock(true)</code></tt>
до теста, а <tt class="docutils literal"><code>ClockMock::withClockMock(false)</code></tt> - после.</p>
</div></div>
<p>В результате, следующее гарантировано будет работать, и больше не будет являться
переходным тестом:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Stopwatch\Stopwatch</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @group time-sensitive</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$stopwatch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Stopwatch</span><span class="p">(</span><span class="s1">&#39;event_name&#39;</span><span class="p">);</span>

        <span class="nv">$stopwatch</span><span class="o">-&gt;</span><span class="na">start</span><span class="p">();</span>
        <span class="nb">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
        <span class="nv">$duration</span> <span class="o">=</span> <span class="nv">$stopwatch</span><span class="o">-&gt;</span><span class="na">stop</span><span class="p">(</span><span class="s1">&#39;event_name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getDuration</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="nv">$duration</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>И это всё!</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Дополнительный бонус использования класса <tt class="docutils literal"><code>ClockMock</code></tt> - время проходит
моментально. Использование PHP <tt class="docutils literal"><code>sleep(10)</code></tt> заставит ваш тест ждать 10
настоящих секунд (плюс минус). В противовес этому, класс <tt class="docutils literal"><code>ClockMock</code></tt>
переводит внуренние часы на заданное количество секунд, не ожидая это время
на самом деле, поэтому ваш тест будет выполнен на 10 секунд быстрее.</p>
</div></div>
</div>
</div>
<div class="section" id="id12">
<h2>Тесты, чувствительные к СДИ<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>Тесты, создающие соединения сети, например, проверка валидности записи СДИ
(Системы доменных имён) может быть долгой в выполнении и ненадёжной вследствие
условий сети. По этой причине, данный компонент также предоставляет имитации
этих PHP функций:</p>
<ul class="simple">
<li><tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.checkdnsrr.php" title="checkdnsrr">checkdnsrr</a></code></tt></li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.dns-check-record.php" title="dns_check_record">dns_check_record</a></code></tt></li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.getmxrr.php" title="getmxrr">getmxrr</a></code></tt></li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.dns-get-mx.php" title="dns_get_mx">dns_get_mx</a></code></tt></li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.gethostbyaddr.php" title="gethostbyaddr">gethostbyaddr</a></code></tt></li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.gethostbyname.php" title="gethostbyname">gethostbyname</a></code></tt></li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.gethostbynamel.php" title="gethostbynamel">gethostbynamel</a></code></tt></li>
<li><tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.dns-get-record.php" title="dns_get_record">dns_get_record</a></code></tt></li>
</ul>
<div class="section" id="id13">
<h3>Случаи применения<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>Рассмотрите следующий пример, который использует опцию <tt class="docutils literal"><code>checkMX</code></tt> ограничения
<tt class="docutils literal"><code>Email</code></tt>, чтобы протестировать валидность домена электронной почты:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\Email</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEmail</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$validator</span> <span class="o">=</span> <span class="o">...</span>
        <span class="nv">$constraint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;checkMX&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">));</span>

        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="s1">&#39;<a href="..\..\..\cdn-cgi\l\email-protection.html" class="__cf_email__" data-cfemail="6b0d04042b0e130a061b070e45080406">[email&#160;protected]</a>&#39;</span><span class="p">,</span> <span class="nv">$constraint</span><span class="p">);</span>

        <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Чтобы избежать создания настоящего соединения сети, добавьте аннотацию <tt class="docutils literal"><code>&#64;dns-sensitive</code></tt>
к классу и используйте <tt class="docutils literal"><code>DnsMock::withMockedHosts()</code></tt>, чтобы сконфигурировать данные,
которые вы ожидаете получить для заданных хостов:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Validator\Constraints\Email</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @group dns-sensitive</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">MyTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testEmails</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">DnsMock</span><span class="o">::</span><span class="na">withMockedHosts</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;example.com&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MX&#39;</span><span class="p">))));</span>

        <span class="nv">$validator</span> <span class="o">=</span> <span class="o">...</span>
        <span class="nv">$constraint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Email</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;checkMX&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">));</span>

        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$validator</span><span class="o">-&gt;</span><span class="na">validate</span><span class="p">(</span><span class="s1">&#39;<a href="..\..\..\cdn-cgi\l\email-protection.html" class="__cf_email__" data-cfemail="2e4841416e4b564f435e424b004d4143">[email&#160;protected]</a>&#39;</span><span class="p">,</span> <span class="nv">$constraint</span><span class="p">);</span>

        <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Конфигурация метода <tt class="docutils literal"><code>withMockedHosts()</code></tt> определяется в виде массива. Ключами являются
сымитированные хосты, а значениями - массивы записей СДИ в том же формате, что возвращается
<tt class="docutils literal"><code><a class="reference external" href="http://php.net/manual/en/function.dns-get-record.php" title="dns_get_record">dns_get_record</a></code></tt>, чтобы вы могли симулировать разнообразные условия сети:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">DnsMock</span><span class="o">::</span><span class="na">withMockedHosts</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;example.com&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ip&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1.2.3.4&#39;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;AAAA&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ipv6&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;::12&#39;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="id14">
<h2>Диагностика и устранение неполадок<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<p>Аннотации <tt class="docutils literal"><code>&#64;group time-sensitive</code></tt> и <tt class="docutils literal"><code>&#64;group dns-sensitive</code></tt> работают
&quot;по соглашению&quot; и предполагают, что пространства имён тестируемого класса
могут быть получены просто путём удаления части <tt class="docutils literal"><code>Tests\</code></tt> из пространств
имён тестов. Т.е., если полное имя класса вашего случая тестирования -
<tt class="docutils literal"><code>App\Tests\Watch\DummyWatchTest</code></tt>, он предполагает, что пространство имён
тестируемого класса - <tt class="docutils literal"><code>App\Watch</code></tt>.</p>
<p>Если это соглашение не работает для вашего приложение, сконфигурируйте имитацию
пространств имён в файле <tt class="docutils literal"><code>phpunit.xml</code></tt>, как это делается, например, в
<a class="reference internal" href="http_kernel.html"><em>HttpKernel Component</em></a>:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- http://phpunit.de/manual/4.1/en/appendixes.configuration.html --&gt;</span>
<span class="nt">&lt;phpunit</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">&quot;http://schema.phpunit.de/4.1/phpunit.xsd&quot;</span>
<span class="nt">&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;listeners&gt;</span>
        <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">&quot;Symfony\Bridge\PhpUnit\SymfonyTestsListener&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;arguments&gt;</span>
                <span class="nt">&lt;array&gt;</span>
                    <span class="nt">&lt;element</span> <span class="na">key=</span><span class="s">&quot;time-sensitive&quot;</span><span class="nt">&gt;&lt;string&gt;</span>Symfony\Component\HttpFoundation<span class="nt">&lt;/string&gt;&lt;/element&gt;</span>
                <span class="nt">&lt;/array&gt;</span>
            <span class="nt">&lt;/arguments&gt;</span>
        <span class="nt">&lt;/listener&gt;</span>
    <span class="nt">&lt;/listeners&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="phpunit">
<h2>Изменённый скрипт PHPUnit<a class="headerlink" href="#phpunit" title="Permalink to this headline">¶</a></h2>
<p>Этот мост предоставляет изменённую версию PHPUnit, которую вы можете вызвать,
используя его команду <tt class="docutils literal"><code>bin/simple-phpunit</code></tt>. Она имеет следующие функции:</p>
<ul class="simple">
<li>Не встраивает <tt class="docutils literal"><code>symfony/yaml</code></tt> или <tt class="docutils literal"><code>prophecy</code></tt>, чтобы избежать конфликтов с
этими зависимостями;</li>
<li>Использует PHPUnit 4.8 при запуске с PHP &lt;=5.5,и PHPUnit 5.3 при запуске с PHP &gt;=5.6;</li>
<li>Собирает и повторяет пропущенные тесты, когда определена переменная окружения
<tt class="docutils literal"><code>SYMFONY_PHPUNIT_SKIPPED_TESTS</code></tt>: она должна указывать имя файла, который будет
использован для хранения пропущенных тестов при первом запуске, и повторять их
при повторном запуске;</li>
<li>Параллелит выполнение пакета тестов, когда каталог задан в качестве аргумента,
сканируя этот каталог на предмет файлов <tt class="docutils literal"><code>phpunit.xml.dist</code></tt> до уровня
<tt class="docutils literal"><code>SYMFONY_PHPUNIT_MAX_DEPTH</code></tt> (указан как переменная окружения, по умолчанию - <tt class="docutils literal"><code>3</code></tt>);</li>
</ul>
<p>Скрипт пишет изменённый PHPUnit, который он строит, в каталоге, который можно
сконфигурировать с помощью <tt class="docutils literal"><code>SYMFONY_PHPUNIT_DIR</code></tt>, или в том же каталоге, что и
<tt class="docutils literal"><code>simple-phpunit</code></tt>, если он не предоставлен.</p>
<p>Также можно установить эту переменную окружения в файле <tt class="docutils literal"><code>phpunit.xml.dist</code></tt>.</p>
<p>Если вы установили мост через Composer, то вы можете запустить его, вызвав, к примеру:</p>
<div class="literal-block"><div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span>$ vendor/bin/simple-phpunit
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p>Установите переменную окружения <tt class="docutils literal"><code>SYMFONY_PHPUNIT_VERSION</code></tt> например, <tt class="docutils literal"><code>5.5</code></tt>,
чтобы изменить базовую версию PHPUnit на <tt class="docutils literal"><code>5.5</code></tt> вместо значения по умолчанию
<tt class="docutils literal"><code>5.3</code></tt>.</p>
<p class="last">Также можно установить эту переменную окружения в файле <tt class="docutils literal"><code>phpunit.xml.dist</code></tt>.</p>
</div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p>Если вам всё ещё надо использовать <tt class="docutils literal"><code>prophecy</code></tt> (но не <tt class="docutils literal"><code>symfony/yaml</code></tt>),
то установите переменную окружения <tt class="docutils literal"><code>SYMFONY_PHPUNIT_REMOVE</code></tt>, как
<tt class="docutils literal"><code>symfony/yaml</code></tt>.</p>
<p class="last">Также можно установить эту переменную окружения в файле <tt class="docutils literal"><code>phpunit.xml.dist</code></tt>.</p>
</div></div>
</div>
<div class="section" id="id15">
<h2>Слушатель покрытия кода<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>По умолчанию, покрытие кода рассчитывается с использованием следующего правила:
если строчка кода выполняется, то она отмечается, как охваченная. А тест, который
выполняет строчку кода, следовательно, отмечается, как &quot;покрывающий строчку кода&quot;.
Это может вводить в заблуждение.</p>
<p>Рассмотрите следующий пример:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bar</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">barMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Foo</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$bar</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Bar</span> <span class="nv">$bar</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">=</span> <span class="nv">$bar</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">fooMethod</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span><span class="o">-&gt;</span><span class="na">barMethod</span><span class="p">();</span>

        <span class="k">return</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">FooTest</span> <span class="k">extends</span> <span class="nx">PHPUnit\Framework\TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">test</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$bar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">();</span>
        <span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">(</span><span class="nv">$bar</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">fooMethod</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Метод <tt class="docutils literal"><code>FooTest::test</code></tt> выполняет каждую строчку кода классов <tt class="docutils literal"><code>Foo</code></tt> и
<tt class="docutils literal"><code>Bar</code></tt>, но <tt class="docutils literal"><code>Bar</code></tt> на самом деле не тестируется. <tt class="docutils literal"><code>CoverageListener</code></tt> направлен
на исправление этого поведения, путём добавления соответствующей аннотации
<a class="reference external" href="https://phpunit.de/manual/current/en/appendixes.annotations.html#appendixes.annotations.covers">&#64;covers</a> в каждом тесте класса.</p>
<p>Если класс теста уже определяет аннотацию <tt class="docutils literal"><code>&#64;covers</code></tt>, то этот слушатель ничего
не делает. В обратном случае, он пытается найти код, связанный с тестом, удалив
часть имени класса <tt class="docutils literal"><code>Test</code></tt>: <tt class="docutils literal"><code>My\Namespace\Tests\FooTest</code></tt> -&gt; <tt class="docutils literal"><code>My\Namespace\Foo</code></tt>.</p>
<div class="section" id="id16">
<h3>Установка<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>Добавьте следующую конфигурацию к файлу <tt class="docutils literal"><code>phpunit.xml.dist</code></tt></p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- http://phpunit.de/manual/6.0/en/appendixes.configuration.html --&gt;</span>
<span class="nt">&lt;phpunit</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">&quot;http://schema.phpunit.de/6.0/phpunit.xsd&quot;</span>
<span class="nt">&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>

    <span class="nt">&lt;listeners&gt;</span>
        <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">&quot;Symfony\Bridge\PhpUnit\CoverageListener&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/listeners&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>Если логика, используемая для поиска соответствующего кода, слишком простая
или не рабтает для вашего приложения, вы можете использовать собственный
разрешитель SUT (Испытываемой системы):</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;listeners&gt;</span>
    <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">&quot;Symfony\Bridge\PhpUnit\CoverageListener&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;string&gt;</span>My\Namespace\SutSolver::solve<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>
<span class="nt">&lt;/listeners&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p><tt class="docutils literal"><code>My\Namespace\SutSolver::solve</code></tt> может быть любым PHP вызываемым, которое получает
текущее имя класса теста и его первый аргумент.</p>
<p>Наконец, слушатель также может отобразить предупреждающие сообщения, если разрешитель
SUT не находит SUT:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">&lt;listeners&gt;</span>
    <span class="nt">&lt;listener</span> <span class="na">class=</span><span class="s">&quot;Symfony\Bridge\PhpUnit\CoverageListener&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;null/&gt;</span>
            <span class="nt">&lt;boolean&gt;</span>true<span class="nt">&lt;/boolean&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/listener&gt;</span>
<span class="nt">&lt;/listeners&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
</div>


            </div>

            
            <div class="navigation">
                <a href="options_resolver-ru.html">« Компонент OptionsResolver (Разрешитель опций)</a>
                <span class="separator">|</span>
                <a href="polyfill_apcu-ru.html">Полизаполнение Symfony / Компонент APCu »</a>
            </div>
            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  <script data-cfasync="false" src="..\..\..\cdn-cgi\scripts\5c5dd728\cloudflare-static\email-decode.min.js"></script></body>
</body></html>