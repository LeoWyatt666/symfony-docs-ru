<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Использование событий &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="../../_static/" type="text/css">
    <link rel="stylesheet" href="..\..\_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="..\..\index.html">
    <link rel="up" title="The Console Component" href="..\console.html">
    <link rel="next" title="Использование логгера" href="logger.html">
    <link rel="prev" title="Using Events" href="events.html">

<link rel="stylesheet" href="..\..\_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="..\..\_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="..\..\_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="components doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\..\..\index.html">
                    <img src="..\..\..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="..\..\index.html">Главная</a>
        </li>
    
        <li>
            <a href="..\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="..\..\best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="..\..\quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="..\..\reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="..\..\genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="..\..\contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Использование событий</a><ul>
<li><a class="reference internal" href="#consoleevents-command">Событие <tt class="docutils literal"><code>ConsoleEvents::COMMAND</code></tt></a><ul>
<li><a class="reference internal" href="#id2">Отключение команд внутри слушателей</a></li>
</ul>
</li>
<li><a class="reference internal" href="#consoleevents-error">Событие <tt class="docutils literal"><code>ConsoleEvents::ERROR</code></tt></a></li>
<li><a class="reference internal" href="#consoleevents-terminate">Событие <tt class="docutils literal"><code>ConsoleEvents::TERMINATE</code></tt></a></li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="..\..\index.html">Документация</a></li>
                
                <li><a href="..\index.html">The Components</a></li>
                
                <li><a href="..\console.html">The Console Component</a></li>
                
                <li class="active">Использование событий</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Использование событий<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Класс Application компонента Console позволяет вам по желанию подключаться
к жизненному циклу консольного приложения через события. Вместо того, чтобы
изобретать велосипед, он использует компонент Symfony EventDispatcher, чтобы
сделать работу:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Console\Application</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\EventDispatcher\EventDispatcher</span><span class="p">;</span>

<span class="nv">$dispatcher</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventDispatcher</span><span class="p">();</span>

<span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
<span class="nv">$application</span><span class="o">-&gt;</span><span class="na">setDispatcher</span><span class="p">(</span><span class="nv">$dispatcher</span><span class="p">);</span>
<span class="nv">$application</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="caution"></div><div class="admonition admonition-caution"><p class="first admonition-title">Caution</p>
<p class="last">События консоли вызываются только путём выполнения основной команды.
Команды, вызванные основной командой, не запустят ни одно событие.</p>
</div></div>
<div class="section" id="consoleevents-command">
<h2>Событие <tt class="docutils literal"><code>ConsoleEvents::COMMAND</code></tt><a class="headerlink" href="#consoleevents-command" title="Permalink to this headline">¶</a></h2>
<p><strong>Типичное назначение</strong>: Сделать что-либо до запуска любой команды (вроде
логирования, какая команда будет выполнена), или отобразить что-то о том
событии, которое будет выполнено.</p>
<p>Событие <tt class="docutils literal"><code>ConsoleEvents::COMMAND</code></tt> запускается прямо перед вызовом любой
команды. Слушатели получают событие
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Console/Event/ConsoleCommandEvent.html" title="Symfony\Component\Console\Event\ConsoleCommandEvent">ConsoleCommandEvent</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Console\Event\ConsoleCommandEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\ConsoleEvents</span><span class="p">;</span>

<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">addListener</span><span class="p">(</span><span class="nx">ConsoleEvents</span><span class="o">::</span><span class="na">COMMAND</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">ConsoleCommandEvent</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// получает экземпляр ввода</span>
    <span class="nv">$input</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getInput</span><span class="p">();</span>

    <span class="c1">// получает экземпляр вывода</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getOutput</span><span class="p">();</span>

    <span class="c1">// получает команду, которая будет выполнена</span>
    <span class="nv">$command</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getCommand</span><span class="p">();</span>

    <span class="c1">// пишет что-то о команде</span>
    <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Before running command &lt;info&gt;%s&lt;/info&gt;&#39;</span><span class="p">,</span> <span class="nv">$command</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()));</span>

    <span class="c1">// получает приложение</span>
    <span class="nv">$application</span> <span class="o">=</span> <span class="nv">$command</span><span class="o">-&gt;</span><span class="na">getApplication</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div></div>
<div class="section" id="id2">
<h3>Отключение команд внутри слушателей<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Используя метод
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Console/Event/ConsoleCommandEvent.html#method_disableCommand" title="Symfony\Component\Console\Event\ConsoleCommandEvent::disableCommand()">disableCommand()</a></code></tt>,
вы можете отключать команды внутри слушателя. Тогда приложение <em>не</em> будет выполнять
команду, а вместо этого вернёт код <tt class="docutils literal"><code>113</code></tt> (определённый в
<tt class="docutils literal"><code>ConsoleCommandEvent::RETURN_CODE_DISABLED</code></tt>). Этот код является одним из
<a class="reference external" href="http://www.tldp.org/LDP/abs/html/exitcodes.html">зарезервированных кодов завершения</a> для команд консоль, которые подчиняются
стандарту C/C++.:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Console\Event\ConsoleCommandEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\ConsoleEvents</span><span class="p">;</span>

<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">addListener</span><span class="p">(</span><span class="nx">ConsoleEvents</span><span class="o">::</span><span class="na">COMMAND</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">ConsoleCommandEvent</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// получает команду, которая будет выполнена</span>
    <span class="nv">$command</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getCommand</span><span class="p">();</span>

    <span class="c1">// ... проверить, можно ли выполнить команду</span>

    <span class="c1">// отключает команду, что приведёт к пропуску команды</span>
    <span class="c1">// и возвращению кода 113 из приложения</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">disableCommand</span><span class="p">();</span>

    <span class="c1">// возможно включить команду в более позднем слушателе</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">commandShouldRun</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">enableCommand</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="consoleevents-error">
<h2>Событие <tt class="docutils literal"><code>ConsoleEvents::ERROR</code></tt><a class="headerlink" href="#consoleevents-error" title="Permalink to this headline">¶</a></h2>
<p><strong>Типичное назначение</strong>: Обрабатывать исключения, вызванные во время выполнения
команды.</p>
<p>Каждый раз, когда команда вызывает исключение, включая те, что запускаются
из слушателей событий, выполняется событие``ConsoleEvents::ERROR``. Слушатель
может обернуть или изменить исключение или сделать что-либо полезное перед тем,
как приложение вызовет исключение.</p>
<p>Слушатели получают событие
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Console/Event/ConsoleErrorEvent.html" title="Symfony\Component\Console\Event\ConsoleErrorEvent">ConsoleErrorEvent</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Console\Event\ConsoleErrorEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\ConsoleEvents</span><span class="p">;</span>

<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">addListener</span><span class="p">(</span><span class="nx">ConsoleEvents</span><span class="o">::</span><span class="na">ERROR</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">ConsoleErrorEvent</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getOutput</span><span class="p">();</span>

    <span class="nv">$command</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getCommand</span><span class="p">();</span>

    <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;Oops, exception thrown while running command &lt;info&gt;%s&lt;/info&gt;&#39;</span><span class="p">,</span> <span class="nv">$command</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()));</span>

    <span class="c1">// получает текущий код завершения (код исключения или код завершения, установленный событием ConsoleEvents::TERMINATE)</span>
    <span class="nv">$exitCode</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getExitCode</span><span class="p">();</span>

    <span class="c1">// меняет исключение на другое</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setException</span><span class="p">(</span><span class="k">new</span> <span class="nx">\LogicException</span><span class="p">(</span><span class="s1">&#39;Caught exception&#39;</span><span class="p">,</span> <span class="nv">$exitCode</span><span class="p">,</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getError</span><span class="p">()));</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="consoleevents-terminate">
<h2>Событие <tt class="docutils literal"><code>ConsoleEvents::TERMINATE</code></tt><a class="headerlink" href="#consoleevents-terminate" title="Permalink to this headline">¶</a></h2>
<p><strong>Типичное назначение</strong>: Выполнит некоторые очищающие действия после выполнения
команды.</p>
<p>После выполнени команды, вызывается событие <tt class="docutils literal"><code>ConsoleEvents::TERMINATE</code></tt>. Оно может
быть использовано для выполнения любых действий, необходимых для всех команд, или
для уборки того, что вы начали в слушателе <tt class="docutils literal"><code>ConsoleEvents::COMMAND</code></tt> (вроде отправки
логов, закрытия соединения БД, отправки электронных писем, ...). Слушатель также
может изменить код завершения.</p>
<p>Слушатели получают событие
<tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Symfony/Component/Console/Event/ConsoleTerminateEvent.html" title="Symfony\Component\Console\Event\ConsoleTerminateEvent">ConsoleTerminateEvent</a></code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\Console\Event\ConsoleTerminateEvent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\ConsoleEvents</span><span class="p">;</span>

<span class="nv">$dispatcher</span><span class="o">-&gt;</span><span class="na">addListener</span><span class="p">(</span><span class="nx">ConsoleEvents</span><span class="o">::</span><span class="na">TERMINATE</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">ConsoleTerminateEvent</span> <span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// получает вывод</span>
    <span class="nv">$output</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getOutput</span><span class="p">();</span>

    <span class="c1">// получает выполненную команду</span>
    <span class="nv">$command</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getCommand</span><span class="p">();</span>

    <span class="c1">// отображает заданное содержание</span>
    <span class="nv">$output</span><span class="o">-&gt;</span><span class="na">writeln</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;After running command &lt;info&gt;%s&lt;/info&gt;&#39;</span><span class="p">,</span> <span class="nv">$command</span><span class="o">-&gt;</span><span class="na">getName</span><span class="p">()));</span>

    <span class="c1">// изменяет код завершения</span>
    <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setExitCode</span><span class="p">(</span><span class="mi">128</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Это событие также выполняется когда команда вызывает исключение. Тогда оно
выполняется прямо после события <tt class="docutils literal"><code>ConsoleEvents::ERROR</code></tt>. В этом случае,
полученный код завершения является кодом исключения.</p>
</div></div>
</div>
</div>


            </div>

            
            <div class="navigation">
                <a href="events.html">« Using Events</a>
                <span class="separator">|</span>
                <a href="logger.html">Использование логгера »</a>
            </div>
            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>