<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    <title>Тестирование &mdash; Symfony Framework Documentation  documentation</title>
    
    <link rel="stylesheet" href="_static/" type="text/css">
    <link rel="stylesheet" href="_static\pygments.css" type="text/css">
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <link rel="top" title="Symfony Framework Documentation  documentation" href="index.html">

<link rel="stylesheet" href="_assets\app.css?v=8d6d457a0820d7c245bddae16bfd4c75">
<script src="_assets\manifest.js?v=d41d8cd98f00b204e980"></script>
<script src="_assets\app.js?v=900984040c7cb4dca514"></script>
<style>
    .header__top .container {
        overflow: hidden;
        padding-top: 10px;
        padding-bottom: 10px;
    }
    .header__top .header__logo {
        float: left;
    }
    .header__top .header__support {
        float: right;
    }

    .highlight .k, .highlight .gh, .highlight .gp,
    .highlight .gu, .highlight .kc, .highlight .kd,
    .highlight .kn, .highlight .kr, .highlight .nc,
    .highlight .nd, .highlight .ni, .highlight .nl,
    .highlight .nn, .highlight .nt, .highlight .ow,
    .highlight .se { font-weight: normal; }

    .highlight .c, .highlight .cm, .highlight .c1,
    .highlight .sd, .highlight .si { font-style: normal; }

    .doc { background: none; }
    #demo-warning {
        border: 3px dashed #c00;
        padding: 10px;
        margin-bottom: 30px;
    }
    #demo-warning h4 { font-size: 1.7em;font-weight: bold; }
    #demo-warning p { margin-bottom: 0; }
</style>

<!-- Global Site Tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-107764519-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-107764519-1');
</script>

<!-- Facebook Pixel Code -->
<script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '250281335689441');
    fbq('track', 'PageView');
</script>
<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=250281335689441&ev=PageView&noscript=1">
<!-- End Facebook Pixel Code -->

<script type="text/javascript">!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://vk.com/js/api/openapi.js?159",t.onload=function(){VK.Retargeting.Init("VK-RTRG-279161-8p6Jv"),VK.Retargeting.Hit()},document.head.appendChild(t)}();</script><img src="https://vk.com/rtrg?p=VK-RTRG-279161-8p6Jv" style="position:fixed; left:-999px;" alt="">


  </head>
  <body role="document">

<body class="testing-r doc_article doc">

<header>
    <section class="header__top">
        <div class="container">
            <div class="header__logo">
                <a href="..\..\index.html">
                    <img src="..\..\_images\header-logo.svg" alt="Symfony.com.ua logo">
                </a>
            </div>
            <div class="header__support hidden-xs">
                <a href="http://playtini.ua/" title="Компания Playtini">
                    <img height="69" src="..\..\_images\support.png" alt="Symfony is a SensioLabs product">
                </a>
            </div>
        </div>
    </section>
</header>

<div class="container"><div id="page-content">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
            <div id="sidebar-content"><div class="submenu">
    
    
    <ul class="list_submenu list-unstyled">
    
        <li class="first">
            <a href="index.html">Главная</a>
        </li>
    
        <li>
            <a href="components\index.html">Компоненты</a>
        </li>
    
        <li>
            <a href="best_practices\index.html">Лучшие практики</a>
        </li>
    
        <li>
            <a href="quick_tour\index.html">Быстрый старт</a>
        </li>
    
        <li>
            <a href="reference\index.html">Справочник</a>
        </li>
    
        <li>
            <a href="genindex.html">Индекс</a>
        </li>
    
        <li>
            <a href="contributing\index.html">Участие</a>
        </li>
    
    </ul>
</div>

                <div class="toc"> 
    <h4>Содержание</h4>
    <div class="toc-content">
        <ul>
<li><a class="reference internal" href="#">Тестирование</a><ul>
<li><a class="reference internal" href="#phpunit">Тестовый фреймворк PHPUnit</a></li>
<li><a class="reference internal" href="#index-1">Модульные тесты</a></li>
<li><a class="reference internal" href="#index-2">Функциональные тесты</a><ul>
<li><a class="reference internal" href="#your-first-functional-test">Your First Functional Test</a></li>
</ul>
</li>
<li><a class="reference internal" href="#index-4">Работа с тестовым клиентом</a><ul>
<li><a class="reference internal" href="#id7">Браузинг</a></li>
<li><a class="reference internal" href="#id8">Получение доступа к внутренним объектам</a></li>
<li><a class="reference internal" href="#id9">Получение доступа к контейнеру</a></li>
<li><a class="reference internal" href="#id10">Получение доступа к данным профайлера</a></li>
<li><a class="reference internal" href="#id11">Перенаправление</a></li>
</ul>
</li>
<li><a class="reference internal" href="#crawler">Crawler</a><ul>
<li><a class="reference internal" href="#id12">Перемещения</a></li>
<li><a class="reference internal" href="#id13">Извлечение информации</a></li>
<li><a class="reference internal" href="#id14">Ссылки</a></li>
<li><a class="reference internal" href="#id15">Формы</a><ul>
<li><a class="reference internal" href="#id16">Добавление и удаление форм из Коллекции</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#index-6">Тестовая конфигурация</a><ul>
<li><a class="reference internal" href="#index-7">Конфигурация PHPUnit</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id19">Узнать больше</a></li>
</ul>
</li>
</ul>

    </div>
</div>
                
            </div>

            <div class="ads m-b-30">
                <h2>Вакансии Playtini</h2>
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/php-dev">
                            Middle+ PHP Developer/Symfony
                        </a>
                    </h3>
                    <div><b>Playtini</b> активно поддерживает и развивает свои продукты, и профессионализм команды. И на данный момент в поиске специалиста на позицию <b>«Middle+ PHP Developer/Symfony»,</b> который улучшит качество внутренних сервисов компании и увеличит их количество.</div>
                </div>
                <!--
                <div class="ad m-b-15">
                    <h3>
                        <a href="http://playtini.ua/careers/symfony-senior">
                            Senior PHP Developer/Symfony
                        </a>
                    </h3>
                    <div>We are looking for strong, experienced <b>Senior PHP Developer/Symfony.</b> We expect him/her to participate in improving and extending a system built using microservice architecture by means of modern technologies.</div>
                </div>
                -->
                <div class="ad">
                    <h3><a href="http://playtini.ua/careers">
                        Остальные вакансии компании
                        <img src="..\..\_images\logo-playtini.png" alt="Playtini">
                    </a></h3>
                </div>
            </div>
        </div>

        <div id="main" class="col-sm-9">
            <ol class="breadcrumb">
                
                <li><a href="index.html">Документация</a></li>
                
                <li class="active">Тестирование</li>
            </ol>

            <div class="page">
                
  <div class="section" id="index-0">
<span id="id1"></span><h1>Тестирование<a class="headerlink" href="#index-0" title="Permalink to this headline">¶</a></h1>
<p>Как только вы пишете новую строку кода, вы также потенциально добавляете
новые ошибки. Для того чтобы создавать более надёжные приложения, вы должны
тестировать их, используя как функциональные, так и модульные (unit) тесты.</p>
<div class="section" id="phpunit">
<h2>Тестовый фреймворк PHPUnit<a class="headerlink" href="#phpunit" title="Permalink to this headline">¶</a></h2>
<p>В Symfony интегрирована независимая библиотека (называемая PHPUnit), которая
предоставляет вам отличный тестовый фреймворк. Эта глава не покрывает все
нюансы PHPUnit, но у него есть своя подробная <a class="reference external" href="https://phpunit.de/manual/current/en/">документация</a>.</p>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Рекомендуется использовать самую последнюю устойчивую версию PHPUnit,
<a class="reference external" href="https://phpunit.de/manual/current/en/installation.html#installation.phar">установленную как PHAR</a>.</p>
</div></div>
<p>Каждый тест, вне зависимости от того, функциональный он или модульный, –
это PHP класс, который должен быть расположен в каталоге <tt class="docutils literal"><code>tests/</code></tt> вашего
приложения. Если вы будете следовать этому правилу, то вы сможете запускать
все тестирования вашего приложения при помощи следующей команды:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> phpunit
</pre></div>
</td></tr></table></div></div>
<p>PHPUnit создается файлом <tt class="docutils literal"><code>phpunit.xml.dist</code></tt>, в корне вашего приложения Symfony.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Зону действия кода можно создать с помощью опций  <tt class="docutils literal"><code>--coverage-*</code></tt>, смотрите
справочную информацию, которая отображается при использовании <tt class="docutils literal"><code>--help</code></tt>.</p>
</div></div>
</div>
<div class="section" id="index-1">
<span id="id2"></span><h2>Модульные тесты<a class="headerlink" href="#index-1" title="Permalink to this headline">¶</a></h2>
<p>Модульный тест – это, как правило, тест одного отдельного PHP класса, также
называемого <em>модулем</em>. Если вы хотите тестировать поведение вашего приложения
целиком, обратитесь к секции <a class="reference internal" href="#id5">Функциональные тесты</a>.</p>
<p>Написание модульных тестов в Symfony не отличается от написания стандартных
модульных тестов PHPUnit. Например, предположим, у вас есть <em>очень</em> простой
класс <tt class="docutils literal"><code>Calculator</code></tt> в каталоге <tt class="docutils literal"><code>Util/</code></tt> пакета приложения:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// src/AppBundle/Util/Calculator.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Util</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Calculator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">add</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<p>Для того, чтобы его протестировать, создайте файл  <tt class="docutils literal"><code>CalculatorTest</code></tt> в каталоге
<a href="#id3"><span class="problematic" id="id4">``</span></a>tests/AppBundle/Util` вашего приложения:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// tests/AppBundle/Util/CalculatorTest.php</span>
<span class="k">namespace</span> <span class="nx">Tests\AppBundle\Util</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">AppBundle\Util\Calculator</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CalculatorTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$calc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Calculator</span><span class="p">();</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$calc</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>

        <span class="c1">// убедитесь, что ваш калькулятор добавил цифры правильно!</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">По соглашению, каталог <tt class="docutils literal"><code>tests/AppBundle</code></tt> должен повторять структуру каталогов
вашего пакета для модульных тестов. Таким образом, если вы тестируете класс в
каталоге <tt class="docutils literal"><code>src/AppBundle/Util/</code></tt>, поместите тест в каталог
<tt class="docutils literal"><code>tests/AppBundle/Util/</code></tt>.</p>
</div></div>
<p>Так же, как и в вашем настоящем приложении, автозагрузка включается автоматически
при помощи файла <tt class="docutils literal"><code>app/autoload.php``(это настроено по умолчанию в файле
``phpunit.xml.dist</code></tt>).</p>
<p>Выполнить тесты для заданного файла или папки также очень просто:</p>
<div class="literal-block"><div class="highlight-terminal"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># запустить все тесты в приложении</span>
<span class="gp">$</span> phpunit

<span class="c1"># запустить все тесты в каталоге Util</span>
<span class="gp">$</span> phpunit tests/AppBundle/Util

<span class="c1"># запустить тесты в классе Calculator</span>
<span class="gp">$</span> phpunit tests/AppBundle/Util/CalculatorTest.php

<span class="c1"># запустить все тесты для всего пакета</span>
<span class="gp">$</span> phpunit tests/AppBundle/
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="index-2">
<span id="id5"></span><h2>Функциональные тесты<a class="headerlink" href="#index-2" title="Permalink to this headline">¶</a></h2>
<p>Functional tests check the integration of the different layers of an
application (from the routing to the views). They are no different from unit
tests as far as PHPUnit is concerned, but they have a very specific workflow:</p>
<ul class="simple">
<li>Make a request;</li>
<li>Test the response;</li>
<li>Click on a link or submit a form;</li>
<li>Test the response;</li>
<li>Rinse and repeat.</li>
</ul>
<div class="section" id="your-first-functional-test">
<h3>Your First Functional Test<a class="headerlink" href="#your-first-functional-test" title="Permalink to this headline">¶</a></h3>
<p>Функциональные тесты - это простые PHP-файлы, которые обычно находятся в каталоге
<tt class="docutils literal"><code>tests/AppBundle/Controller</code></tt> вашего пакета. Если вы хотите протестировать страницы,
которые управляются вашим классом <tt class="docutils literal"><code>PostController</code></tt>, начните с создания нового файла
<tt class="docutils literal"><code>PostControllerTest.php</code></tt>, который расширяет специальный класс <tt class="docutils literal"><code>WebTestCase</code></tt>.</p>
<p>В качестве примера, тест может выглядеть так:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// tests/AppBundle/Controller/PostControllerTest.php</span>
<span class="k">namespace</span> <span class="nx">Tests\AppBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Test\WebTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PostControllerTest</span> <span class="k">extends</span> <span class="nx">WebTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testShowPost</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">();</span>

        <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/post/hello-world&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertGreaterThan</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;html:contains(&quot;Hello World&quot;)&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p>Для запуска ваших функциональных тестов, класс <tt class="docutils literal"><code>WebTestCase</code></tt> загружает
ядро вашего приложения. В большинстве случаев, это происходит автоматически.
Тем не менее, если ваше ядро находится в нестандартном каталоге, вам
нужно модифицировать файл <tt class="docutils literal"><code>phpunit.xml.dist</code></tt> и установить переменную
среды <tt class="docutils literal"><code>KERNEL_DIR</code></tt> на каталог вашего ядра:</p>
<div class="literal-block"><div class="last highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; charset=&quot;utf-8&quot; ?&gt;</span>
<span class="nt">&lt;phpunit&gt;</span>
    <span class="nt">&lt;php&gt;</span>
        <span class="nt">&lt;server</span> <span class="na">name=</span><span class="s">&quot;KERNEL_DIR&quot;</span> <span class="na">value=</span><span class="s">&quot;/path/to/your/app/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/php&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
<p>Метод <tt class="docutils literal"><code>createClient()</code></tt> возвращает клиент, который напоминает браузер,
который вы используете для просмотра вашего сайта:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/post/hello-world&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Метод <tt class="docutils literal"><code>request()</code></tt> (смотрите <a class="reference internal" href="testing.html#testing-request-method-sidebar"><span>больше о методе request</span></a>)
возвращает объект <tt class="docutils literal"><code><a class="reference external" href="http://api.symfony.com/master/Crawler Symfony/Component/DomCrawler/Crawler.html" title="Crawler Symfony\Component\DomCrawler\Crawler">Crawler</a></code></tt>, который может быть
использован для выбора элементов в ответе, кликов по ссылкам и отправки форм.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last"><tt class="docutils literal"><code>Crawler</code></tt> (поисковый агент, «гусеница») может использоваться только в том
случае, если ответ – это XML или HTML документ. Для других типов нужно
получать содержимое вызвав <tt class="docutils literal"><code>$client-&gt;getResponse()-&gt;getContent()</code></tt>.</p>
</div></div>
<p>Кликните по ссылке, выбрав её при помощи Crawler используя выражение XPath или
CSS селектор, затем используйте клиент для клика. Например:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span>
    <span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;a:contains(&quot;Greet&quot;)&#39;</span><span class="p">)</span> <span class="c1">// find all links with the text &quot;Greet&quot;</span>
    <span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// select the second link in the list</span>
    <span class="o">-&gt;</span><span class="na">link</span><span class="p">()</span>
<span class="p">;</span>

<span class="c1">// и кликните по ней</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Отправка формы происходит очень схожим образом: выберите кнопку на форме,
по желанию переопределите какие-нибудь значения формы, и отправьте
соответствующую форму:
Submitting a form is very similar: sele:</p>
<blockquote>
<div><p>$form = $crawler-&gt;selectButton('submit')-&gt;form();</p>
<p>// установить некоторые значения
$form['name'] = 'Lucas';
$form['form_name[subject]'] = 'Hey there!';</p>
<p>// предоставить форму
$crawler = $client-&gt;submit($form);</p>
</div></blockquote>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Форма также может поддерживать загрузку файлов и содержит методы для заполнения
различных типов полей (например, <tt class="docutils literal"><code>select()</code></tt> и <tt class="docutils literal"><code>tick()</code></tt>). Подробнее читайте
в секции  <a class="reference internal" href="#id15">Формы</a> ниже.</p>
</div></div>
<p>Теперь, когда вы с лёгкостью можете перемещаться по приложению, воспользуйтесь
утверждениями, чтобы проверить ожидаемые действия. Воспользуйтесь Crawler чтобы
сделать утверждения для DOM:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Утверждает, что ответ соотвествует заданному CSS селектору.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertGreaterThan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
<p>Или протестируйте содержимое ответа напрямую, если хотите убедиться что его
содержимое включает какой-либо текст, или что он не является документом XML/HTML:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span>
    <span class="s1">&#39;Hello World&#39;</span><span class="p">,</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper" id="index-3">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title">Полезные утверждения</p>
<p>Для быстрого старта, обратите внимание на список наиболее
распространенных и полезных утверждений:</p>
<div class="literal-block"><div class="last highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="c1">// ...</span>

<span class="c1">// Утверждает, что имеется единственный тег h2</span>
<span class="c1">// с классом &quot;subtitle&quot;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertGreaterThan</span><span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h2.subtitle&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span>
<span class="p">);</span>

<span class="c1">// Утверждает, что на странице имеется только 4 тега h2</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCount</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h2&#39;</span><span class="p">));</span>

<span class="c1">// Утверждает, что заголовок &quot;Content-Type&quot; - &quot;application/json&quot;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">contains</span><span class="p">(</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span>
        <span class="s1">&#39;application/json&#39;</span>
    <span class="p">),</span>
    <span class="s1">&#39;the &quot;Content-Type&quot; header is &quot;application/json&quot;&#39;</span> <span class="c1">// optional message shown on failure</span>
<span class="p">);</span>

<span class="c1">// Увтерждает, что соержимое ответа содержит строку</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">());</span>
<span class="c1">// ...или совпадает с регулярным выражением</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRegExp</span><span class="p">(</span><span class="s1">&#39;/foo(bar)?/&#39;</span><span class="p">,</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">());</span>

<span class="c1">// Утверждает, что статус-код ответа является 2xx</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isSuccessful</span><span class="p">(),</span> <span class="s1">&#39;response status is 2xx&#39;</span><span class="p">);</span>
<span class="c1">// Увтерждает, что статус-код ответа является 404</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isNotFound</span><span class="p">());</span>
<span class="c1">// Утверждает что статус-код ответа точно 200</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
    <span class="mi">200</span><span class="p">,</span> <span class="c1">// or Symfony\Component\HttpFoundation\Response::HTTP_OK</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span>
<span class="p">);</span>

<span class="c1">// Утверждает что ответ - это перенаправление на /demo/contact</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span>
    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isRedirect</span><span class="p">(</span><span class="s1">&#39;/demo/contact&#39;</span><span class="p">)</span>
    <span class="c1">// if the redirection URL was generated as an absolute URL</span>
    <span class="c1">// $client-&gt;getResponse()-&gt;isRedirect(&#39;http://localhost/demo/contact&#39;)</span>
<span class="p">);</span>
<span class="c1">// ...или просто проверяет, что ответ - это перенаправление на любой URLL</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isRedirect</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
</div>
</div>
<div class="section" id="index-4">
<span id="id6"></span><h2>Работа с тестовым клиентом<a class="headerlink" href="#index-4" title="Permalink to this headline">¶</a></h2>
<p>Тестовый клиент симулирует HTTP клиент (типа браузера) и выполняет запросы
к вашему Symfony приложению:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/post/hello-world&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Метод <tt class="docutils literal"><code>request()</code></tt> принимает HTTP метод и URL в качестве аргументов, и
возвращает экземпляр <tt class="docutils literal"><code>Crawler</code></tt>.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Жестко запрограмированные URL – это лучшее решение для функциональных тестов.
Если тест генерирует URLы используя маршрутизатор Symfony, он не обнаружит
никаких изменений, сделанных в URLах приложения, что может повлиять на
конечного пользователя.</p>
</div></div>
<div class="admonition-wrapper" id="testing-request-method-sidebar-ru">
<div class="sidebar"></div><div class="admonition admonition-sidebar"><p class="first sidebar-title">Больше о методе <tt class="docutils literal"><code>request()</code></tt>:</p>
<p>Полная сигнатура метода <tt class="docutils literal"><code>request()</code></tt> выглядит так:</p>
<div class="literal-block"><div class="last highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="nx">request</span><span class="p">(</span>
        <span class="nv">$method</span><span class="p">,</span>
        <span class="nv">$uri</span><span class="p">,</span>
        <span class="k">array</span> <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
        <span class="k">array</span> <span class="nv">$files</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
        <span class="k">array</span> <span class="nv">$server</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span>
        <span class="nv">$content</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="nv">$changeHistory</span> <span class="o">=</span> <span class="k">true</span>
    <span class="p">)</span>

<span class="nx">Массив</span> <span class="sb">``</span><span class="nx">server</span><span class="sb">``</span> <span class="nx">–</span> <span class="nx">это</span> <span class="nx">сырые</span> <span class="nx">значения</span><span class="p">,</span> <span class="nx">которые</span> <span class="nx">вы</span> <span class="nx">обычно</span> <span class="nx">можете</span> <span class="nx">найти</span> <span class="nx">в</span>
<span class="nx">суперглобальном</span> <span class="nx">PHP</span> <span class="sb">`$_SERVER`</span><span class="nx">_</span><span class="o">.</span> <span class="nx">Например</span><span class="p">,</span> <span class="nx">чтобы</span> <span class="nx">установить</span> <span class="nx">HTTP</span> <span class="nx">заголовки</span>
 <span class="sb">``</span><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="sb">``</span><span class="p">,</span>  <span class="sb">``</span><span class="nx">Referer</span><span class="sb">``</span> <span class="nx">и</span> <span class="sb">``</span><span class="nx">X</span><span class="o">-</span><span class="nx">Requested</span><span class="o">-</span><span class="nx">With</span><span class="sb">``</span><span class="p">,</span> <span class="nx">вам</span> <span class="nx">нужно</span> <span class="nx">будет</span>
 <span class="nx">сделать</span> <span class="nx">следующее</span> <span class="p">(</span><span class="nx">не</span> <span class="nx">забывайте</span> <span class="nx">об</span> <span class="sb">``</span><span class="nx">HTTP_</span><span class="sb">``</span> <span class="nx">приставке</span> <span class="nx">для</span> <span class="nx">нестандартных</span>
 <span class="nx">заголовков</span><span class="p">)</span><span class="o">::</span>

    <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
        <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/post/hello-world&#39;</span><span class="p">,</span>
        <span class="k">array</span><span class="p">(),</span>
        <span class="k">array</span><span class="p">(),</span>
        <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;CONTENT_TYPE&#39;</span>          <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HTTP_REFERER&#39;</span>          <span class="o">=&gt;</span> <span class="s1">&#39;/foo/bar&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HTTP_X-Requested-With&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;XMLHttpRequest&#39;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div></div>
<p>Используйте Crawler для нахождения DOM-элементов в теле ответа. После, эти
элементы могут быть использованы для кликов по ссылкам и отправки форм:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Go elsewhere...&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

<span class="nv">$form</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectButton</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>Оба метода <tt class="docutils literal"><code>click()</code></tt> и <tt class="docutils literal"><code>submit()</code></tt> возвращают объект <tt class="docutils literal"><code>Crawler</code></tt>. Эти
методы - лучший способ просматривать ваше приложение, так как они заботятся
о многих вещах, например, об определении HTTP метода формы, и предоставлении
вам удобного API для загрузки файлов.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Больше узнать об объектах <tt class="docutils literal"><code>Link</code></tt> и <tt class="docutils literal"><code>Form</code></tt> можно в разделе
<a class="reference internal" href="testing.html#testing-crawler"><span>Crawler</span></a> ниже.</p>
</div></div>
<p>Метод <tt class="docutils literal"><code>request()</code></tt> может также быть использован для симуляции отправки форм или
для выполнения более сложных запросов. Вот некоторые полезные примеры:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Прямая отправка формы (можно и так, но легче использовать Crawler!)</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;/submit&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">));</span>

<span class="c1">// Отправка строки JSON в тело запроса</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/submit&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;CONTENT_TYPE&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">),</span>
    <span class="s1">&#39;{&quot;name&quot;:&quot;Fabien&quot;}&#39;</span>
<span class="p">);</span>

<span class="c1">// Отправка формы с загрузкой файла</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\File\UploadedFile</span><span class="p">;</span>

<span class="nv">$photo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UploadedFile</span><span class="p">(</span>
    <span class="s1">&#39;/path/to/photo.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span>
    <span class="mi">123</span>
<span class="p">);</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/submit&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span> <span class="o">=&gt;</span> <span class="nv">$photo</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// Выполнение DELETE запросов, и отправка HTTP заголовков</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span>
    <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;/post/12&#39;</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(),</span>
    <span class="k">array</span><span class="p">(</span><span class="s1">&#39;PHP_AUTH_USER&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;PHP_AUTH_PW&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pa$$word&#39;</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>И последнее, но не менее важное, можно заставить каждый запрос выполняться в
собственном PHP процессе, чтобы избежать любых побочных эффектов когда несколько
клиентов работают в одном скрипте:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">insulate</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<div class="section" id="id7">
<h3>Браузинг<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Клиент поддерживает многие операции, которые можно выполнить в настоящем
браузере:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">back</span><span class="p">();</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">forward</span><span class="p">();</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">reload</span><span class="p">();</span>

<span class="c1">// Очищает все куки и историю.</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">restart</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id8">
<h3>Получение доступа к внутренним объектам<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>Если вы используете клиент для тестирования своего приложения, вам может
понадобиться получить доступ к его внутренним объектам:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$history</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getHistory</span><span class="p">();</span>
<span class="nv">$cookieJar</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getCookieJar</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Вы также можете получить объекты, относящиеся к последнему запросу:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// экземпляр запроса HttpKernel</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getRequest</span><span class="p">();</span>

<span class="c1">// экземпляр запроса BrowserKit</span>
<span class="nv">$request</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getInternalRequest</span><span class="p">();</span>

<span class="c1">// экземпляр ответа the HttpKernel</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>

<span class="c1">// экземпляр ответа BrowserKit</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getInternalResponse</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getCrawler</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id9">
<h3>Получение доступа к контейнеру<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Настоятельно рекомендуется использовать функциональные тесты только для проверки
ответов. Но в некоторых крайне редких случаях, вам может понадобиться получить
доступ к некоторым внутренним объектам для написания утверждений. В таких случаях,
вы можете использовать контейнер внедрения зависимости:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// это будет тот же контейнер, что используется в вашем тесте, кроме случаев,</span>
<span class="c1">// когда вы используете $client-&gt;insulate() или настоящие HTTP-запросы для</span>
<span class="c1">// тестирования вашего приложения</span>
<span class="nv">$container</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Чтобы получить список сервисов, существующих в вашем приложении, используйте
команду <tt class="docutils literal"><code>debug:container</code></tt>.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Если необходимая для проверки информация доступна из профилировщика, тогда
используйте его.</p>
</div></div>
</div>
<div class="section" id="id10">
<h3>Получение доступа к данным профайлера<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Для каждого запроса, вы можете активировать профайлер Symfony для сбора данных
о внутренней обработке этого запроса. Например, профайлер может быть использован
для верификации того, что данная страница во время загрузки выполняет меньше SQL
запросов, чем заданное пороговое значение.</p>
<p>Для получения профайлера для последнего запроса выполните
следующий код:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// включить профайлер для следующего запроса</span>
<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">enableProfiler</span><span class="p">();</span>

<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/profiler&#39;</span><span class="p">);</span>

<span class="c1">// получить профиль</span>
<span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">getProfile</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Подробнее про использование профайлера в тестах читайте в статье
<a class="reference internal" href="testing\profiling.html"><em>Как использовать профайлер в функциональном тесте</em></a>.</p>
</div>
<div class="section" id="id11">
<h3>Перенаправление<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Когда запрос возвращает ответ с перенаправлением, клиент не следует ему
автоматически. Вы можете изучить ответ, и заставить клиент произвести
перенаправление с помощью метода <tt class="docutils literal"><code>followRedirect()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">followRedirect</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Если вы хотите, чтобы клиент автоматически следовал всем перенаправлениям, вы
можете заставить его делать это с помощью метода <tt class="docutils literal"><code>followRedirects()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">followRedirects</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>Если вы переадите в метод <tt class="docutils literal"><code>followRedirects()</code></tt> значение <tt class="docutils literal"><code>false</code></tt>, то
клиент больше не будет следовать перенаправлениям:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">followRedirects</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="crawler">
<span id="testing-crawler-ru"></span><span id="index-5"></span><h2>Crawler<a class="headerlink" href="#crawler" title="Permalink to this headline">¶</a></h2>
<p>Экземпляр Crawler возвращается каждый раз, когда выполняется запрос посредством
клиента. Он позволяет вам перемещаться по HTML документам, выбирать узлы, искать
ссылки и формы.</p>
<div class="section" id="id12">
<h3>Перемещения<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>Как и jQuery, Crawler имеет методы для перемещения по DOM документа HTML/XML.
Например, следующий код находит все элементы <tt class="docutils literal"><code>input[type=submit]</code></tt>, выбирает
последний на странице, и потом выбирает ближайший родительский элемент:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$newCrawler</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;input[type=submit]&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">last</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">parents</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>Также доступны многие другие методы:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><code>filter('h1.title')</code></tt></dt>
<dd>Узлы, соответствующие CSS селектору.</dd>
<dt><tt class="docutils literal"><code>filterXpath('h1')</code></tt></dt>
<dd>Узлы, соответствующие выражению XPath.</dd>
<dt><tt class="docutils literal"><code>eq(1)</code></tt></dt>
<dd>Узлы для определенного индекса.</dd>
<dt><tt class="docutils literal"><code>first()</code></tt></dt>
<dd>Первый узел.</dd>
<dt><tt class="docutils literal"><code>last()</code></tt></dt>
<dd>Последний узел.</dd>
<dt><tt class="docutils literal"><code>siblings()</code></tt></dt>
<dd>Элементы одного уровня (сестры).</dd>
<dt><tt class="docutils literal"><code>nextAll()</code></tt></dt>
<dd>Все последующие сестры.</dd>
<dt><tt class="docutils literal"><code>previousAll()</code></tt></dt>
<dd>Все предыдущие сестры.</dd>
<dt><tt class="docutils literal"><code>parents()</code></tt></dt>
<dd>Возвращает родительские узлы.</dd>
<dt><tt class="docutils literal"><code>children()</code></tt></dt>
<dd>RВозвращает узлы потомков.</dd>
<dt><tt class="docutils literal"><code>reduce($lambda)</code></tt></dt>
<dd>Узлы, для которых функция не возвращает false.</dd>
</dl>
<p>Так как каждый из этих методов возвращает новый экземпляр <tt class="docutils literal"><code>Crawler</code></tt>, вы
можете упростить ваш код путём выстраивания методов вызова в цепочку:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$crawler</span>
    <span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;h1&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">reduce</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">getAttribute</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span>
<span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Используйте функцию <tt class="docutils literal"><code>count()</code></tt>, чтобы получить количество узлов, хранящихся
в Crawler:  <tt class="docutils literal"><code>count($crawler)</code></tt></p>
</div></div>
</div>
<div class="section" id="id13">
<h3>Извлечение информации<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>Crawler может извлекать информацию из узлов:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Возвращает значение атрибута для первого узла</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">);</span>

<span class="c1">// Возвращает значение узла для первого узла</span>
<span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>

<span class="c1">// Извлекает массив аттрибутов для всех узлов</span>
<span class="c1">// (_text returns the node value)</span>
<span class="c1">// Возвращает массив для каждого элемента</span>
<span class="c1">// с его значением и ссылкой</span>
<span class="nv">$info</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;_text&#39;</span><span class="p">,</span> <span class="s1">&#39;href&#39;</span><span class="p">));</span>

<span class="c1">// Выполняет lambda для каждого узла и возвращает массив результатов</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id14">
<h3>Ссылки<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Для выбора ссылок вы можете использовать методы обхода, указанных выше, или
более удобное сокращение <tt class="docutils literal"><code>selectLink()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Click here&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Оно выбирает все ссылки, содержащие указанный текст, либо изображения, по
которым можно кликать, содержащие этот текст в атрибуте <tt class="docutils literal"><code>alt</code></tt>. Как и другие
методы фильтрации, он возращает еще один объект <tt class="docutils literal"><code>Crawler</code></tt>.</p>
<p>После того, как вы выбрали ссылку, у вас есть доступ к специальному объекту
Link, который содержит специальные полезные методы для ссылок (например,
<tt class="docutils literal"><code>getMethod()</code></tt> и <tt class="docutils literal"><code>getUri()</code></tt>). Чтобы кликнуть по ссылке, используйте метод
клиента <tt class="docutils literal"><code>click()</code></tt> и добавьте в него объект <tt class="docutils literal"><code>Link</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$link</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;Click here&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>

<span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
</div>
<div class="section" id="id15">
<h3>Формы<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>Формы можно выбирать используя их кнопки, которые можно выбрать с помощью
метода <tt class="docutils literal"><code>selectButton()</code></tt>, точно так же, как и ссылки:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$buttonCrawlerNode</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectButton</span><span class="p">(</span><span class="s1">&#39;submit&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="note"></div><div class="admonition admonition-note"><p class="first admonition-title">Note</p>
<p class="last">Заметьте, что вы выбираете кнопку на форме, а не саму форму, т. к. форма
может иметь несколько кнопок; если вы используюте API перемещений, то помните,
что вам надо искать кнопку.</p>
</div></div>
<p>Метод <tt class="docutils literal"><code>selectButton()</code></tt> может выбрать теги <tt class="docutils literal"><code>button</code></tt> и представлять теги
<tt class="docutils literal"><code>input</code></tt>. Он ипользует несколько частей кнопок для их нахождения:</p>
<ul class="simple">
<li>Значение атрибута <tt class="docutils literal"><code>value</code></tt>;</li>
<li>Значение атрибута <tt class="docutils literal"><code>id</code></tt> или <tt class="docutils literal"><code>аlt</code></tt> для изображений;</li>
<li>Значение атрибута <tt class="docutils literal"><code>id</code></tt> или <tt class="docutils literal"><code>name</code></tt> для тегов <tt class="docutils literal"><code>button</code></tt>.</li>
</ul>
<p>Как только у вас есть Crawler, представляющий кнопку, вызовите метод
<tt class="docutils literal"><code>form()</code></tt> для получения экзмепляра  <tt class="docutils literal"><code>Form</code></tt> для формы, описывающей
узел кнопки:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>
</pre></div>
</td></tr></table></div></div>
<p>При вызове метода <tt class="docutils literal"><code>form()</code></tt>, вы также можете передать массив значений для
полей, перезаписывающих начальные значения:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span>              <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">,</span>
    <span class="s1">&#39;my_form[subject]&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>А если вы хотите симулировать определённый HTTP метод для формы, передайте его
вторым аргументом:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$form</span> <span class="o">=</span> <span class="nv">$buttonCrawlerNode</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Клиент может отправлять эзкемпляры <tt class="docutils literal"><code>Form</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<p>Значения полей также могут быть переданы вторым аргументом метода <tt class="docutils literal"><code>submit()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">submit</span><span class="p">(</span><span class="nv">$form</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;name&#39;</span>              <span class="o">=&gt;</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">,</span>
    <span class="s1">&#39;my_form[subject]&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>В более сложных случаях, используйте экземпляр <tt class="docutils literal"><code>Form</code></tt> как массив, чтобы задать
значения каждого поля индивидуально:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Изменить значение поля</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Fabien&#39;</span><span class="p">;</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;my_form[subject]&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Symfony rocks!&#39;</span><span class="p">;</span>
</pre></div>
</td></tr></table></div></div>
<p>Также имеется красивый API для управления значениями полей в зависимости от их
типа:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Выбрать option или radio</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;France&#39;</span><span class="p">);</span>

<span class="c1">// Поставить галочку в checkbox</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;like_symfony&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">tick</span><span class="p">();</span>

<span class="c1">// Загрузить файл</span>
<span class="nv">$form</span><span class="p">[</span><span class="s1">&#39;photo&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">upload</span><span class="p">(</span><span class="s1">&#39;/path/to/lucas.jpg&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Если вы хотите намеренно выбрать «ошибочные» (invalid) значения select/radio,
смотрите <span class="xref std std-ref">Выбор ошибочных значений components-dom-crawler-invalid</span>.</p>
</div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Вы можете получить значения, которые будут отправлены, вызвав метод
<tt class="docutils literal"><code>getValues()</code></tt> объекта <tt class="docutils literal"><code>Form</code></tt>. Загружаемые файлы доступны в отдельном массиве,
возвращаемом через <tt class="docutils literal"><code>getFiles()</code></tt>. Методы <tt class="docutils literal"><code>getPhpValues()</code></tt> и
<tt class="docutils literal"><code>getPhpFiles()</code></tt>) тоже возвращают отправленные значения, но в формате PHP (он
преобразует ключи с квадратными скобками - например, <tt class="docutils literal"><code>my_form[subject]</code></tt> - в
PHP массивы).</p>
</div></div>
<div class="section" id="id16">
<h4>Добавление и удаление форм из Коллекции<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>Если вы используете <a class="reference internal" href="form\form_collections.html"><em>Коллекцию форм</em></a>, то вы не
можете добавить поля в существующую форму с помощью <tt class="docutils literal"><code>$form['task[tags][0][name]'] = 'foo';</code></tt>.
Это приведет к ошибке <tt class="docutils literal"><code>Unreachable field &quot;…&quot;</code></tt> (Недоступное поле «…»), так как <tt class="docutils literal"><code>$form</code></tt>
можно использовать только для того, чтобы устанавливать значения для существующих полей.
Для того, чтобы добавить новые поля, вам необходимо добавить значения к сырому массиву
данных:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Получить форму.</span>
<span class="nv">$form</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">form</span><span class="p">();</span>

<span class="c1">// Получить сырые значения.</span>
<span class="nv">$values</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getPhpValues</span><span class="p">();</span>

<span class="c1">// AДобавить поля к сырым значениям.</span>
<span class="nv">$values</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">][</span><span class="s1">&#39;tags&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nv">$values</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">][</span><span class="s1">&#39;tags&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>

<span class="c1">// Предоставить форму с существующими и новыми значениями.</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">(),</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getUri</span><span class="p">(),</span> <span class="nv">$values</span><span class="p">,</span>
    <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getPhpFiles</span><span class="p">());</span>

<span class="c1">// 2 тега были добавлены в коллекцию.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;ul.tags &gt; li&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
<p>Где <tt class="docutils literal"><code>task[tags][0][name]</code></tt>  – это имя поля, созданного JavaScript.</p>
<p>Вы можете удалить существующее поле, например тег:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// Получить значения формы.</span>
<span class="nv">$values</span> <span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getPhpValues</span><span class="p">();</span>

<span class="c1">// Удалить первый тег.</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$values</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">][</span><span class="s1">&#39;tags&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>

<span class="c1">// Предоставить данные.</span>
<span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getMethod</span><span class="p">(),</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getUri</span><span class="p">(),</span>
    <span class="nv">$values</span><span class="p">,</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">getPhpFiles</span><span class="p">());</span>

<span class="c1">//  Тег был удален.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;ul.tags &gt; li&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
</div>
<div class="section" id="index-6">
<span id="id17"></span><h2>Тестовая конфигурация<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h2>
<p>Клиент, используемый функциональными тестами, создает Kernel (ядро), которое
находится в специальном окружении <tt class="docutils literal"><code>test</code></tt>. Так как Symfony загружает
<tt class="docutils literal"><code>app/config/config_test.yml</code></tt> в окружении <tt class="docutils literal"><code>test</code></tt>, вы можете скорректировать
любые настройки вашего приложения специально для тестирования.</p>
<p>Например, по умолчанию, Swift Mailer сделан так, чтобы <em>не</em> доставлять имейлы
в окружение <tt class="docutils literal"><code>test</code></tt>. Вы можете увидеть это в опции конфигурации <tt class="docutils literal"><code>swiftmailer</code></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="literal-block"><div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># app/config/config_test.yml</span>

<span class="c1"># ...</span>
<span class="l l-Scalar l-Scalar-Plain">swiftmailer</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">disable_delivery</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>XML</em><div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- app/config/config_test.xml --&gt;</span>
<span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:swiftmailer=</span><span class="s">&quot;http://symfony.com/schema/dic/swiftmailer&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services</span>
<span class="s">        http://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">        http://symfony.com/schema/dic/swiftmailer</span>
<span class="s">        http://symfony.com/schema/dic/swiftmailer/swiftmailer-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;swiftmailer:config</span> <span class="na">disable-delivery=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</td></tr></table></div></div>
</li>
<li><em>PHP</em><div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">// app/config/config_test.php</span>

<span class="c1">// ...</span>
<span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">&#39;swiftmailer&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;disable_delivery&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
</li>
</ul>
</div>
<p>Вы также можете использовать полностью другое окружение, или переписать метод
отлаживания по умолчанию (<tt class="docutils literal"><code>true</code></tt>) путем передавания каждого в качестве опций
в методе <tt class="docutils literal"><code>createClient()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;environment&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my_test_env&#39;</span><span class="p">,</span>
    <span class="s1">&#39;debug&#39;</span>       <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>Если ваше приложение ведет себя в соответствии с некоторыми заголовками HTTP,
передайте их в качестве второго аргумента в <tt class="docutils literal"><code>createClient()</code></tt>:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">createClient</span><span class="p">(</span><span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;HTTP_HOST&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;en.example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HTTP_USER_AGENT&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MySuperBrowser/1.0&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<p>Вы также можете переписать заголовки HTTP на основании запросов:</p>
<div class="literal-block"><div class="highlight-php"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;HTTP_HOST&#39;</span>       <span class="o">=&gt;</span> <span class="s1">&#39;en.example.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HTTP_USER_AGENT&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;MySuperBrowser/1.0&#39;</span><span class="p">,</span>
<span class="p">));</span>
</pre></div>
</td></tr></table></div></div>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Тестовый клиент доступен в виде сервиса в контейнере окружения <tt class="docutils literal"><code>test</code></tt>
(или там, где подключена опция <a class="reference internal" href="reference\configuration\framework.html#reference-framework-test"><span>тестового фреймворка framework.test</span></a>).
Это значит, что вы можете переписать сервис полностью, если вам это необходимо.</p>
</div></div>
<div class="section" id="index-7">
<span id="id18"></span><h3>Конфигурация PHPUnit<a class="headerlink" href="#index-7" title="Permalink to this headline">¶</a></h3>
<p>Каждое приложение имеет свою собственную конфигурацию PHPUnit, которая хранится
в файле <tt class="docutils literal"><code>phpunit.xml.dist</code></tt>. Вы можете редактировать этот файл, чтобы менять
значения по умолчанию, или же вы можете создать файл <tt class="docutils literal"><code>phpunit.xml</code></tt> для установки
конфигурации только для вашей локальной машины.</p>
<div class="admonition-wrapper">
<div class="tip"></div><div class="admonition admonition-tip"><p class="first admonition-title">Tip</p>
<p class="last">Сохраните файл <tt class="docutils literal"><code>phpunit.xml.dist</code></tt> в вашем репозитории кода и игнорируйте
файл <tt class="docutils literal"><code>phpunit.xml</code></tt>.</p>
</div></div>
<p>По умолчанию, по команде <tt class="docutils literal"><code>phpunit</code></tt> запускаются только тесты, которые хранятся в <tt class="docutils literal"><code>/tests</code></tt>,
так задано в файле <tt class="docutils literal"><code>phpunit.xml.dist</code></tt>:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- phpunit.xml.dist --&gt;</span>
<span class="nt">&lt;phpunit&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;testsuites&gt;</span>
        <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Project Test Suite&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;directory&gt;</span>tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/testsuite&gt;</span>
    <span class="nt">&lt;/testsuites&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>Но вы можете с легкостье добавить больше каталогов. например, следующая
конфигурация, добавляет тесты из пользовательского каталога <tt class="docutils literal"><code>lib/tests</code></tt>:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- phpunit.xml.dist --&gt;</span>
<span class="nt">&lt;phpunit&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;testsuites&gt;</span>
        <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Project Test Suite&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- ... ---&gt;</span>
            <span class="nt">&lt;directory&gt;</span>lib/tests<span class="nt">&lt;/directory&gt;</span>
        <span class="nt">&lt;/testsuite&gt;</span>
    <span class="nt">&lt;/testsuites&gt;</span>
    <span class="c">&lt;!-- ... ---&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
<p>Чтобы добавить другие каталоги в охват кода, также внесите правки в часть
<tt class="docutils literal"><code>&lt;filter&gt;</code></tt>:</p>
<div class="literal-block"><div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c">&lt;!-- phpunit.xml.dist --&gt;</span>
<span class="nt">&lt;phpunit&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
    <span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;whitelist&gt;</span>
            <span class="c">&lt;!-- ... --&gt;</span>
            <span class="nt">&lt;directory&gt;</span>lib<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;exclude&gt;</span>
                <span class="c">&lt;!-- ... --&gt;</span>
                <span class="nt">&lt;directory&gt;</span>lib/tests<span class="nt">&lt;/directory&gt;</span>
            <span class="nt">&lt;/exclude&gt;</span>
        <span class="nt">&lt;/whitelist&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="c">&lt;!-- ... ---&gt;</span>
<span class="nt">&lt;/phpunit&gt;</span>
</pre></div>
</td></tr></table></div></div>
</div>
</div>
<div class="section" id="id19">
<h2>Узнать больше<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="testing\bootstrap.html">How to Customize the Bootstrap Process before Running Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/bootstrap-ru.html">Как настроить процесс начальной загрузки перед выполнением тестов</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing\database.html">How to Test Code that Interacts with the Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/database-ru.html">Как тестировать код, взаимодействующий с базой данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing\doctrine.html">How to Test Doctrine Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/doctrine-ru.html">Как тестировать хранилища Doctrine</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing\http_authentification.html">How to Simulate HTTP Authentication in a Functional Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/http_authentification-ru.html">Как имитировать HTTP-аутентификацию в функциональном тестировании</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing\insulating_clients.html">How to Test the Interaction of several Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/insulating_clients-ru.html">Как тестировать взаимодействие нескольких клиентов</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing\profiling.html">How to Use the Profiler in a Functional Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing/profiling-ru.html">Как использовать профилировщик в функциональном тесте</a></li>
</ul>
</div>
<ul class="simple">
<li><a class="reference internal" href="best_practices\tests.html"><em>The chapter about tests in the Symfony Framework Best Practices</em></a></li>
<li><a class="reference internal" href="components\dom_crawler.html"><em>The DomCrawler Component</em></a></li>
<li><a class="reference internal" href="components\css_selector.html"><em>The CssSelector Component</em></a></li>
</ul>
</div>
</div>


            </div>

            

            <div id="license">
                <p>Эта документация является переводом <a href="http://symfony.com/doc/current/index.html">официальной документации Symfony</a> и предоставляется по свободной лицензии <a rel="license nofollow" href="https://creativecommons.org/licenses/by-sa/3.0/deed.ru">CC BY-SA 3.0</a>.</p>
            </div>
        </div>
    </div>
</div></div>


  </body>
</body></html>